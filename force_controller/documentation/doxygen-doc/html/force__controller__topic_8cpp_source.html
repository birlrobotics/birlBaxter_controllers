<html><head><meta http-equiv="Content-Type" content="text/html;charset=utf-8">
<title>force_controller: force_controller_topic.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.8.6 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_9c1df391afb0d62e5ff4608cb0fdbcd8.html">force_controller</a></li><li class="navelem"><a class="el" href="dir_f241816ecfb4bce6f43939aebcbd1cab.html">src</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">force_controller_topic.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<a href="force__controller__topic_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="force__controller__topic_8h.html">force_controller/force_controller_topic.h</a>&gt;</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="keyword">namespace </span>force_controller</div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;{</div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;  <span class="comment">//***********************************************************************************************************************************************</span></div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;  <span class="comment">// callback(...) for dynamic Reconfigure set as a global function. </span></div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;  <span class="comment">// When the rqt_reconfigure gui is used and those parameters are changed, the config.param_name in this function will be updated. Then, these parameters need to be set to the private members of your code to record those changes. </span></div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;  <span class="comment">//***********************************************************************************************************************************************</span></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;  <span class="keywordtype">void</span> <a class="code" href="namespaceforce__controller.html#a0528cabafdfdb625a6147d7ba283ce4f">callback</a>(force_error_constants::force_error_constantsConfig &amp;config, uint32_t level)</div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;  {</div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;    <span class="comment">// Print the updated values</span></div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;    ROS_INFO(<span class="stringliteral">&quot;Reconfigure request: %f %f %f %f %f %f&quot;</span>, </div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;             config.k_fp0,</div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;             config.k_fp1,</div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;             config.k_fp2,</div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;             config.k_mp0,</div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;             config.k_mp1,</div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;             config.k_mp2);</div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;  </div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;  <span class="comment">// Save to the corresponding data members. </span></div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;  <a class="code" href="namespaceforce__controller.html#ae69e9d55157a9e6d86bbb4988da3048f">k_fp0</a>=config.k_fp0;</div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;  <a class="code" href="namespaceforce__controller.html#a5aeeda755261f55a0a7537cf084aae0b">k_fp1</a>=config.k_fp1;</div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;  <a class="code" href="namespaceforce__controller.html#a5b3c2e286037742e79daaabd6d90eb2d">k_fp2</a>=config.k_fp2;</div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;  <a class="code" href="namespaceforce__controller.html#aa5a1605f11362db37d087a8d641fa649">k_mp0</a>=config.k_mp0;</div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;  <a class="code" href="namespaceforce__controller.html#a6143adbc6c88b5efcaeaee03278b7ea0">k_mp1</a>=config.k_mp1;</div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;  <a class="code" href="namespaceforce__controller.html#a595af76feee2920c70e1e0d748d5947d">k_mp2</a>=config.k_mp2;</div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;</div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;  <span class="comment">// change the flag</span></div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;  <a class="code" href="namespaceforce__controller.html#a98b0f31330f4440a7743820ac112c0b5">force_error_constantsFlag</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;</div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;  }</div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;</div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;  <span class="comment">//-----------------------------------------------------------------------------------</span></div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;  <span class="comment">// Controller Class Constructor</span></div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;  <span class="comment">//-----------------------------------------------------------------------------------</span></div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;  <a class="code" href="classforce__controller_1_1controller.html#af5c730489d342e7a3a8e7fc086cf7ee8">controller::controller</a>(ros::NodeHandle node): node_handle_(node)</div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;          {</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;      <span class="comment">// Initialize counters and Flags</span></div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;      <a class="code" href="classforce__controller_1_1controller.html#acaf8797976b6bca1c3e3266beeecea05">n_</a> = 0;   <a class="code" href="classforce__controller_1_1controller.html#a6d03a10356f839e09ab21ed7922d75ec">m_</a> = 0; <a class="code" href="classforce__controller_1_1controller.html#a5da8bb2066e33651742e40fe2654e432">no_</a> = 0, <a class="code" href="classforce__controller_1_1controller.html#a8c4a72dc4cc143cdf2f8b0a9e7b9d672">errorCtr_</a>=1; <a class="code" href="classforce__controller_1_1controller.html#a7d49b6e63d3b7cc1eb38839c3c4cf186">error_norm_</a>=0.0;</div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;</div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;      <span class="comment">// Local </span></div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;      <span class="keywordtype">int</span> nj;</div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;      <span class="keywordtype">double</span> gain;</div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;      <span class="comment">// Default parameter Values</span></div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;      <span class="keywordtype">double</span> alpha  = 0.987512; <span class="comment">// 0.50;           // Orig: 0.987512</span></div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;      <span class="keywordtype">double</span> oneDeg = <a class="code" href="force__controller__service_8h.html#a598a3330b3c21701223ee0ca14316eca">PI</a>/180;</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;      <span class="keywordtype">int</span>    force_error_threshold=1;  </div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;      <span class="comment">/*** Get Parameter Values ***/</span></div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;      <span class="comment">// Get Parameter Values from the parameter server. Set in the roslaunch file or by hand.</span></div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;      <span class="comment">// node_handle_ access node namespace. root_handle_ access global namespace.</span></div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;      <span class="comment">// Position Controller precision and filtering</span></div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;      <a class="code" href="classforce__controller_1_1controller.html#a78728db5683bf435c3766e4e2f68cf58">node_handle_</a>.param&lt;<span class="keywordtype">double</span>&gt;(<span class="stringliteral">&quot;joint_precision&quot;</span>, <a class="code" href="classforce__controller_1_1controller.html#a29c199c16b81807932247d37b361b795">tolerance_</a>, oneDeg);</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;      <a class="code" href="classforce__controller_1_1controller.html#a78728db5683bf435c3766e4e2f68cf58">node_handle_</a>.param&lt;<span class="keywordtype">double</span>&gt;(<span class="stringliteral">&quot;filter&quot;</span>, <a class="code" href="classforce__controller_1_1controller.html#a6b77f0183903fdad065ffe21d92b3686">alpha_</a>, alpha);  </div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;      <span class="comment">// Force Controller Error Tolerance</span></div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;      <a class="code" href="classforce__controller_1_1controller.html#a78728db5683bf435c3766e4e2f68cf58">node_handle_</a>.param&lt;<span class="keywordtype">double</span>&gt;(<span class="stringliteral">&quot;error_threshold&quot;</span>,<a class="code" href="classforce__controller_1_1controller.html#aab96e1c62387346058db79b4066b6339">force_error_threshold_</a>,force_error_threshold);</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;      <span class="comment">// Strings</span></div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;      <a class="code" href="classforce__controller_1_1controller.html#a78728db5683bf435c3766e4e2f68cf58">node_handle_</a>.param&lt;std::string&gt;(<span class="stringliteral">&quot;side&quot;</span>, <a class="code" href="classforce__controller_1_1controller.html#a84eb8cee66c856c4f6ca9c5e57759858">side_</a>, <span class="stringliteral">&quot;right&quot;</span>);</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;      <a class="code" href="classforce__controller_1_1controller.html#a78728db5683bf435c3766e4e2f68cf58">node_handle_</a>.param&lt;std::string&gt;(<span class="stringliteral">&quot;tip_name&quot;</span>, <a class="code" href="classforce__controller_1_1controller.html#a84ec89e4aec8fd8cf6569b38929c34e4">tip_name_</a>, <span class="stringliteral">&quot;right_gripper&quot;</span>);</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;      <span class="comment">// Hack: currently we cannot guarantee the order in which spinner threads are called.</span></div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;      <span class="comment">// There are occassions in which getWrenchEndpoint is called before updateJointAngles, in this case, getTorqueOffset is called, which needs joints. A segfault is issued.</span></div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;      std::vector&lt;double&gt; tmp;</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;      <span class="comment">//for(int i=0; i&lt;7; i++) tmp.push_back(0.0);</span></div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;      tmp.resize(7);</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;      tmp[0]=0.07; tmp[1]=-0.9; tmp[2]=1.15; tmp[3]=1.92; tmp[4]=-0.6; tmp[5]=1.01; tmp[6]=0.48;</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;      <span class="comment">// Right Arm</span></div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;      <span class="keywordflow">if</span>(strcmp(side_.c_str(),<span class="stringliteral">&quot;right&quot;</span>)) <a class="code" href="classforce__controller_1_1controller.html#afcbd0b56ca056d42a4b9838fde2fd0d2">joints_</a>.push_back(tmp);</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;      <span class="comment">// Left arm</span></div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;      <span class="keywordflow">else</span> </div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;        {</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;          tmp[0]=0.0; tmp[1]=-0.9; tmp[2]=1.1; tmp[3]=1.92; tmp[4]=-0.65; tmp[5]=1.00; tmp[6]=-0.48;</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;          <a class="code" href="classforce__controller_1_1controller.html#afcbd0b56ca056d42a4b9838fde2fd0d2">joints_</a>.push_back(tmp);</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;        }</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;          </div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;      <span class="comment">// Proportional Gains</span></div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;      <a class="code" href="classforce__controller_1_1controller.html#ae03abf03e53baed9003d928cc193d9f5">gFp_</a> &lt;&lt; <a class="code" href="namespaceforce__controller.html#ae69e9d55157a9e6d86bbb4988da3048f">k_fp0</a>, <a class="code" href="namespaceforce__controller.html#a5aeeda755261f55a0a7537cf084aae0b">k_fp1</a>, <a class="code" href="namespaceforce__controller.html#a5b3c2e286037742e79daaabd6d90eb2d">k_fp2</a>; </div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;      <a class="code" href="classforce__controller_1_1controller.html#a8d5c14a6b0a989328a531290dd30aba5">gMp_</a> &lt;&lt; <a class="code" href="namespaceforce__controller.html#aa5a1605f11362db37d087a8d641fa649">k_mp0</a>, <a class="code" href="namespaceforce__controller.html#a6143adbc6c88b5efcaeaee03278b7ea0">k_mp1</a>, <a class="code" href="namespaceforce__controller.html#a595af76feee2920c70e1e0d748d5947d">k_mp2</a>; </div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;      <span class="comment">// Derivative Gains</span></div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;      <a class="code" href="classforce__controller_1_1controller.html#a1d6e16a7f7273b1c917ef0195a6dbbf4">gFv_</a> &lt;&lt; <a class="code" href="namespaceforce__controller.html#a56542fdd8d3898990b6a1900a65b295f">k_fv0</a>, <a class="code" href="namespaceforce__controller.html#a4a75753de3b1c0b8af8bc62de3678afd">k_fv1</a>, <a class="code" href="namespaceforce__controller.html#a61b6a2bfc5b42e1e845ff2bda2125f64">k_fv2</a>; </div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;      <a class="code" href="classforce__controller_1_1controller.html#a38e041c5afe185d763e0b6a1d2020560">gMv_</a> &lt;&lt; <a class="code" href="namespaceforce__controller.html#a9015ab9675d6cd1aa20368c6e541b838">k_mv0</a>, <a class="code" href="namespaceforce__controller.html#a1bc2e59c28ec7380b6625ea62731174c">k_mv1</a>, <a class="code" href="namespaceforce__controller.html#ad68e3a9e51157a1cc644079cb991a9d5">k_mv2</a>; </div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;      <span class="comment">// Other vectors</span></div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;      <a class="code" href="classforce__controller_1_1controller.html#a74ecf644e29bc65edd13e24f81ec3c36">cur_data_</a>   = Eigen::VectorXd::Zero(6);  <a class="code" href="classforce__controller_1_1controller.html#a3bcf694aad91741d8826b087efc0d8cf">cur_data_f_</a> = Eigen::VectorXd::Zero(6);</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;      <a class="code" href="classforce__controller_1_1controller.html#ac0a27412a2683f8a49bc00d5c1e5dc71">error_</a>      = Eigen::VectorXd::Zero(6);  <a class="code" href="classforce__controller_1_1controller.html#a336e3d15282f3ac82d188f841dd3296c">error_t_1</a>   = Eigen::VectorXd::Zero(6);</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;      <a class="code" href="classforce__controller_1_1controller.html#a77574a80d7fa60f3430a0da033749fa6">derror_</a>     = Eigen::VectorXd::Zero(6);</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;      <span class="comment">// Create two entries into setPoint_</span></div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;      Eigen::VectorXd t = Eigen::VectorXd::Zero(3);</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;      <a class="code" href="classforce__controller_1_1controller.html#aa071e951e19dd04f4d3c512af6cdc151">setPoint_</a>.push_back(t); </div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;      <a class="code" href="classforce__controller_1_1controller.html#aa071e951e19dd04f4d3c512af6cdc151">setPoint_</a>.push_back(t); </div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;    </div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;      <span class="comment">// State</span></div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;      <a class="code" href="classforce__controller_1_1controller.html#aad5a334ce57bddf6d1b70bc8fd91ced2">exe_</a> = <span class="keyword">false</span>;     <a class="code" href="classforce__controller_1_1controller.html#a07d207a2bc65d08b555e0101b459bb1e">jo_ready_</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;      <span class="comment">/***************************************************** Publisher, subscriber and Service Advertisement *******************************************************************/</span></div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;      <span class="comment">// Set all the flag values ros ros communication objects</span></div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;      <a class="code" href="classforce__controller_1_1controller.html#a26eb26299919122098a0285ad4bf09d6">rosCommunicationCtr</a>=0;</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;      <a class="code" href="classforce__controller_1_1controller.html#a489bb9eb1fa65e0220a29592c3667962">joints_sub_flag</a>              =<a class="code" href="force__controller__service_8h.html#ac58264491fe4a942109b1b23f3625b0c">JOINTS_SUB_F</a>; </div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;      <a class="code" href="classforce__controller_1_1controller.html#aa72dcbf75b0d6656b993444ab1baf42e">joint_cmd_pub_flag</a>           =<a class="code" href="force__controller__service_8h.html#ae729ae5085e05425e4d5e2e97ff4f9f2">JOINTS_PUB_F</a>;</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;      <a class="code" href="classforce__controller_1_1controller.html#a923ba48416f4898fedf169069bc46e6e">ft_wacoh_flag</a>                =<a class="code" href="force__controller__service_8h.html#adada7ef5a30b465af8de2d94f6f1e6d9">FT_WACOH_F</a>;</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;      <a class="code" href="classforce__controller_1_1controller.html#aa32fea7cb5c55d3003a4e21d3a0103d6">setPoint_sub_flag</a>            =<a class="code" href="force__controller__service_8h.html#a3e96b2f69d25eb963ff5075d9f0071b0">SETPNT_SUB_F</a>;</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;      <a class="code" href="classforce__controller_1_1controller.html#abd8b9a119755fa7119eb7fca73a085a8">wrench_sub_flag</a>              =<a class="code" href="force__controller__service_8h.html#a04e53c2a1dcb8167b241004eb0e4773a">WRENCH_SUB_F</a>;</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;      <a class="code" href="classforce__controller_1_1controller.html#a3f6c9ff42779a7285c563423081d21ac">filtered_wrench_pub_flag</a>           =<a class="code" href="force__controller__service_8h.html#aac6738ec688c2f04796681c78e2bd5e1">FILT_W_PUB_F</a>;</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;      <a class="code" href="classforce__controller_1_1controller.html#a614dfafdbe66861e6af231063d807f4f">gravitational_offset_pub_flag</a>=<a class="code" href="force__controller__service_8h.html#ab323266b3c62ab3978bbcf2f760e937e">GRAV_PUB_F</a>;</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;      <a class="code" href="classforce__controller_1_1controller.html#a5357d27a499e0cf688e87e288501e8ef">wrench_error_pub_flag</a>        =<a class="code" href="force__controller__service_8h.html#a75013d7e939cffd5d4a019f69da86867">WRENCH_ERORR_PUB_F</a>;</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;      <a class="code" href="classforce__controller_1_1controller.html#aac1199be193bda87b0d54f6ad319e4ec">ctrl_server_flag</a>             =<a class="code" href="force__controller__service_8h.html#a8030bd6f8002894b1993afe17539c7af">CTRBAS_SRV_F</a>; </div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;      <a class="code" href="classforce__controller_1_1controller.html#af91f75e28310a019cfb687306b509838">dynamic_reconfigure_flag</a>     =<a class="code" href="force__controller__service_8h.html#ac49f84faad35fb6284d21ca8866a1942">DYN_RECONF_F</a>; </div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;      <a class="code" href="namespaceforce__controller.html#a98b0f31330f4440a7743820ac112c0b5">force_error_constantsFlag</a>=<span class="keyword">false</span>; </div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;      <span class="comment">// 1. Subscription object to get current joint angle positions, velocities, joint torques, and gravitational compensation torques.</span></div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;      <span class="keywordflow">if</span>(<a class="code" href="classforce__controller_1_1controller.html#a489bb9eb1fa65e0220a29592c3667962">joints_sub_flag</a>)</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;        {</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;          <a class="code" href="classforce__controller_1_1controller.html#ac15c8cfd65846a64e01347baac788496">joints_sub_</a> = <a class="code" href="classforce__controller_1_1controller.html#adbb1c2386bb6d633eecafcdf7c713509">root_handle_</a>.subscribe&lt;baxter_core_msgs::SEAJointState&gt;(<span class="stringliteral">&quot;/robot/limb/&quot;</span> + side_ + <span class="stringliteral">&quot;/gravity_compensation_torques&quot;</span>, 1, &amp;<a class="code" href="classforce__controller_1_1controller.html#a1db5f13c75b670b100085a1dba15cc57">controller::getBaxterJointState</a>, <span class="keyword">this</span>);</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;          <a class="code" href="classforce__controller_1_1controller.html#a26eb26299919122098a0285ad4bf09d6">rosCommunicationCtr</a>++;</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;        }</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;      <span class="comment">// 2. Subscription object to get the wrench endpoint state. </span></div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;      <span class="keywordflow">if</span>(<a class="code" href="classforce__controller_1_1controller.html#abd8b9a119755fa7119eb7fca73a085a8">wrench_sub_flag</a>)</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;        {</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;          <span class="keywordflow">if</span>(<a class="code" href="classforce__controller_1_1controller.html#a923ba48416f4898fedf169069bc46e6e">ft_wacoh_flag</a>)</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;            <a class="code" href="classforce__controller_1_1controller.html#af22c1f78482a25b4436da3dd7c47dbb8">wrench_sub_</a> = <a class="code" href="classforce__controller_1_1controller.html#adbb1c2386bb6d633eecafcdf7c713509">root_handle_</a>.subscribe&lt;geometry_msgs::WrenchStamped&gt;(<span class="stringliteral">&quot;/wrench/filter&quot;</span>, 1, &amp;<a class="code" href="classforce__controller_1_1controller.html#a310cc036eec7848e60bb1b1d27b287de">controller::getWrenchEndpoint_wacoh</a>, <span class="keyword">this</span>); <span class="comment">//wrench/biased is a topic with offset to zero ft sensor.</span></div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;          <span class="keywordflow">else</span></div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;            <a class="code" href="classforce__controller_1_1controller.html#af22c1f78482a25b4436da3dd7c47dbb8">wrench_sub_</a> = <a class="code" href="classforce__controller_1_1controller.html#adbb1c2386bb6d633eecafcdf7c713509">root_handle_</a>.subscribe&lt;baxter_core_msgs::EndpointState&gt;(<span class="stringliteral">&quot;/robot/limb/&quot;</span> + side_ + <span class="stringliteral">&quot;/endpoint_state&quot;</span>, 1, &amp;<a class="code" href="classforce__controller_1_1controller.html#a0df9762be0629c3201524b5c15426c86">controller::getWrenchEndpoint</a>, <span class="keyword">this</span>);</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;          <a class="code" href="classforce__controller_1_1controller.html#a26eb26299919122098a0285ad4bf09d6">rosCommunicationCtr</a>++;</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;        }</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;      <span class="comment">// 3. Subscription object to get the controller setPoint </span></div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;      <span class="keywordflow">if</span>(<a class="code" href="classforce__controller_1_1controller.html#aa32fea7cb5c55d3003a4e21d3a0103d6">setPoint_sub_flag</a>)</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;        {</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;          <a class="code" href="classforce__controller_1_1controller.html#a104a7d4810b5b2a2611d0361f8a6111e">setPoint_sub_</a> = <a class="code" href="classforce__controller_1_1controller.html#adbb1c2386bb6d633eecafcdf7c713509">root_handle_</a>.subscribe&lt;force_controller::setPoint&gt;(<span class="stringliteral">&quot;/&quot;</span> + side_ + <span class="stringliteral">&quot;/force_control/setPoint&quot;</span>,1,&amp;<a class="code" href="classforce__controller_1_1controller.html#ae80a69dcc5062b11960925155323227a">controller::getSetPoint</a>,<span class="keyword">this</span>);</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;          <a class="code" href="classforce__controller_1_1controller.html#a26eb26299919122098a0285ad4bf09d6">rosCommunicationCtr</a>++;</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;        }</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;      <span class="comment">// 4. Publication object to publish commanded joint positions throught the joint_command topic.</span></div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;      <span class="keywordflow">if</span>(<a class="code" href="classforce__controller_1_1controller.html#aa72dcbf75b0d6656b993444ab1baf42e">joint_cmd_pub_flag</a>)</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;        {</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;          <a class="code" href="classforce__controller_1_1controller.html#aaea78103c35921c8632cfba6eff55324">joint_cmd_pub_</a> = <a class="code" href="classforce__controller_1_1controller.html#a78728db5683bf435c3766e4e2f68cf58">node_handle_</a>.advertise&lt;baxter_core_msgs::JointCommand&gt;(<span class="stringliteral">&quot;/robot/limb/&quot;</span> + side_ + <span class="stringliteral">&quot;/joint_command&quot;</span>, 10, <span class="keyword">false</span>); <span class="comment">// May want to keep a small num of points</span></div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;          ros::Duration(3.0).sleep(); ROS_INFO(<span class="stringliteral">&quot;Initial Pose initialized for %s arm, tolerance = %f&quot;</span>, side_.c_str(), <a class="code" href="classforce__controller_1_1controller.html#a29c199c16b81807932247d37b361b795">tolerance_</a>);       </div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;          <a class="code" href="classforce__controller_1_1controller.html#a26eb26299919122098a0285ad4bf09d6">rosCommunicationCtr</a>++;</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;        }</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;      <span class="comment">// 5. Publication object to publish filtered wrench information.</span></div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;      <span class="keywordflow">if</span>(<a class="code" href="classforce__controller_1_1controller.html#a3f6c9ff42779a7285c563423081d21ac">filtered_wrench_pub_flag</a>)</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;        {</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;          <span class="keywordflow">if</span>(<a class="code" href="classforce__controller_1_1controller.html#a923ba48416f4898fedf169069bc46e6e">ft_wacoh_flag</a>)</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;            <a class="code" href="classforce__controller_1_1controller.html#ad0625bce9d3236f29c4ec5296ed122a6">filtered_wrench_pub_</a> = <a class="code" href="classforce__controller_1_1controller.html#a78728db5683bf435c3766e4e2f68cf58">node_handle_</a>.advertise&lt;geometry_msgs::WrenchStamped&gt;(<span class="stringliteral">&quot;/robot/limb/&quot;</span> + side_ + <span class="stringliteral">&quot;/filtered_wrench&quot;</span>, 20, <span class="keyword">false</span>);</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;          <span class="keywordflow">else</span></div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;            <a class="code" href="classforce__controller_1_1controller.html#ad0625bce9d3236f29c4ec5296ed122a6">filtered_wrench_pub_</a> = <a class="code" href="classforce__controller_1_1controller.html#a78728db5683bf435c3766e4e2f68cf58">node_handle_</a>.advertise&lt;baxter_core_msgs::EndpointState&gt;(<span class="stringliteral">&quot;/robot/limb/&quot;</span> + side_ + <span class="stringliteral">&quot;/filtered_wrench&quot;</span>, 20, <span class="keyword">false</span>);</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;          <a class="code" href="classforce__controller_1_1controller.html#a26eb26299919122098a0285ad4bf09d6">rosCommunicationCtr</a>++;</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;        }</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;      <span class="comment">// 6. Publication object to publish gravitation offset at the end-effector</span></div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;      <span class="keywordflow">if</span>(<a class="code" href="classforce__controller_1_1controller.html#a614dfafdbe66861e6af231063d807f4f">gravitational_offset_pub_flag</a>)</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;        {</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;          <a class="code" href="classforce__controller_1_1controller.html#acfb72315ab3cc7b6402ffb42c19aae73">endEff_gravOffset_pub_</a> = <a class="code" href="classforce__controller_1_1controller.html#a78728db5683bf435c3766e4e2f68cf58">node_handle_</a>.advertise&lt;geometry_msgs::Wrench&gt;(<span class="stringliteral">&quot;/robot/limb/&quot;</span> + side_ + <span class="stringliteral">&quot;/endEff_gravOffset&quot;</span>, 20, <span class="keyword">false</span>);</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;          <a class="code" href="classforce__controller_1_1controller.html#a26eb26299919122098a0285ad4bf09d6">rosCommunicationCtr</a>++;</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;        }</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;      <span class="comment">// 7. Publish force error</span></div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;      <span class="keywordflow">if</span>(<a class="code" href="classforce__controller_1_1controller.html#a5357d27a499e0cf688e87e288501e8ef">wrench_error_pub_flag</a>) </div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;        {</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;          <a class="code" href="classforce__controller_1_1controller.html#ab43040c1c59277906a1660bf18813f50">wrench_error_pub_</a> = <a class="code" href="classforce__controller_1_1controller.html#a78728db5683bf435c3766e4e2f68cf58">node_handle_</a>.advertise&lt;geometry_msgs::Vector3&gt;(<span class="stringliteral">&quot;/robot/limb/&quot;</span> + side_ + <span class="stringliteral">&quot;/forceError&quot;</span>, 20, <span class="keyword">false</span>);</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;          <a class="code" href="classforce__controller_1_1controller.html#a26eb26299919122098a0285ad4bf09d6">rosCommunicationCtr</a>++;</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;        }</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;      <span class="comment">// Create the kinematic chain/model through kdl from base to right/left gripper</span></div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;            <a class="code" href="classforce__controller_1_1controller.html#a8097c60da101a4be307ba2234da52ba3">kine_model_</a> = <a class="code" href="classforce__controller_1_1Kinematics.html#ad2e72f1bb4e512403fb0cbf6ad27f1c4">Kinematics::create</a>(tip_name_, nj);</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;      <span class="comment">// Clear torque and gravitational torque vectors.</span></div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;      <a class="code" href="classforce__controller_1_1controller.html#ae02baf2b659490f6df46f805ea5abfe8">torque_</a>.clear();</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;      <a class="code" href="classforce__controller_1_1controller.html#a94eb7de6ca36f137faa978bd92ab22d4">tg_</a>.clear();</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;      <span class="comment">// If we have our 7DoF, then let&#39;s set the values of our joint names in joints_names_ as: s0s1e0e1w0w1w2. This is the order of /robot/limb/right/gravity_compensation_torques but not of /robot/limb/right/joint_commad</span></div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;      <span class="keywordflow">if</span>(nj == 7)</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;        {</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;          <a class="code" href="classforce__controller_1_1controller.html#ab1fabd40e6694b2f661d49657660769f">fillJointNames</a>();</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;          <a class="code" href="classforce__controller_1_1controller.html#a1c26ab301c63daa32cdcb559df6f294b">init_</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;        }</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;      <span class="comment">// Print successful exit</span></div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;      ros::Duration(1.0).sleep();</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;      <span class="comment">// Time Rates</span></div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;      <a class="code" href="classforce__controller_1_1controller.html#a614899d6415daf8d0f9e35710f491136">timeOut_</a>            =<a class="code" href="force__controller__service_8h.html#a799517031a8334a42807b119bb456c53">TIME_OUT</a>;</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;      <a class="code" href="classforce__controller_1_1controller.html#a5bbb04800e288b5a5cc935ae194ab644">fc_while_loop_rate_</a> =<a class="code" href="force__controller__service_8h.html#adfcaf3d67d4879a6d620ed436c43325a">FC_ROS_RATE</a>;</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;      <a class="code" href="classforce__controller_1_1controller.html#af37d92322d83fc8c77d2f181b049c5a3">pos_while_loop_rate_</a>=<a class="code" href="force__controller__service_8h.html#a8bf091dd70dba91bc904c8087bede5d2">POS_ROS_RATE</a>;</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;      <span class="comment">/*** Filtering ***/</span></div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;      <span class="comment">// Inner Control Loop</span></div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;      <a class="code" href="classforce__controller_1_1controller.html#a6e3d2f700e0f9faa10734d8d3ed9f14a">jntPos_Torque_InnerCtrl_Flag_</a>=<a class="code" href="force__controller__service_8h.html#a673b67db9693fbd9865bf36ffd68d153">JNTPOS_TORQUE_CONTROLLER</a>;</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;        <span class="comment">// Wrench Filtering</span></div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;      <a class="code" href="classforce__controller_1_1controller.html#abfe080984202747089d707ae59a0b468">initialFiltering</a>       =1; <span class="comment">// Filter wrench dat</span></div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;      <a class="code" href="classforce__controller_1_1controller.html#af59fd764a51eb75822a0fe859f3c1a69">wrenchFilteringFlag</a>    =1;</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;      <span class="comment">// Gravity Compensation</span></div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;      <a class="code" href="classforce__controller_1_1controller.html#a6b98ecca8b41852578f2bad31d07fe19">gravitationalOffsetFlag</a>=0; <span class="comment">// Enter loop considering gravity compensation</span></div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;      <a class="code" href="classforce__controller_1_1controller.html#a276068dd674237675fa4bf22f4c2d629">initialGravCompFlag</a>    =0;</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;      ROS_INFO(<span class="stringliteral">&quot;Force controller on baxter&#39;s %s arm is ready&quot;</span>, side_.c_str());</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;          }</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;  <span class="comment">//***********************************************************************************************************************************************</span></div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;  <span class="comment">// fillJointNames()</span></div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;  <span class="comment">// Given the string parameter for the right or left side of the arm, create a vector of joint names with an ordered set of joint angle elements. </span></div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;  <span class="comment">//***********************************************************************************************************************************************</span></div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;  <span class="keywordtype">void</span> <a class="code" href="classforce__controller_1_1controller.html#ab1fabd40e6694b2f661d49657660769f">controller::fillJointNames</a>()</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;  {</div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;    <a class="code" href="classforce__controller_1_1controller.html#a44c78f990df3a26aafe5ea5dd16debc4">joints_names_</a>.clear();</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;    <a class="code" href="classforce__controller_1_1controller.html#a44c78f990df3a26aafe5ea5dd16debc4">joints_names_</a>.push_back(side_ + <span class="stringliteral">&quot;_s0&quot;</span>);</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;    <a class="code" href="classforce__controller_1_1controller.html#a44c78f990df3a26aafe5ea5dd16debc4">joints_names_</a>.push_back(side_ + <span class="stringliteral">&quot;_s1&quot;</span>);</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;    <a class="code" href="classforce__controller_1_1controller.html#a44c78f990df3a26aafe5ea5dd16debc4">joints_names_</a>.push_back(side_ + <span class="stringliteral">&quot;_e0&quot;</span>);</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;    <a class="code" href="classforce__controller_1_1controller.html#a44c78f990df3a26aafe5ea5dd16debc4">joints_names_</a>.push_back(side_ + <span class="stringliteral">&quot;_e1&quot;</span>);</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;    <a class="code" href="classforce__controller_1_1controller.html#a44c78f990df3a26aafe5ea5dd16debc4">joints_names_</a>.push_back(side_ + <span class="stringliteral">&quot;_w0&quot;</span>);</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;    <a class="code" href="classforce__controller_1_1controller.html#a44c78f990df3a26aafe5ea5dd16debc4">joints_names_</a>.push_back(side_ + <span class="stringliteral">&quot;_w1&quot;</span>);</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;    <a class="code" href="classforce__controller_1_1controller.html#a44c78f990df3a26aafe5ea5dd16debc4">joints_names_</a>.push_back(side_ + <span class="stringliteral">&quot;_w2&quot;</span>);</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;    <span class="comment">// Resize other kinematic model variables that need to be used in computeError</span></div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;    <a class="code" href="classforce__controller_1_1controller.html#afcbd0b56ca056d42a4b9838fde2fd0d2">joints_</a>.clear();</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;    <a class="code" href="classforce__controller_1_1controller.html#afbce15b637b449428b68e6d3ae4aca9a">j_t_1_</a>.clear();</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;    <a class="code" href="classforce__controller_1_1controller.html#a378293c954e789d133bdb273f1cc87b9">jv_t_1_</a>.clear();</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;    <a class="code" href="classforce__controller_1_1controller.html#afbce15b637b449428b68e6d3ae4aca9a">j_t_1_</a>.resize(<a class="code" href="classforce__controller_1_1controller.html#a44c78f990df3a26aafe5ea5dd16debc4">joints_names_</a>.size());</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;    <a class="code" href="classforce__controller_1_1controller.html#a378293c954e789d133bdb273f1cc87b9">jv_t_1_</a>.resize(<a class="code" href="classforce__controller_1_1controller.html#a44c78f990df3a26aafe5ea5dd16debc4">joints_names_</a>.size());</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;    <a class="code" href="classforce__controller_1_1controller.html#aedbcede812ff8b7a120c69caa6626608">tm_t_1_</a>.resize(<a class="code" href="classforce__controller_1_1controller.html#a44c78f990df3a26aafe5ea5dd16debc4">joints_names_</a>.size());</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;    <a class="code" href="classforce__controller_1_1controller.html#aaf07c006e57ab9b427af5190999ac696">tg_t_1_</a>.resize(<a class="code" href="classforce__controller_1_1controller.html#a44c78f990df3a26aafe5ea5dd16debc4">joints_names_</a>.size());</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;    <a class="code" href="classforce__controller_1_1controller.html#aea175af45a8487a66063273b84f549f2">tgBase_</a>.resize(<a class="code" href="classforce__controller_1_1controller.html#a44c78f990df3a26aafe5ea5dd16debc4">joints_names_</a>.size());</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;    <span class="comment">// Initialize qe_ to a high value on the first iteration: used in position_controllers</span></div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;    <a class="code" href="classforce__controller_1_1controller.html#aaf2e5764f863e7e35c7c16793ae7e17d">qe_</a>.clear();</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i&lt;<a class="code" href="classforce__controller_1_1controller.html#a44c78f990df3a26aafe5ea5dd16debc4">joints_names_</a>.size(); i++)</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;      <a class="code" href="classforce__controller_1_1controller.html#aaf2e5764f863e7e35c7c16793ae7e17d">qe_</a>.push_back(100.0);</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;  }</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;  <span class="comment">// Convert a 3D geometry vector and convert it into a 3D std::vector </span></div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;  std::vector&lt;double&gt; <a class="code" href="classforce__controller_1_1controller.html#a022ddeb5313ef39d3b61dafa72286667">controller::toVector</a>(<span class="keyword">const</span> geometry_msgs::Vector3&amp; <a class="code" href="namespacesetup.html#aca780a20a42a6ef8d18d6e332a91f721">d</a>)</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;  {</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;    std::vector&lt;double&gt; result;</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;    result.clear();</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;    result.push_back(d.x);</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;    result.push_back(d.y);</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;    result.push_back(d.z);</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;    <span class="keywordflow">return</span> result;</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;  }</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;  <span class="comment">//*************************************************************************</span></div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;  <span class="comment">// fill(...)</span></div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;  <span class="comment">// Takes a delta joint angle update and add it to the current angles. TODO: make sure you know the order of the joints strings.</span></div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;  <span class="comment">// Current angles are set in getBaxterJointState where filtered values are set to joints_[0]</span></div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;  <span class="comment">//*************************************************************************</span></div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;  sensor_msgs::JointState <a class="code" href="classforce__controller_1_1controller.html#a990c5d78efd81b20830728580a6dcccf">controller::fill</a>(Eigen::VectorXd dq)</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;  {</div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;    <span class="comment">// Create a JointState structure. Composed of string[] name and float64[] pos/vel/effort.</span></div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;    sensor_msgs::JointState update;</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;    update.name = <a class="code" href="classforce__controller_1_1controller.html#a44c78f990df3a26aafe5ea5dd16debc4">joints_names_</a>;</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;    update.position.clear();</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;    <span class="comment">// Add delta joint angle updates to current angles held in joints_[0]. </span></div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i&lt;<a class="code" href="classforce__controller_1_1controller.html#a44c78f990df3a26aafe5ea5dd16debc4">joints_names_</a>.size(); i++)</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;      update.position.push_back(dq(i)+<a class="code" href="classforce__controller_1_1controller.html#afcbd0b56ca056d42a4b9838fde2fd0d2">joints_</a>[0][i]);</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;    <span class="comment">// Clear other quantities. </span></div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;    update.velocity.clear();</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;    update.effort.clear();</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;    <span class="comment">// Add current time stamp. </span></div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;    update.header.stamp = ros::Time::now();</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;    <span class="keywordflow">return</span> update;</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;  }</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;  <span class="comment">// This function records the torque offset </span></div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;  Eigen::VectorXd <a class="code" href="classforce__controller_1_1controller.html#aa71c2771c7285ad804d022a9329b1d37">controller::getTorqueOffset</a>()</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;  {</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;    <span class="comment">// Create a 7 dimensional vector to hold torque offsets</span></div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;    Eigen::VectorXd torqueOffset = Eigen::VectorXd::Zero(7);</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;    <span class="comment">// Different offsets for right or left arms. </span></div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;    <span class="keywordflow">if</span>(side_ == <span class="stringliteral">&quot;left&quot;</span>)</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;      {</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;        <span class="comment">// Offset_left_ji = a_ji*x^2 + b_ji*x^1 + c_ji*x^0</span></div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i&lt;7; i++)</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;          torqueOffset(i) = <a class="code" href="namespaceforce__controller.html#af4efc9ab36c78d664b2b8b55839673e4">COEFF</a>[<a class="code" href="namespaceforce__controller.html#a86abff188da089da6a36619373dacd8b">LEFT</a>][i][0]*<a class="code" href="classforce__controller_1_1controller.html#afcbd0b56ca056d42a4b9838fde2fd0d2">joints_</a>[0][i]*<a class="code" href="classforce__controller_1_1controller.html#afcbd0b56ca056d42a4b9838fde2fd0d2">joints_</a>[0][i] + <a class="code" href="namespaceforce__controller.html#af4efc9ab36c78d664b2b8b55839673e4">COEFF</a>[<a class="code" href="namespaceforce__controller.html#a86abff188da089da6a36619373dacd8b">LEFT</a>][i][1]*<a class="code" href="classforce__controller_1_1controller.html#afcbd0b56ca056d42a4b9838fde2fd0d2">joints_</a>[0][i] + <a class="code" href="namespaceforce__controller.html#af4efc9ab36c78d664b2b8b55839673e4">COEFF</a>[<a class="code" href="namespaceforce__controller.html#a86abff188da089da6a36619373dacd8b">LEFT</a>][i][2];</div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;      }</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(side_ == <span class="stringliteral">&quot;right&quot;</span>)</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;      {</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;        <span class="comment">// Offset_right_ji = a_ji*x^2 + b_ji*x^1 + c_ji*x^0</span></div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i&lt;7; i++) </div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;          torqueOffset(i) = <a class="code" href="namespaceforce__controller.html#af4efc9ab36c78d664b2b8b55839673e4">COEFF</a>[<a class="code" href="namespaceforce__controller.html#a45c9844b88063808ec84797744142485">RIGHT</a>][i][0]*<a class="code" href="classforce__controller_1_1controller.html#afcbd0b56ca056d42a4b9838fde2fd0d2">joints_</a>[0][i]*<a class="code" href="classforce__controller_1_1controller.html#afcbd0b56ca056d42a4b9838fde2fd0d2">joints_</a>[0][i] + <a class="code" href="namespaceforce__controller.html#af4efc9ab36c78d664b2b8b55839673e4">COEFF</a>[<a class="code" href="namespaceforce__controller.html#a45c9844b88063808ec84797744142485">RIGHT</a>][i][1]*<a class="code" href="classforce__controller_1_1controller.html#afcbd0b56ca056d42a4b9838fde2fd0d2">joints_</a>[0][i] + <a class="code" href="namespaceforce__controller.html#af4efc9ab36c78d664b2b8b55839673e4">COEFF</a>[<a class="code" href="namespaceforce__controller.html#a45c9844b88063808ec84797744142485">RIGHT</a>][i][2];</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;      }</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;      ROS_ERROR_STREAM_ONCE(<span class="stringliteral">&quot;The torque offset has not been set appropriately because the wrong arm name has been provided as: &quot;</span> &lt;&lt; side_.c_str());</div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;</div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;    <span class="keywordflow">return</span> torqueOffset; <span class="comment">// 7D vector of offsets</span></div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;  }</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;  <span class="comment">//---------------------------------------------------------------------------------------------------------------------------------------------------------------------------</span></div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;  <span class="comment">// extractWrench_Force_Moment()</span></div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;  <span class="comment">// Extracts either force or moment from wrench based on the input string. It assumes that a subscriber for the wrench data is being called and that the data is available.</span></div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;  <span class="comment">// Input: string for force or moment.</span></div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;  <span class="comment">// Returns 3D vector.</span></div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;  <span class="comment">//--------------------------------------------------------------------------------------------------------------------------------------------------------------------------- </span></div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;  Eigen::Vector3d <a class="code" href="classforce__controller_1_1controller.html#a625c711141ecd592a817cbf94a15bff5">controller::extractWrench_Force_Moment</a>(<span class="keywordtype">string</span> type)</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;  {</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;    Eigen::Vector3d wrench = Eigen::Vector3d::Zero(); </div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;</div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;    <span class="comment">// Split values into force or moment</span></div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;    <span class="keywordflow">if</span>(type == <span class="stringliteral">&quot;force&quot;</span>)</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;      {</div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i&lt;3; i++)</div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;          {</div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;            <span class="keywordflow">if</span>(<a class="code" href="classforce__controller_1_1controller.html#af59fd764a51eb75822a0fe859f3c1a69">wrenchFilteringFlag</a>)</div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;              wrench(i) = <a class="code" href="classforce__controller_1_1controller.html#a3bcf694aad91741d8826b087efc0d8cf">cur_data_f_</a>(i);</div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;            <span class="keywordflow">else</span></div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;              wrench(i) = <a class="code" href="classforce__controller_1_1controller.html#a74ecf644e29bc65edd13e24f81ec3c36">cur_data_</a>(i);</div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;          }</div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;      }</div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(type == <span class="stringliteral">&quot;moment&quot;</span>)</div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;      {</div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i&lt;3; i++)</div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;          {</div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;            <span class="keywordflow">if</span>(<a class="code" href="classforce__controller_1_1controller.html#af59fd764a51eb75822a0fe859f3c1a69">wrenchFilteringFlag</a>)</div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;              wrench(i) = <a class="code" href="classforce__controller_1_1controller.html#a3bcf694aad91741d8826b087efc0d8cf">cur_data_f_</a>(i+3);</div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;            <span class="keywordflow">else</span></div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;              wrench(i) = <a class="code" href="classforce__controller_1_1controller.html#a74ecf644e29bc65edd13e24f81ec3c36">cur_data_</a>(i+3);</div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;          }</div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;      }</div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;      ROS_ERROR(<span class="stringliteral">&quot;Type is incorrect&quot;</span>);</div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;</div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;    <span class="keywordflow">return</span> wrench; </div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;  }</div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;  <span class="comment">//---------------------------------------------------------------------------------------------------------------------------------------------------------------------------</span></div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;  <span class="comment">// Callback to get wrench endpoint using the Wacoh FT sensor</span></div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;  <span class="comment">// Input: geometry_msgs/WrenchStamped which contains a wrench with force/torque.</span></div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;  <span class="comment">// Also available is the choice to add the gravitational force computed at the end_effector to the end_effector.</span></div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;  <span class="comment">// Also available is the choice to filter the data using a 2nd order low-pass filter.</span></div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;  <span class="comment">//---------------------------------------------------------------------------------------------------------------------------------------------------------------------------</span></div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;  <span class="keywordtype">void</span> <a class="code" href="classforce__controller_1_1controller.html#a310cc036eec7848e60bb1b1d27b287de">controller::getWrenchEndpoint_wacoh</a>(geometry_msgs::WrenchStamped state)</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;  {  </div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;    <span class="comment">// Get the force and torque from the callback argument state</span></div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;    <a class="code" href="classforce__controller_1_1controller.html#a74ecf644e29bc65edd13e24f81ec3c36">cur_data_</a> &lt;&lt; state.wrench.force.x, state.wrench.force.y, state.wrench.force.z,</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;                 state.wrench.torque.x,state.wrench.torque.y,state.wrench.torque.z;</div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;</div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;    <span class="comment">/***************************************************************************** Filtering ************************************************************************************/</span></div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;    <span class="comment">// Create a vector or 6D Eigen vectors</span></div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;    Eigen::VectorXd temp              = Eigen::VectorXd::Zero(6);  </div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;    Eigen::VectorXd gravOffset        = Eigen::VectorXd::Zero(7);</div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;    Eigen::VectorXd endEff_gravOffset = Eigen::VectorXd::Zero(6); <span class="comment">// Create a vectors for the gravitational offset</span></div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;    Eigen::MatrixXd jacobian, JJt;  </div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;    geometry_msgs::Wrench eeGravOff;</div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;</div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;    <span class="comment">/******************************** Gravitational Offset *******************************/</span></div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="classforce__controller_1_1controller.html#a07d207a2bc65d08b555e0101b459bb1e">jo_ready_</a>) <span class="comment">// jo_ready_ indicates gravity offset is ready</span></div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;      {</div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="classforce__controller_1_1controller.html#a6b98ecca8b41852578f2bad31d07fe19">gravitationalOffsetFlag</a>)</div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;          {</div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;            <span class="comment">// Set a base set of values corresponding to the starting positions for gravity compensation</span></div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;            <span class="keywordflow">if</span>(<a class="code" href="classforce__controller_1_1controller.html#a276068dd674237675fa4bf22f4c2d629">initialGravCompFlag</a>) </div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;              {</div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;                <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0; i&lt;7; i++)</div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;                  <a class="code" href="classforce__controller_1_1controller.html#aea175af45a8487a66063273b84f549f2">tgBase_</a>[i]=<a class="code" href="classforce__controller_1_1controller.html#a94eb7de6ca36f137faa978bd92ab22d4">tg_</a>[0][i];</div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;                <a class="code" href="classforce__controller_1_1controller.html#a276068dd674237675fa4bf22f4c2d629">initialGravCompFlag</a>=<span class="keyword">false</span>;</div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;              }</div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;            <span class="keywordflow">else</span> </div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;              {</div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;</div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;                <span class="comment">// GravityOffset = gravity compensation - base gravity compenssation</span></div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;                <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0; i&lt;7; i++)</div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;                  gravOffset(i) = <a class="code" href="classforce__controller_1_1controller.html#a94eb7de6ca36f137faa978bd92ab22d4">tg_</a>[0][i] - <a class="code" href="classforce__controller_1_1controller.html#aea175af45a8487a66063273b84f549f2">tgBase_</a>[i];</div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;</div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;                ROS_INFO_STREAM(<span class="stringliteral">&quot;gravOffset: &quot;</span> &lt;&lt; gravOffset);        </div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;</div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;                <span class="comment">// Get Jacobian (input: joint angles and joint names, output is matrix). </span></div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;                <a class="code" href="classforce__controller_1_1controller.html#a8097c60da101a4be307ba2234da52ba3">kine_model_</a>-&gt;getJacobian(<a class="code" href="classforce__controller_1_1controller.html#afcbd0b56ca056d42a4b9838fde2fd0d2">joints_</a>[0], <a class="code" href="classforce__controller_1_1controller.html#a44c78f990df3a26aafe5ea5dd16debc4">joints_names_</a>, jacobian);</div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;</div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;                <span class="comment">// Preparing the Pseudo Inverse: </span></div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;                JJt = jacobian * jacobian.transpose();</div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;</div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;                <span class="comment">// Use the Jacobian Pseudo Inverse (Moore-Penrose Inverse) to compute the wrench.</span></div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;                <span class="comment">// Equation: (J&#39;J)^-1*J&#39; or J&#39;*(JJ&#39;)^-1</span></div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;                <span class="comment">// Note that in our case T=J&#39;e, so we need to use J&#39; instead of just J in the above equation.</span></div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;                <span class="comment">// Also, the Pseudo Inverse tends to have stability problems around singularities. A large change in joing angles will be produced, even for a small motion.  </span></div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;                <span class="comment">// Singularities represent directions of motion that the manipulator cannot achieve. Particulary in a straight arm configuration, or in the wrist when W1 aligns both W0 and W2. We can check for near singularities if the determinant is close to zero. At singular positions the Pseudo Inverse the matrix is well behaved.</span></div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;                endEff_gravOffset = (JJt.inverse()*jacobian) * gravOffset;</div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;                ROS_INFO_STREAM(<span class="stringliteral">&quot;End Effector Grav Joint Offset: &quot;</span> &lt;&lt; endEff_gravOffset);</div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;</div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;                <span class="comment">// Copy data to wrench type</span></div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;                eeGravOff.force.x  =endEff_gravOffset(0);</div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;                eeGravOff.force.y  =endEff_gravOffset(1);</div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;                eeGravOff.force.z  =endEff_gravOffset(2);</div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;                eeGravOff.torque.x =endEff_gravOffset(3);</div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;                eeGravOff.torque.y =endEff_gravOffset(4);</div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;                eeGravOff.torque.z =endEff_gravOffset(5);</div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;</div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;                <a class="code" href="classforce__controller_1_1controller.html#acfb72315ab3cc7b6402ffb42c19aae73">endEff_gravOffset_pub_</a>.publish(eeGravOff);</div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;</div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;                <span class="comment">// Use Eigen&#39;s least square approach: </span></div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;                <span class="comment">// wrench = Jacobian.jacobiSvd(Eigen::ComputeThinU | Eigen::ComputeThinV).solve(endEff_gravOffset);</span></div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;                <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i&lt;6; i++)</div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;                  {</div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;                    <span class="keywordflow">if</span>(isnan(<a class="code" href="classforce__controller_1_1controller.html#a74ecf644e29bc65edd13e24f81ec3c36">cur_data_</a>(i)))</div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;                      {</div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;                        ROS_ERROR_STREAM(<span class="stringliteral">&quot;Failed to compute Jacobian Pseudo Inverse &quot;</span> &lt;&lt; <a class="code" href="classforce__controller_1_1controller.html#a74ecf644e29bc65edd13e24f81ec3c36">cur_data_</a>(i) &lt;&lt; <span class="stringliteral">&quot;, tor &quot;</span> &lt;&lt; endEff_gravOffset &lt;&lt; <span class="stringliteral">&quot;, jac&quot;</span> &lt;&lt; jacobian &lt;&lt; <span class="stringliteral">&quot;, j &quot;</span> &lt;&lt; <a class="code" href="classforce__controller_1_1controller.html#afcbd0b56ca056d42a4b9838fde2fd0d2">joints_</a>[0][0]);</div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;                        <span class="comment">// return cur_data_;</span></div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;                      }</div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;                  }</div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;              } <span class="comment">// End if-else for two methods.</span></div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;          }     <span class="comment">// End initialGravCompFlag</span></div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;</div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;        <span class="comment">/******************************** Filtering *******************************/</span></div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="classforce__controller_1_1controller.html#af59fd764a51eb75822a0fe859f3c1a69">wrenchFilteringFlag</a>)</div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;          {</div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;            <span class="comment">// If this is the first loop we need to insert two rows with equal values as the current iteration for both wrenchVec and wrenchVecF</span></div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;            <span class="keywordflow">if</span>(<a class="code" href="classforce__controller_1_1controller.html#abfe080984202747089d707ae59a0b468">initialFiltering</a>)</div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;              {</div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;                <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0; i&lt;2; i++)</div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;                  {</div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;                    <span class="comment">// Input wrench at the end of the vector</span></div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;                    <a class="code" href="classforce__controller_1_1controller.html#a1a3c36ec9ebe1455079f95e929f66d57">wrenchVec</a>.push_back(<a class="code" href="classforce__controller_1_1controller.html#a74ecf644e29bc65edd13e24f81ec3c36">cur_data_</a>);               </div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;</div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;                    <span class="comment">// Filtered wrench at the end of the vector</span></div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;                    <a class="code" href="classforce__controller_1_1controller.html#a05582c92fb4c89e7d0245c43536088f1">wrenchVecF</a>.push_back(<a class="code" href="classforce__controller_1_1controller.html#a74ecf644e29bc65edd13e24f81ec3c36">cur_data_</a>);</div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;                  }</div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;                <span class="comment">// Change Flag</span></div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;                <a class="code" href="classforce__controller_1_1controller.html#abfe080984202747089d707ae59a0b468">initialFiltering</a>=<span class="keyword">false</span>;</div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;              }</div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;</div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;            <span class="comment">// Copy new data to wrenchVec at the end of the vector</span></div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;            <a class="code" href="classforce__controller_1_1controller.html#a1a3c36ec9ebe1455079f95e929f66d57">wrenchVec</a>.push_back(<a class="code" href="classforce__controller_1_1controller.html#a74ecf644e29bc65edd13e24f81ec3c36">cur_data_</a>);</div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;        </div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;            <span class="comment">// Assuming a vector of size(3) Time entries are:0,1,2 Element [2] is the current one (sitting at the back), element t-1 is [1], sitting in the middle, and element t-2 is[0]. </span></div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;            <span class="comment">// The indeces are opposite to what you think it should be. </span></div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;            <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0; i&lt;6; i++)</div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;              temp(i) = 0.018299*<a class="code" href="classforce__controller_1_1controller.html#a1a3c36ec9ebe1455079f95e929f66d57">wrenchVec</a>[2](i) + 0.036598*<a class="code" href="classforce__controller_1_1controller.html#a1a3c36ec9ebe1455079f95e929f66d57">wrenchVec</a>[1](i) + 0.018299*<a class="code" href="classforce__controller_1_1controller.html#a1a3c36ec9ebe1455079f95e929f66d57">wrenchVec</a>[0](i) + 1.58255*<a class="code" href="classforce__controller_1_1controller.html#a05582c92fb4c89e7d0245c43536088f1">wrenchVecF</a>[1](i) - 0.65574*<a class="code" href="classforce__controller_1_1controller.html#a05582c92fb4c89e7d0245c43536088f1">wrenchVecF</a>[0](i);</div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;</div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;            <span class="comment">// Add new filtered result</span></div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;            <a class="code" href="classforce__controller_1_1controller.html#a05582c92fb4c89e7d0245c43536088f1">wrenchVecF</a>.push_back(temp);</div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;</div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;            <span class="comment">// Pop last value from these two structures to keep the size of the vector to 3 throughout</span></div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;            <a class="code" href="classforce__controller_1_1controller.html#a1a3c36ec9ebe1455079f95e929f66d57">wrenchVec</a>.pop_front();</div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;            <a class="code" href="classforce__controller_1_1controller.html#a05582c92fb4c89e7d0245c43536088f1">wrenchVecF</a>.pop_front();</div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;          }</div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;</div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;        <span class="comment">// Set filterd value to private member</span></div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0; i&lt;6; i++)</div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;          <a class="code" href="classforce__controller_1_1controller.html#a3bcf694aad91741d8826b087efc0d8cf">cur_data_f_</a>(i) = <a class="code" href="classforce__controller_1_1controller.html#a05582c92fb4c89e7d0245c43536088f1">wrenchVecF</a>[0](i);</div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;</div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;        geometry_msgs::WrenchStamped fw;</div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;        <span class="comment">// Time Stamp</span></div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;        fw.header.stamp = ros::Time::now();</div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;</div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;        <span class="comment">// Wrench</span></div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;        fw.wrench.force.x  = <a class="code" href="classforce__controller_1_1controller.html#a3bcf694aad91741d8826b087efc0d8cf">cur_data_f_</a>(0); </div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;        fw.wrench.force.y  = <a class="code" href="classforce__controller_1_1controller.html#a3bcf694aad91741d8826b087efc0d8cf">cur_data_f_</a>(1); </div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;        fw.wrench.force.z  = <a class="code" href="classforce__controller_1_1controller.html#a3bcf694aad91741d8826b087efc0d8cf">cur_data_f_</a>(2); </div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;        fw.wrench.torque.x = <a class="code" href="classforce__controller_1_1controller.html#a3bcf694aad91741d8826b087efc0d8cf">cur_data_f_</a>(3); </div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;        fw.wrench.torque.y = <a class="code" href="classforce__controller_1_1controller.html#a3bcf694aad91741d8826b087efc0d8cf">cur_data_f_</a>(4); </div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;        fw.wrench.torque.z = <a class="code" href="classforce__controller_1_1controller.html#a3bcf694aad91741d8826b087efc0d8cf">cur_data_f_</a>(5); </div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;</div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;        <span class="comment">// Republish. Leading to system crash..</span></div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="classforce__controller_1_1controller.html#a3f6c9ff42779a7285c563423081d21ac">filtered_wrench_pub_flag</a>)</div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;          {</div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;            <a class="code" href="classforce__controller_1_1controller.html#ad0625bce9d3236f29c4ec5296ed122a6">filtered_wrench_pub_</a>.publish(fw);</div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;            <span class="comment">// ROS_INFO_STREAM(&quot;Publishing the filtered wrench: &quot; &lt;&lt; fw.wrench &lt;&lt; std::endl);</span></div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;          }</div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;</div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;      }</div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;    </div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;    <span class="comment">// With async spinner calls force_controller</span></div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;    <span class="comment">// force_controller();</span></div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;  }</div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;</div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;  <span class="comment">//---------------------------------------------------------------------------------------------------------------------------------------------------------------------------</span></div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;  <span class="comment">// Callback to get wrench endpoint using Baxter&#39;s data. </span></div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;  <span class="comment">// 2 possible ways of getting the wrench endpoint:</span></div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;  <span class="comment">// Input: a baxter_core_msgs/EndPointState which contains a wrench with force/torque.</span></div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;  <span class="comment">// 1. Subscribe to the endpoint_state topic and get the wrench. </span></div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;  <span class="comment">// 2. Get joint torques (and the gravitational torque) and then compute the endpoint wrench. Can use an offset (computed a priori) that tries to cancel the noise in Baxter&#39;s arms.  // Places result in private member cur_data_</span></div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;  <span class="comment">// Also available is the choice to filter the data using a 2nd order low-pass filter.</span></div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;  <span class="comment">//---------------------------------------------------------------------------------------------------------------------------------------------------------------------------</span></div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;  <span class="keywordtype">void</span> <a class="code" href="classforce__controller_1_1controller.html#a0df9762be0629c3201524b5c15426c86">controller::getWrenchEndpoint</a>(<span class="keyword">const</span> baxter_core_msgs::EndpointStateConstPtr&amp; state)</div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;  {  </div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;    <span class="comment">// Local variables. Used in 2. </span></div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;    <span class="comment">// Eigen::Vector3d result = Eigen::Vector3d::Zero();</span></div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;    Eigen::VectorXd offset = <a class="code" href="classforce__controller_1_1controller.html#aa71c2771c7285ad804d022a9329b1d37">getTorqueOffset</a>(), realTorque; <span class="comment">// wrench; // Create 3 vectors: offset, realTorque, and wrench (force error). </span></div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;    Eigen::MatrixXd jacobian, JJt;</div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;</div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;    <span class="comment">// Assign the correct size for the vectors. </span></div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;    realTorque = Eigen::VectorXd::Zero(7);</div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;    <span class="comment">// wrench     = Eigen::VectorXd::Zero(6);</span></div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;    </div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;    <span class="comment">// This method should only be called if the joint angles have already been read. Hence:</span></div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;    <span class="comment">// if(jo_ready_)</span></div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;    <span class="comment">//   {</span></div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;</div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;    <span class="comment">// Select a method. False if you want a Jacobian computation for torques-&gt;wrench. True to get wrench from topic.</span></div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="classforce__controller_1_1controller.html#abd8b9a119755fa7119eb7fca73a085a8">wrench_sub_flag</a>) {</div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;      </div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;      <span class="comment">// Get the force and torque from the callback argument state</span></div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;      <a class="code" href="classforce__controller_1_1controller.html#a74ecf644e29bc65edd13e24f81ec3c36">cur_data_</a> &lt;&lt; state-&gt;wrench.force.x, state-&gt;wrench.force.y, state-&gt;wrench.force.z,</div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;        state-&gt;wrench.torque.x,state-&gt;wrench.torque.y,state-&gt;wrench.torque.z;</div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;</div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;      <span class="comment">// Offset Removal. TODO: Pending to do any such analysis, but it would go here.</span></div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;      <span class="comment">// </span></div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;    }</div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;</div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;    <span class="comment">// Convert from joint torques to wrench.</span></div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;    <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;      <span class="comment">// Real Torque = sensed torque - gravitational torque - modeled offset torque. </span></div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;      <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i&lt;7; i++)</div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;        realTorque(i) = <a class="code" href="classforce__controller_1_1controller.html#ae02baf2b659490f6df46f805ea5abfe8">torque_</a>[0][i] - <a class="code" href="classforce__controller_1_1controller.html#a94eb7de6ca36f137faa978bd92ab22d4">tg_</a>[0][i]; <span class="comment">// - offset(i);</span></div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;</div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;      <span class="comment">// Print offset and real torques</span></div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;      ROS_WARN_STREAM(<span class="stringliteral">&quot;Torque Offset is:\n--------------------\n&quot;</span> &lt;&lt; offset     &lt;&lt; <span class="stringliteral">&quot;\n--------------------\n&quot;</span>);</div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;      ROS_WARN_STREAM(<span class="stringliteral">&quot;Real Torque is:  \n--------------------\n&quot;</span> &lt;&lt; realTorque &lt;&lt; <span class="stringliteral">&quot;\n--------------------\n&quot;</span>);</div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;</div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;      <span class="comment">// Get Jacobian (input: joint angles and joint names, output is matrix). </span></div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;      <a class="code" href="classforce__controller_1_1controller.html#a8097c60da101a4be307ba2234da52ba3">kine_model_</a>-&gt;getJacobian(<a class="code" href="classforce__controller_1_1controller.html#afcbd0b56ca056d42a4b9838fde2fd0d2">joints_</a>[0], <a class="code" href="classforce__controller_1_1controller.html#a44c78f990df3a26aafe5ea5dd16debc4">joints_names_</a>, jacobian);</div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;</div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;      <span class="comment">// Preparing the Pseudo Inverse: </span></div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;      JJt = jacobian * jacobian.transpose();</div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;</div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;      <span class="comment">// Use the Jacobian Pseudo Inverse (Moore-Penrose Inverse) to compute the wrench.</span></div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;      <span class="comment">// Equation: (J&#39;J)^-1*J&#39; or J&#39;*(JJ&#39;)^-1</span></div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;      <span class="comment">// Note that in our case T=J&#39;e, so we need to use J&#39; instead of just J in the above equation.</span></div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;      <span class="comment">// Also, the Pseudo Inverse tends to have stability problems around singularities. A large change in joing angles will be produced, even for a small motion.  </span></div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;      <span class="comment">// Singularities represent directions of motion that the manipulator cannot achieve. Particulary in a straight arm configuration, or in the wrist when W1 aligns both W0 and W2. We can check for near singularities if the determinant is close to zero. At singular positions the Pseudo Inverse the matrix is well behaved.</span></div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;      <a class="code" href="classforce__controller_1_1controller.html#a74ecf644e29bc65edd13e24f81ec3c36">cur_data_</a> = (JJt.inverse()*jacobian) * realTorque;</div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;      ROS_INFO_STREAM(<span class="stringliteral">&quot;\n-------------------------------\nThe current wrench value is:\n-------------------------------\n&quot;</span> &lt;&lt; <a class="code" href="classforce__controller_1_1controller.html#a74ecf644e29bc65edd13e24f81ec3c36">cur_data_</a> &lt;&lt; <span class="stringliteral">&quot;\n-------------------------------\n&quot;</span>);</div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;      <span class="comment">// Use Eigen&#39;s least square approach: </span></div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;      <span class="comment">// wrench = Jacobian.jacobiSvd(Eigen::ComputeThinU | Eigen::ComputeThinV).solve(realTorque);</span></div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;      <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i&lt;6; i++)</div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;        {</div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;          <span class="keywordflow">if</span>(isnan(<a class="code" href="classforce__controller_1_1controller.html#a74ecf644e29bc65edd13e24f81ec3c36">cur_data_</a>(i)))</div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;            {</div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;              ROS_ERROR_STREAM(<span class="stringliteral">&quot;Failed to compute Jacobian Pseudo Inverse &quot;</span> &lt;&lt; <a class="code" href="classforce__controller_1_1controller.html#a74ecf644e29bc65edd13e24f81ec3c36">cur_data_</a>(i) &lt;&lt; <span class="stringliteral">&quot;, tor &quot;</span> &lt;&lt; realTorque &lt;&lt; <span class="stringliteral">&quot;, jac&quot;</span> &lt;&lt; jacobian &lt;&lt; <span class="stringliteral">&quot;, j &quot;</span> &lt;&lt; <a class="code" href="classforce__controller_1_1controller.html#afcbd0b56ca056d42a4b9838fde2fd0d2">joints_</a>[0][0]);</div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;              <span class="comment">// return cur_data_;</span></div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;            }</div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;        }</div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;    } <span class="comment">// End if-else for two methods.   </span></div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;</div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;    <span class="comment">/***************************************************************************** Filtering ************************************************************************************/</span></div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;    <span class="comment">// Create a vector or 6D Eigen vectors</span></div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;    Eigen::VectorXd temp = Eigen::VectorXd::Zero(6);    </div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;</div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="classforce__controller_1_1controller.html#af59fd764a51eb75822a0fe859f3c1a69">wrenchFilteringFlag</a>)</div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;      {</div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;        <span class="comment">// If this is the first loop we need to insert two rows with equal values as the current iteration for both wrenchVec and wrenchVecF</span></div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="classforce__controller_1_1controller.html#abfe080984202747089d707ae59a0b468">initialFiltering</a>)</div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;          {</div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;            <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0; i&lt;2; i++)</div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;              {</div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;                <span class="comment">// Input wrench at the end of the vector</span></div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;                <a class="code" href="classforce__controller_1_1controller.html#a1a3c36ec9ebe1455079f95e929f66d57">wrenchVec</a>.push_back(<a class="code" href="classforce__controller_1_1controller.html#a74ecf644e29bc65edd13e24f81ec3c36">cur_data_</a>);               </div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;</div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;                <span class="comment">// Filtered wrench at the end of the vector</span></div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;                <a class="code" href="classforce__controller_1_1controller.html#a05582c92fb4c89e7d0245c43536088f1">wrenchVecF</a>.push_back(<a class="code" href="classforce__controller_1_1controller.html#a74ecf644e29bc65edd13e24f81ec3c36">cur_data_</a>);</div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;              }</div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;            <span class="comment">// Change Flag</span></div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;            <a class="code" href="classforce__controller_1_1controller.html#abfe080984202747089d707ae59a0b468">initialFiltering</a>=<span class="keyword">false</span>;</div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;          }</div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;</div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;        <span class="comment">// Copy new data to wrenchVec at the end of the vector</span></div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;        <a class="code" href="classforce__controller_1_1controller.html#a1a3c36ec9ebe1455079f95e929f66d57">wrenchVec</a>.push_back(<a class="code" href="classforce__controller_1_1controller.html#a74ecf644e29bc65edd13e24f81ec3c36">cur_data_</a>);</div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;        </div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;        <span class="comment">// Assuming a vector of size(3:0,1,2) Element [2] is the current one (sitting at the back), element t-1 is [1], sitting in the middle, and element t-2 is[0]. </span></div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;        <span class="comment">// The indeces are opposite to what you think it should be. </span></div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0; i&lt;6; i++)</div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;          temp(i) = 0.018299*<a class="code" href="classforce__controller_1_1controller.html#a1a3c36ec9ebe1455079f95e929f66d57">wrenchVec</a>[2](i) + 0.036598*<a class="code" href="classforce__controller_1_1controller.html#a1a3c36ec9ebe1455079f95e929f66d57">wrenchVec</a>[1](i) + 0.018299*<a class="code" href="classforce__controller_1_1controller.html#a1a3c36ec9ebe1455079f95e929f66d57">wrenchVec</a>[0](i) + 1.58255*<a class="code" href="classforce__controller_1_1controller.html#a05582c92fb4c89e7d0245c43536088f1">wrenchVecF</a>[1](i) - 0.65574*<a class="code" href="classforce__controller_1_1controller.html#a05582c92fb4c89e7d0245c43536088f1">wrenchVecF</a>[0](i);</div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;</div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;        <span class="comment">// Add new filtered result</span></div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;        <a class="code" href="classforce__controller_1_1controller.html#a05582c92fb4c89e7d0245c43536088f1">wrenchVecF</a>.push_back(temp);</div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;</div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;        <span class="comment">// Pop last value from these two structures to keep the size of the vector to 3 throughout</span></div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;        <a class="code" href="classforce__controller_1_1controller.html#a1a3c36ec9ebe1455079f95e929f66d57">wrenchVec</a>.pop_front();</div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;        <a class="code" href="classforce__controller_1_1controller.html#a05582c92fb4c89e7d0245c43536088f1">wrenchVecF</a>.pop_front();</div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;      }</div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;</div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;    <span class="comment">// Set filterd value to private member</span></div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0; i&lt;6; i++)</div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;      <a class="code" href="classforce__controller_1_1controller.html#a3bcf694aad91741d8826b087efc0d8cf">cur_data_f_</a>(i) = <a class="code" href="classforce__controller_1_1controller.html#a05582c92fb4c89e7d0245c43536088f1">wrenchVecF</a>[0](i);</div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;</div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;    baxter_core_msgs::EndpointState fw;</div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;    <span class="comment">// Time Stamp</span></div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;    fw.header.stamp = ros::Time::now();</div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;</div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;    <span class="comment">// Wrench</span></div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;    fw.wrench.force.x  = <a class="code" href="classforce__controller_1_1controller.html#a3bcf694aad91741d8826b087efc0d8cf">cur_data_f_</a>(0); </div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;    fw.wrench.force.y  = <a class="code" href="classforce__controller_1_1controller.html#a3bcf694aad91741d8826b087efc0d8cf">cur_data_f_</a>(1); </div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;    fw.wrench.force.z  = <a class="code" href="classforce__controller_1_1controller.html#a3bcf694aad91741d8826b087efc0d8cf">cur_data_f_</a>(2); </div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;    fw.wrench.torque.x = <a class="code" href="classforce__controller_1_1controller.html#a3bcf694aad91741d8826b087efc0d8cf">cur_data_f_</a>(3); </div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;    fw.wrench.torque.y = <a class="code" href="classforce__controller_1_1controller.html#a3bcf694aad91741d8826b087efc0d8cf">cur_data_f_</a>(4); </div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;    fw.wrench.torque.z = <a class="code" href="classforce__controller_1_1controller.html#a3bcf694aad91741d8826b087efc0d8cf">cur_data_f_</a>(5); </div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;</div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;    <span class="comment">// Republish. Leading to system crash..</span></div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="classforce__controller_1_1controller.html#a3f6c9ff42779a7285c563423081d21ac">filtered_wrench_pub_flag</a>)</div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;      {</div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;        <a class="code" href="classforce__controller_1_1controller.html#ad0625bce9d3236f29c4ec5296ed122a6">filtered_wrench_pub_</a>.publish(fw);</div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;        <span class="comment">// ROS_INFO_STREAM(&quot;Publishing the filtered wrench: &quot; &lt;&lt; fw.wrench &lt;&lt; std::endl);</span></div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;      }</div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;</div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;    <span class="comment">//}</span></div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;  }</div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;</div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;  <span class="comment">//*****************************************************************************</span></div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;  <span class="comment">// getSetPoint(...)</span></div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;  <span class="comment">// Reads force_controller::setPoint which is structured as:</span></div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;  <span class="comment">// #Number of Controllers</span></div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;  <span class="comment">// int32 num_ctrls</span></div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;</div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;  <span class="comment">// # Type of dominant controller</span></div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;  <span class="comment">// string domType</span></div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;</div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;  <span class="comment">// # Desired force/moment (3D) for dominant controller</span></div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;  <span class="comment">// geometry_msgs/Vector3[] domDes</span></div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;</div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;  <span class="comment">// # Gains force/moment (3D) for dominant controller</span></div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;  <span class="comment">// geometry_msgs/Vector3[] domGains</span></div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;</div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;  <span class="comment">// # Type of subordinate controller</span></div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;  <span class="comment">// string subType</span></div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;</div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;  <span class="comment">// # Desired force/moment (3D) for subordinate controller</span></div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;  <span class="comment">// geometry_msgs/Vector3[] subDes</span></div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;</div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;  <span class="comment">// # Gains force/moment (3D) for subordinate controller</span></div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;  <span class="comment">// geometry_msgs/Vector3[] subGains</span></div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;  <span class="comment">//*****************************************************************************</span></div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;  <span class="keywordtype">void</span> <a class="code" href="classforce__controller_1_1controller.html#ae80a69dcc5062b11960925155323227a">controller::getSetPoint</a>(<span class="keyword">const</span> force_controller::setPointConstPtr&amp; sP)</div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;  {</div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;      <span class="comment">// Number of Controllers</span></div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;      <a class="code" href="classforce__controller_1_1controller.html#a20322e56e819a4ab067a14040f4e45ec">sP_</a>.num_ctrls=sP-&gt;num_ctrls;</div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;</div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;      <span class="keywordflow">if</span>(<a class="code" href="classforce__controller_1_1controller.html#a20322e56e819a4ab067a14040f4e45ec">sP_</a>.num_ctrls&lt;0 || <a class="code" href="classforce__controller_1_1controller.html#a20322e56e819a4ab067a14040f4e45ec">sP_</a>.num_ctrls&gt;2)</div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;        {</div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;          ROS_ERROR(<span class="stringliteral">&quot;The number of controllers seen in getSetPoint() is less than 0 or more than 2. We can only handle 1 or 2.&quot;</span>);</div>
<div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;        }</div>
<div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;</div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;      <span class="comment">// Dominant Controller data</span></div>
<div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;      <a class="code" href="classforce__controller_1_1controller.html#a20322e56e819a4ab067a14040f4e45ec">sP_</a>.domType =sP-&gt;domType;</div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;      <a class="code" href="classforce__controller_1_1controller.html#a20322e56e819a4ab067a14040f4e45ec">sP_</a>.domDes  =sP-&gt;domDes;   </div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;      <a class="code" href="classforce__controller_1_1controller.html#a20322e56e819a4ab067a14040f4e45ec">sP_</a>.domGains=sP-&gt;domGains; </div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;</div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;      <span class="comment">// Subordinate Controller data (if any)</span></div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;      <a class="code" href="classforce__controller_1_1controller.html#a20322e56e819a4ab067a14040f4e45ec">sP_</a>.subType =sP-&gt;subType;</div>
<div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;      <a class="code" href="classforce__controller_1_1controller.html#a20322e56e819a4ab067a14040f4e45ec">sP_</a>.subDes  =sP-&gt;subDes;</div>
<div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;      <a class="code" href="classforce__controller_1_1controller.html#a20322e56e819a4ab067a14040f4e45ec">sP_</a>.subGains=sP-&gt;subGains;</div>
<div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;  }</div>
<div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;  <span class="comment">//***************************************************************************************************************************************************</span></div>
<div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;  <span class="comment">// getBaxterJointState(...)</span></div>
<div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;  <span class="comment">// </span></div>
<div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;  <span class="comment">// This callback function works in hand with the subscription call joints_sub_ using the topic /robot/limb/&quot;side&quot;/gravity_compensation_torques</span></div>
<div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;  <span class="comment">// From this topic we obtain current joint angle positions, velocities, actual torques, and gravity_model_effort torques (compensation + hysteresis + crosstalk).</span></div>
<div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;  <span class="comment">// The type of the topic is: baxter_core_msgs::SEAJointState. It&#39;s strucutre which looks as follows:</span></div>
<div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;  <span class="comment">// ---</span></div>
<div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;  <span class="comment">//   std_msgs/Header header</span></div>
<div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;  <span class="comment">//   uint32 seq</span></div>
<div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;  <span class="comment">//   time stamp</span></div>
<div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;  <span class="comment">//   string frame_id</span></div>
<div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;  <span class="comment">//   string[] name</span></div>
<div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;  <span class="comment">//   ---</span></div>
<div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;  <span class="comment">//   float64[] commanded_position      </span></div>
<div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;  <span class="comment">//   float64[] commanded_velocity</span></div>
<div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;  <span class="comment">//   float64[] commanded_acceleration</span></div>
<div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;  <span class="comment">//   float64[] commanded_effort</span></div>
<div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;  <span class="comment">//   ---</span></div>
<div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;  <span class="comment">//   float64[] actual_position         // Current joint angle position in radians</span></div>
<div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;  <span class="comment">//   float64[] actual_velocity</span></div>
<div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;  <span class="comment">//   float64[] actual_effort           // This includes the inertial feed forward torques when applicable.</span></div>
<div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;  <span class="comment">//   float64[] gravity_model_effort    // This is the torque required to hold the arm against gravity returned by KDL if the arm was stationary.  </span></div>
<div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;  <span class="comment">//                                   // This does not include inertial feed forward torques (even when we have them) or any of the corrections (i.e. spring</span></div>
<div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;  <span class="comment">//   hysteresis, crosstalk, etc) we make to the KDL model.</span></div>
<div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;  <span class="comment">//   float64[] gravity_only</span></div>
<div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;  <span class="comment">//   float64[] hysteresis_model_effort</span></div>
<div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;  <span class="comment">//   float64[] crosstalk_model_effort</span></div>
<div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;  <span class="comment">//   float64 hystState</span></div>
<div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;  <span class="comment">//***************************************************************************************************************************************************</span></div>
<div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;  <span class="keywordtype">void</span> <a class="code" href="classforce__controller_1_1controller.html#a1db5f13c75b670b100085a1dba15cc57">controller::getBaxterJointState</a>(<span class="keyword">const</span> baxter_core_msgs::SEAJointStateConstPtr&amp; state)</div>
<div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;  {</div>
<div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;    <span class="comment">// Local variables</span></div>
<div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;    ros::Time t = ros::Time::now();</div>
<div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i, k=0;</div>
<div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;</div>
<div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;    <span class="comment">// Create Joint, Torque, and Gravitation values and filtered values. </span></div>
<div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;    std::vector&lt;double&gt; jt, jtf;    <span class="comment">// Joints and Filtered Joints</span></div>
<div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;    std::vector&lt;double&gt; jv, jvf;    <span class="comment">// Joint Velocities and Filtered Joint Velocities</span></div>
<div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;    std::vector&lt;double&gt; tt, tg;     <span class="comment">// Torques and Filtered Torques</span></div>
<div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;    std::vector&lt;double&gt; ttf, tgf;   <span class="comment">// Gravitational Torques and Filtered equivalents.</span></div>
<div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;</div>
<div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;    <span class="comment">// Joint Angles</span></div>
<div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;    jt.clear();         jtf.clear();</div>
<div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;    jt.resize(<a class="code" href="classforce__controller_1_1controller.html#a44c78f990df3a26aafe5ea5dd16debc4">joints_names_</a>.size());</div>
<div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;    jtf.resize(<a class="code" href="classforce__controller_1_1controller.html#a44c78f990df3a26aafe5ea5dd16debc4">joints_names_</a>.size());</div>
<div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;</div>
<div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;    <span class="comment">// Joint Velocities</span></div>
<div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;    jv.clear();   jvf.clear();</div>
<div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;    jv.resize(<a class="code" href="classforce__controller_1_1controller.html#a44c78f990df3a26aafe5ea5dd16debc4">joints_names_</a>.size());</div>
<div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;    jvf.resize(<a class="code" href="classforce__controller_1_1controller.html#a44c78f990df3a26aafe5ea5dd16debc4">joints_names_</a>.size());</div>
<div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;</div>
<div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;    <span class="comment">// Regular Torques</span></div>
<div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;    tt.resize(<a class="code" href="classforce__controller_1_1controller.html#a44c78f990df3a26aafe5ea5dd16debc4">joints_names_</a>.size());</div>
<div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;    ttf.resize(<a class="code" href="classforce__controller_1_1controller.html#a44c78f990df3a26aafe5ea5dd16debc4">joints_names_</a>.size());</div>
<div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;</div>
<div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;    <span class="comment">// Gravitational Torques</span></div>
<div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;    tg.resize(<a class="code" href="classforce__controller_1_1controller.html#a44c78f990df3a26aafe5ea5dd16debc4">joints_names_</a>.size());</div>
<div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;    tgf.resize(<a class="code" href="classforce__controller_1_1controller.html#a44c78f990df3a26aafe5ea5dd16debc4">joints_names_</a>.size());</div>
<div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;</div>
<div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;    <span class="comment">// Update the current joint values, actual effort, and gravity_model_effort values through the topic data.</span></div>
<div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;    ROS_INFO_ONCE(<span class="stringliteral">&quot;Initializing joints&quot;</span>);</div>
<div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="classforce__controller_1_1controller.html#aad5a334ce57bddf6d1b70bc8fd91ced2">exe_</a> &amp;&amp; <a class="code" href="classforce__controller_1_1controller.html#aeba991414fee13121c4acc5f63375ff9">save_</a>.is_open())</div>
<div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;      <a class="code" href="classforce__controller_1_1controller.html#aeba991414fee13121c4acc5f63375ff9">save_</a> &lt;&lt; (t - <a class="code" href="classforce__controller_1_1controller.html#a1ab1ccd76f056811dbe8e34397589423">to_</a>).toSec() &lt;&lt; <span class="stringliteral">&quot;   &quot;</span>; <span class="comment">// Convert time to seconds</span></div>
<div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;</div>
<div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;    <span class="comment">// For all of our 7 Joints</span></div>
<div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;    <span class="keywordflow">while</span>(k &lt; <a class="code" href="classforce__controller_1_1controller.html#a44c78f990df3a26aafe5ea5dd16debc4">joints_names_</a>.size())</div>
<div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;      {</div>
<div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;        <span class="comment">// And again for the 7 joints</span></div>
<div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;        <span class="keywordflow">for</span>(i=0; i&lt;state-&gt;name.size(); i++)</div>
<div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;          { <span class="comment">// Joints names order is: s0s1e0e1w0w1w2. The name list from the topic may not always be in this order. This is necessary to make sure we put the right value in the right place.            </span></div>
<div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;            <span class="keywordflow">if</span>(state-&gt;name[i] == <a class="code" href="classforce__controller_1_1controller.html#a44c78f990df3a26aafe5ea5dd16debc4">joints_names_</a>[k])</div>
<div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;              {</div>
<div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;                <span class="comment">// Get current joint angles</span></div>
<div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;                jt[k] = state-&gt;actual_position[i];</div>
<div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;</div>
<div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;                <span class="comment">// Get current joint Velocities</span></div>
<div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;                jv[k] = state-&gt;actual_velocity[i];</div>
<div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;</div>
<div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;                <span class="comment">// Get current joint torques</span></div>
<div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;                tt[k] = state-&gt;actual_effort[i];</div>
<div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;</div>
<div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;                <span class="comment">// Get current end-point gravitational torque </span></div>
<div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;                tg[k] = state-&gt;gravity_model_effort[i];</div>
<div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;</div>
<div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;                <span class="comment">// Save joint angle information</span></div>
<div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;                <span class="keywordflow">if</span>(<a class="code" href="classforce__controller_1_1controller.html#aad5a334ce57bddf6d1b70bc8fd91ced2">exe_</a> &amp;&amp; <a class="code" href="classforce__controller_1_1controller.html#aeba991414fee13121c4acc5f63375ff9">save_</a>.is_open())               </div>
<div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;                  <a class="code" href="classforce__controller_1_1controller.html#aeba991414fee13121c4acc5f63375ff9">save_</a> &lt;&lt; state-&gt;actual_position[i] &lt;&lt; <span class="stringliteral">&quot;       &quot;</span>;</div>
<div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;</div>
<div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;                k = k + 1;</div>
<div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;                <span class="keywordflow">if</span>(k == <a class="code" href="classforce__controller_1_1controller.html#a44c78f990df3a26aafe5ea5dd16debc4">joints_names_</a>.size())</div>
<div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;                  <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;              }</div>
<div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;          }</div>
<div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;      }</div>
<div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;</div>
<div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;    <span class="comment">// Make sure previous values are set before performing IIR filtering. </span></div>
<div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;    <span class="keywordflow">if</span>(!<a class="code" href="classforce__controller_1_1controller.html#a07d207a2bc65d08b555e0101b459bb1e">jo_ready_</a>)</div>
<div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;      {</div>
<div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;        <span class="comment">// Save current values into filtered parameters to start</span></div>
<div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i&lt;<a class="code" href="classforce__controller_1_1controller.html#a44c78f990df3a26aafe5ea5dd16debc4">joints_names_</a>.size(); i++)</div>
<div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;          {</div>
<div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;            ttf[i] = tt[i];</div>
<div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;            tgf[i] = tg[i];</div>
<div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;</div>
<div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;            <span class="comment">// Create previous (unfiltered) values</span></div>
<div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;            <a class="code" href="classforce__controller_1_1controller.html#aedbcede812ff8b7a120c69caa6626608">tm_t_1_</a>[i] = tt[i];</div>
<div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;            <a class="code" href="classforce__controller_1_1controller.html#aaf07c006e57ab9b427af5190999ac696">tg_t_1_</a>[i] = tg[i];</div>
<div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;            <a class="code" href="classforce__controller_1_1controller.html#afbce15b637b449428b68e6d3ae4aca9a">j_t_1_</a>[i]  = jt[i];</div>
<div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;            <a class="code" href="classforce__controller_1_1controller.html#a378293c954e789d133bdb273f1cc87b9">jv_t_1_</a>[i] = jv[i];</div>
<div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;          }</div>
<div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;</div>
<div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;        <span class="comment">// Push 2x!! (to create a 2nd order system) to private members before computing (lowpass) IIR Filtering</span></div>
<div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;        <a class="code" href="classforce__controller_1_1controller.html#ae02baf2b659490f6df46f805ea5abfe8">torque_</a>.push_back(<a class="code" href="classforce__controller_1_1controller.html#aedbcede812ff8b7a120c69caa6626608">tm_t_1_</a>);</div>
<div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;        <a class="code" href="classforce__controller_1_1controller.html#ae02baf2b659490f6df46f805ea5abfe8">torque_</a>.push_back(<a class="code" href="classforce__controller_1_1controller.html#aedbcede812ff8b7a120c69caa6626608">tm_t_1_</a>);</div>
<div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;        </div>
<div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;        tg_.push_back(<a class="code" href="classforce__controller_1_1controller.html#aaf07c006e57ab9b427af5190999ac696">tg_t_1_</a>);</div>
<div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;        tg_.push_back(<a class="code" href="classforce__controller_1_1controller.html#aaf07c006e57ab9b427af5190999ac696">tg_t_1_</a>);</div>
<div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;        </div>
<div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;        <a class="code" href="classforce__controller_1_1controller.html#afcbd0b56ca056d42a4b9838fde2fd0d2">joints_</a>.push_back(jt);</div>
<div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;        <a class="code" href="classforce__controller_1_1controller.html#afcbd0b56ca056d42a4b9838fde2fd0d2">joints_</a>.push_back(jt);</div>
<div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;</div>
<div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;        <a class="code" href="classforce__controller_1_1controller.html#a33ee1de76097f84b78cdf11f1f8e3514">velocity_</a>.push_back(jv);</div>
<div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;        <a class="code" href="classforce__controller_1_1controller.html#a33ee1de76097f84b78cdf11f1f8e3514">velocity_</a>.push_back(jv);</div>
<div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;        </div>
<div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;        <a class="code" href="classforce__controller_1_1controller.html#a07d207a2bc65d08b555e0101b459bb1e">jo_ready_</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;      }</div>
<div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;</div>
<div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;    <span class="comment">// IIR Low Pass Filter: create the filtered values.</span></div>
<div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i&lt;7; i++)</div>
<div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;      {</div>
<div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;        jtf[i] = 0.0784*<a class="code" href="classforce__controller_1_1controller.html#afbce15b637b449428b68e6d3ae4aca9a">j_t_1_</a>[i]  + 1.5622*<a class="code" href="classforce__controller_1_1controller.html#afcbd0b56ca056d42a4b9838fde2fd0d2">joints_</a>[0][i]   - 0.6413*<a class="code" href="classforce__controller_1_1controller.html#afcbd0b56ca056d42a4b9838fde2fd0d2">joints_</a>[1][i];</div>
<div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;        jvf[i] = 0.0784*<a class="code" href="classforce__controller_1_1controller.html#a378293c954e789d133bdb273f1cc87b9">jv_t_1_</a>[i] + 1.5622*<a class="code" href="classforce__controller_1_1controller.html#a33ee1de76097f84b78cdf11f1f8e3514">velocity_</a>[0][i] - 0.6413*<a class="code" href="classforce__controller_1_1controller.html#a33ee1de76097f84b78cdf11f1f8e3514">velocity_</a>[1][i];</div>
<div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;        ttf[i] = 0.0784*<a class="code" href="classforce__controller_1_1controller.html#aedbcede812ff8b7a120c69caa6626608">tm_t_1_</a>[i] + 1.5622*<a class="code" href="classforce__controller_1_1controller.html#ae02baf2b659490f6df46f805ea5abfe8">torque_</a>[0][i]   - 0.6413*<a class="code" href="classforce__controller_1_1controller.html#ae02baf2b659490f6df46f805ea5abfe8">torque_</a>[1][i];</div>
<div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;        tgf[i] = 0.0784*<a class="code" href="classforce__controller_1_1controller.html#aaf07c006e57ab9b427af5190999ac696">tg_t_1_</a>[i] + 1.5622*tg_[0][i]       - 0.6413*tg_[1][i];</div>
<div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;        </div>
<div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;        <a class="code" href="classforce__controller_1_1controller.html#afbce15b637b449428b68e6d3ae4aca9a">j_t_1_</a>[i]  = jt[i];</div>
<div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;        <a class="code" href="classforce__controller_1_1controller.html#a378293c954e789d133bdb273f1cc87b9">jv_t_1_</a>[i] = jv[i];</div>
<div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;        <a class="code" href="classforce__controller_1_1controller.html#aedbcede812ff8b7a120c69caa6626608">tm_t_1_</a>[i] = tt[i];</div>
<div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;        <a class="code" href="classforce__controller_1_1controller.html#aaf07c006e57ab9b427af5190999ac696">tg_t_1_</a>[i] = tg[i];</div>
<div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;</div>
<div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;        <span class="comment">// Save filtered value to private members</span></div>
<div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;        <a class="code" href="classforce__controller_1_1controller.html#afcbd0b56ca056d42a4b9838fde2fd0d2">joints_</a>[1][i]   = <a class="code" href="classforce__controller_1_1controller.html#afcbd0b56ca056d42a4b9838fde2fd0d2">joints_</a>[0][i];         <span class="comment">// Make index 1, older element</span></div>
<div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;        <a class="code" href="classforce__controller_1_1controller.html#afcbd0b56ca056d42a4b9838fde2fd0d2">joints_</a>[0][i]   = jtf[i];                <span class="comment">// Save filtered val to head of vec</span></div>
<div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;</div>
<div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;        <a class="code" href="classforce__controller_1_1controller.html#a33ee1de76097f84b78cdf11f1f8e3514">velocity_</a>[1][i] = <a class="code" href="classforce__controller_1_1controller.html#a33ee1de76097f84b78cdf11f1f8e3514">velocity_</a>[0][i];</div>
<div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;        <a class="code" href="classforce__controller_1_1controller.html#a33ee1de76097f84b78cdf11f1f8e3514">velocity_</a>[0][i] = jvf[i];        </div>
<div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;</div>
<div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;        <a class="code" href="classforce__controller_1_1controller.html#ae02baf2b659490f6df46f805ea5abfe8">torque_</a>[1][i] = <a class="code" href="classforce__controller_1_1controller.html#ae02baf2b659490f6df46f805ea5abfe8">torque_</a>[0][i];</div>
<div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;        <a class="code" href="classforce__controller_1_1controller.html#ae02baf2b659490f6df46f805ea5abfe8">torque_</a>[0][i] = ttf[i];</div>
<div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;</div>
<div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;        tg_[1][i]     = tg_[0][i];</div>
<div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;        tg_[0][i]     = tgf[i];</div>
<div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;      }</div>
<div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;</div>
<div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;    <span class="comment">// Save torque and gravitation torque info to file.</span></div>
<div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="classforce__controller_1_1controller.html#aad5a334ce57bddf6d1b70bc8fd91ced2">exe_</a> &amp;&amp; <a class="code" href="classforce__controller_1_1controller.html#aeba991414fee13121c4acc5f63375ff9">save_</a>.is_open())</div>
<div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;      {</div>
<div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> j=0; j&lt;<a class="code" href="classforce__controller_1_1controller.html#afcbd0b56ca056d42a4b9838fde2fd0d2">joints_</a>.size(); j++)</div>
<div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;          <a class="code" href="classforce__controller_1_1controller.html#aeba991414fee13121c4acc5f63375ff9">save_</a> &lt;&lt; tt[j] &lt;&lt; <span class="stringliteral">&quot;   &quot;</span>;</div>
<div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> j=0; j&lt;<a class="code" href="classforce__controller_1_1controller.html#afcbd0b56ca056d42a4b9838fde2fd0d2">joints_</a>.size(); j++)</div>
<div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;          <a class="code" href="classforce__controller_1_1controller.html#aeba991414fee13121c4acc5f63375ff9">save_</a> &lt;&lt; tg[j] &lt;&lt; <span class="stringliteral">&quot;   &quot;</span>;</div>
<div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;        <a class="code" href="classforce__controller_1_1controller.html#aeba991414fee13121c4acc5f63375ff9">save_</a> &lt;&lt; std::endl;</div>
<div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;      }</div>
<div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;</div>
<div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;    ROS_INFO_STREAM_ONCE(<span class="stringliteral">&quot;Joints updated for: &quot;</span> &lt;&lt; ttf[0] &lt;&lt; <span class="stringliteral">&quot;, &quot;</span>&lt;&lt; ttf[1] &lt;&lt; <span class="stringliteral">&quot;, &quot;</span>&lt;&lt; ttf[2]);</div>
<div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;  }</div>
<div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;</div>
<div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;  <span class="comment">//****************************************************************************************************</span></div>
<div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;  <span class="comment">// updateGains(...)</span></div>
<div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;  <span class="comment">// Used to update gains at run-time through the parameter server or through rqt_reconfigure.</span></div>
<div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;  <span class="comment">//****************************************************************************************************  </span></div>
<div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;  <span class="keywordtype">void</span> <a class="code" href="classforce__controller_1_1controller.html#ad724ead6daa0473b167d5d0696f6576e">controller::updateGains</a>(geometry_msgs::Vector3 gain, std::string type)</div>
<div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;  {</div>
<div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;    <span class="keywordflow">if</span>(type == <span class="stringliteral">&quot;force&quot;</span>)</div>
<div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;      {</div>
<div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;        <a class="code" href="classforce__controller_1_1controller.html#ae03abf03e53baed9003d928cc193d9f5">gFp_</a> = Eigen::Vector3d(gain.x, gain.y, gain.z);</div>
<div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="classforce__controller_1_1controller.html#ae03abf03e53baed9003d928cc193d9f5">gFp_</a>.sum()==0) <span class="comment">// If we cancel the gains, due the same for the deriv gains</span></div>
<div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;          {</div>
<div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;            <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0;i&lt;3;i++)</div>
<div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;              <a class="code" href="classforce__controller_1_1controller.html#a1d6e16a7f7273b1c917ef0195a6dbbf4">gFv_</a>(i)=0.0;</div>
<div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;          }</div>
<div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;      }</div>
<div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;</div>
<div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(type == <span class="stringliteral">&quot;moment&quot;</span>)</div>
<div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;      <a class="code" href="classforce__controller_1_1controller.html#a8d5c14a6b0a989328a531290dd30aba5">gMp_</a> = Eigen::Vector3d(gain.x, gain.y, gain.z);</div>
<div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;      ROS_WARN(<span class="stringliteral">&quot;Could not recognize type of controller, using default gain value&quot;</span>);</div>
<div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;  }</div>
<div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;</div>
<div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;  <span class="keywordtype">void</span> <a class="code" href="classforce__controller_1_1controller.html#ad724ead6daa0473b167d5d0696f6576e">controller::updateGains</a>() </div>
<div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;  {</div>
<div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;    <span class="comment">// Update with rqt_reconfigure updated parameters</span></div>
<div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;    <a class="code" href="classforce__controller_1_1controller.html#ae03abf03e53baed9003d928cc193d9f5">gFp_</a> &lt;&lt; <a class="code" href="namespaceforce__controller.html#ae69e9d55157a9e6d86bbb4988da3048f">k_fp0</a>, <a class="code" href="namespaceforce__controller.html#a5aeeda755261f55a0a7537cf084aae0b">k_fp1</a>, <a class="code" href="namespaceforce__controller.html#a5b3c2e286037742e79daaabd6d90eb2d">k_fp2</a>;</div>
<div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;    <a class="code" href="classforce__controller_1_1controller.html#a8d5c14a6b0a989328a531290dd30aba5">gMp_</a> &lt;&lt; <a class="code" href="namespaceforce__controller.html#aa5a1605f11362db37d087a8d641fa649">k_mp0</a>, <a class="code" href="namespaceforce__controller.html#a6143adbc6c88b5efcaeaee03278b7ea0">k_mp1</a>, <a class="code" href="namespaceforce__controller.html#a595af76feee2920c70e1e0d748d5947d">k_mp2</a>;</div>
<div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;</div>
<div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;    <span class="comment">// change the flag</span></div>
<div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;    <a class="code" href="namespaceforce__controller.html#a98b0f31330f4440a7743820ac112c0b5">force_error_constantsFlag</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;  }</div>
<div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;</div>
<div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;<span class="comment">/*********************************************** JacobianProduct ***********************************************************</span></div>
<div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;<span class="comment"> ** The Jacobian product can be computed using the pseudoinverse J#, or the Jacobian Transpose Jt in the case of position control</span></div>
<div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;<span class="comment"> ** and transpose in case of force/moment.</span></div>
<div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;<span class="comment"> ** The transpose is an approximation that can work if scaled appropriately.</span></div>
<div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;<span class="comment"> ** The latter is more stable that the pseudoinverse approach which struggles near singularities.</span></div>
<div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;<span class="comment"> **</span></div>
<div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;<span class="comment"> ** For a 6x7 non-square matrix:</span></div>
<div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;<span class="comment"> ** For position control:</span></div>
<div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;<span class="comment"> ** del_x = Jacobian * del_q</span></div>
<div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;<span class="comment"> ** dq = J# * del_x</span></div>
<div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;<span class="comment"> **</span></div>
<div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;<span class="comment"> ** For force control:</span></div>
<div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;<span class="comment"> ** dq=Jt * k* del_f </span></div>
<div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;<span class="comment"> **</span></div>
<div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;<span class="comment"> ** Note: Matrices use column-major indexing.</span></div>
<div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;<span class="comment"> *************************************************************************************************************************************/</span></div>
<div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;  <span class="keywordtype">bool</span> <a class="code" href="classforce__controller_1_1controller.html#a89d163d93c949add40d43dc6876f8f7f">controller::JacobianProduct</a>(<span class="comment">/*in*/</span> std::string type, <span class="comment">/*out*/</span>Eigen::VectorXd&amp; update)</div>
<div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;  {</div>
<div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;    <span class="comment">// Initializing a 6x7 jacobian and a 6D joint vector</span></div>
<div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;    Eigen::MatrixXd jacobian;                               <span class="comment">// Eigen defaults to storing the entry in column-major.</span></div>
<div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;    Eigen::VectorXd ke = Eigen::VectorXd::Zero(6), dqbis;</div>
<div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;</div>
<div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;    <span class="comment">// 1. Get the 6x7 Jacobian for Baxter. </span></div>
<div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;    <a class="code" href="classforce__controller_1_1controller.html#a8097c60da101a4be307ba2234da52ba3">kine_model_</a>-&gt;getJacobian(<a class="code" href="classforce__controller_1_1controller.html#afcbd0b56ca056d42a4b9838fde2fd0d2">joints_</a>[0], <a class="code" href="classforce__controller_1_1controller.html#a44c78f990df3a26aafe5ea5dd16debc4">joints_names_</a>, jacobian);</div>
<div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;</div>
<div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;    <span class="comment">// 2. Compute error x gain </span></div>
<div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;    <span class="keywordflow">if</span>(type == <span class="stringliteral">&quot;force&quot;</span>)</div>
<div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;      {</div>
<div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i&lt;3; i++)</div>
<div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;          ke(i) = <a class="code" href="classforce__controller_1_1controller.html#ae03abf03e53baed9003d928cc193d9f5">gFp_</a>(i)*<a class="code" href="classforce__controller_1_1controller.html#ac0a27412a2683f8a49bc00d5c1e5dc71">error_</a>(i) + <a class="code" href="classforce__controller_1_1controller.html#a1d6e16a7f7273b1c917ef0195a6dbbf4">gFv_</a>(i)*<a class="code" href="classforce__controller_1_1controller.html#a77574a80d7fa60f3430a0da033749fa6">derror_</a>(i);</div>
<div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;</div>
<div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;        <span class="comment">// Publish the error</span></div>
<div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="classforce__controller_1_1controller.html#a5357d27a499e0cf688e87e288501e8ef">wrench_error_pub_flag</a>)</div>
<div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;          {</div>
<div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;            geometry_msgs::Vector3 forceError;</div>
<div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;            forceError.x = ke(0);</div>
<div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;            forceError.y = ke(1);</div>
<div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;            forceError.z = ke(2);</div>
<div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;            <a class="code" href="classforce__controller_1_1controller.html#ab43040c1c59277906a1660bf18813f50">wrench_error_pub_</a>.publish(forceError);</div>
<div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;          }</div>
<div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;      }</div>
<div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(type == <span class="stringliteral">&quot;moment&quot;</span>)</div>
<div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;      {</div>
<div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i&lt;3; i++)</div>
<div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;          ke(i+3) = <a class="code" href="classforce__controller_1_1controller.html#a8d5c14a6b0a989328a531290dd30aba5">gMp_</a>(i)*<a class="code" href="classforce__controller_1_1controller.html#ac0a27412a2683f8a49bc00d5c1e5dc71">error_</a>(i+3);</div>
<div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;      }</div>
<div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;      {</div>
<div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;        ROS_ERROR(<span class="stringliteral">&quot;Could not recognize type of controller&quot;</span>);</div>
<div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;      }</div>
<div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;</div>
<div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;    <span class="comment">// 3. Compute the delta angles=Jt*(k*wrench_error). </span></div>
<div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;    dqbis = jacobian.transpose() * ke;</div>
<div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;</div>
<div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;    <span class="comment">// Copy to output form</span></div>
<div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;    update = dqbis;</div>
<div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;</div>
<div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;    <span class="comment">// Printout the delta joint angle update</span></div>
<div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;    ROS_INFO_STREAM(<span class="stringliteral">&quot;\n-------------------------------\nDelta Joint Angle Update qs:\n-------------------------------\n&quot;</span> &lt;&lt; update &lt;&lt; <span class="stringliteral">&quot;\n-------------------------------\n&quot;</span>);</div>
<div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;    <span class="comment">// Also publish the error here. </span></div>
<div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;    </div>
<div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;  }</div>
<div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;</div>
<div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;</div>
<div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;  <span class="comment">//*******************************************************************************************************</span></div>
<div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;  <span class="comment">// Same as above, but I want to multiply by the gains after the jacobian product to see if this makes any difference. So far in my testing, arm just moves to become straight. Does not seem to work. </span></div>
<div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;  <span class="comment">//*******************************************************************************************************</span></div>
<div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;  <span class="keywordtype">bool</span> <a class="code" href="classforce__controller_1_1controller.html#a245c6eec460f24b88c91c2ef355edf8c">controller::JacobianErrorProduct</a>(<span class="comment">/*in*/</span> std::string type, <span class="comment">/*out*/</span>Eigen::VectorXd&amp; update)</div>
<div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;  {</div>
<div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;    <span class="comment">// Initializing a 6x7 jacobian and a 6D joint vector</span></div>
<div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;    Eigen::MatrixXd jacobian;                               <span class="comment">// Eigen defaults to storing the entry in column-major.</span></div>
<div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;    Eigen::VectorXd dq = Eigen::VectorXd::Zero(6);</div>
<div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;    Eigen::VectorXd dq_scaled = Eigen::VectorXd::Zero(7);</div>
<div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;</div>
<div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;    <span class="comment">// 1. Get the 6x7 Jacobian for Baxter. </span></div>
<div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;    <a class="code" href="classforce__controller_1_1controller.html#a8097c60da101a4be307ba2234da52ba3">kine_model_</a>-&gt;getJacobian(<a class="code" href="classforce__controller_1_1controller.html#afcbd0b56ca056d42a4b9838fde2fd0d2">joints_</a>[0], <a class="code" href="classforce__controller_1_1controller.html#a44c78f990df3a26aafe5ea5dd16debc4">joints_names_</a>, jacobian);</div>
<div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;</div>
<div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;    <span class="comment">// 2. Compute the delta angles=Jt*(k*wrench_error). </span></div>
<div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;    dq = jacobian.transpose() * <a class="code" href="classforce__controller_1_1controller.html#ac0a27412a2683f8a49bc00d5c1e5dc71">error_</a>;</div>
<div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;</div>
<div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;    <span class="comment">// 3. Compute error x product </span></div>
<div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;    <span class="keywordflow">if</span>(type == <span class="stringliteral">&quot;force&quot;</span>)</div>
<div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;      {</div>
<div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;        <span class="comment">// for(unsigned int i=0; i&lt;3; i++)</span></div>
<div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;        dq_scaled = <a class="code" href="classforce__controller_1_1controller.html#ae03abf03e53baed9003d928cc193d9f5">gFp_</a>(0)*dq;<span class="comment">// gain * outoput of product (7x1)</span></div>
<div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;      }</div>
<div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(type == <span class="stringliteral">&quot;moment&quot;</span>)</div>
<div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;      {</div>
<div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i&lt;3; i++)</div>
<div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;          dq_scaled(i+3) = <a class="code" href="classforce__controller_1_1controller.html#a8d5c14a6b0a989328a531290dd30aba5">gMp_</a>(0)*dq(i+3);</div>
<div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;      }</div>
<div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;      {</div>
<div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;        ROS_ERROR(<span class="stringliteral">&quot;Could not recognize type of controller&quot;</span>);</div>
<div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;      }</div>
<div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;    </div>
<div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;    <span class="comment">// Copy to output form</span></div>
<div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;    update = dq_scaled;</div>
<div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;</div>
<div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;    <span class="comment">// Printout the delta joint angle update</span></div>
<div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;    ROS_INFO_STREAM(<span class="stringliteral">&quot;\n-------------------------------\nDelta Joint Angle Update qs:\n-------------------------------\n&quot;</span> &lt;&lt; update &lt;&lt; <span class="stringliteral">&quot;\n-------------------------------\n&quot;</span>);</div>
<div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;  </div>
<div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;}</div>
<div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;  <span class="comment">//************************************************************************************************************************************************************</span></div>
<div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;  <span class="comment">// computePrimitiveController(...)</span></div>
<div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;  <span class="comment">// Output: places commanded joint angles in update. </span></div>
<div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;  <span class="comment">//************************************************************************************************************************************************************</span></div>
<div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;  <span class="keywordtype">bool</span> <a class="code" href="classforce__controller_1_1controller.html#a4304907123cc54656c3743a11b50c86b">controller::computePrimitiveController</a>(Eigen::VectorXd&amp; update, std::string type, Eigen::Vector3d setPoint, std::vector&lt;double&gt;&amp; e)</div>
<div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;  {</div>
<div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;    <span class="comment">// Init: Set vectors for actual and goal data</span></div>
<div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;    Eigen::Vector3d curdata;</div>
<div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;    Eigen::VectorXd dq = Eigen::VectorXd::Zero(<a class="code" href="classforce__controller_1_1controller.html#afcbd0b56ca056d42a4b9838fde2fd0d2">joints_</a>[0].size());</div>
<div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;</div>
<div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;    <span class="comment">// 1. Current data is obtained from getWrenchEndpoint</span></div>
<div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;    curdata = <a class="code" href="classforce__controller_1_1controller.html#a625c711141ecd592a817cbf94a15bff5">extractWrench_Force_Moment</a>(type);</div>
<div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;</div>
<div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;    <span class="comment">// 2. Error between actual and desired wrench is computed, placed in error_</span></div>
<div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;    <a class="code" href="classforce__controller_1_1controller.html#a7d49b6e63d3b7cc1eb38839c3c4cf186">error_norm_</a> = <a class="code" href="classforce__controller_1_1controller.html#ae917a00a77a125122d98190c317cabc5">computeError</a>(type, curdata, setPoint);</div>
<div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;    e.push_back(<a class="code" href="classforce__controller_1_1controller.html#a7d49b6e63d3b7cc1eb38839c3c4cf186">error_norm_</a>);  <span class="comment">// Keep track of norm. Helps to identify direction of controller</span></div>
<div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;    ROS_ERROR_STREAM(<span class="stringliteral">&quot;Error Norm: &quot;</span> &lt;&lt; <a class="code" href="classforce__controller_1_1controller.html#a7d49b6e63d3b7cc1eb38839c3c4cf186">error_norm_</a>);</div>
<div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;        </div>
<div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;    <span class="comment">// 3. Compute the product of the error and the jacobian to produce the delta joint angle update placed in dq.</span></div>
<div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;    <span class="keywordflow">if</span>(!<a class="code" href="classforce__controller_1_1controller.html#a89d163d93c949add40d43dc6876f8f7f">JacobianProduct</a>(type, dq)) </div>
<div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;      {</div>
<div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;        ROS_ERROR(<span class="stringliteral">&quot;Could not get Jacobian&quot;</span>);</div>
<div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;      }</div>
<div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;</div>
<div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;    <span class="comment">// 4. Save the result as the first vector element of update.</span></div>
<div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;    <span class="comment">// update.push_back(dq);</span></div>
<div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;    update=dq;</div>
<div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;  }</div>
<div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;</div>
<div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;<span class="comment">/*******************************************************************************************************</span></div>
<div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;<span class="comment"> ** NullSpaceProjection()</span></div>
<div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;<span class="comment"> ** This function projects the output of the subordinate</span></div>
<div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;<span class="comment"> ** controller to the left null space of the dominant controller.</span></div>
<div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;<span class="comment"> ** It is important to note that the dominant output is the update</span></div>
<div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;<span class="comment"> ** produced by that controller but is not the updated position.</span></div>
<div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;<span class="comment"> ** Ie the update might be 0.4 degrees and the position might be 90.4 degrees.</span></div>
<div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;<span class="comment"> **</span></div>
<div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;<span class="comment"> ** We multiply AngleUpdate2 * null_space_matrix and</span></div>
<div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;<span class="comment"> ** place the result in NullSpaceProjMat</span></div>
<div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;<span class="comment"> **</span></div>
<div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;<span class="comment"> ** This controller consider a 6D/7D space, given that the input</span></div>
<div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;<span class="comment"> ** and output vectors will always be the change in joint</span></div>
<div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;<span class="comment"> ** coordinates, AngleUpdate2(q1,q2,q3,q4,q5,q6,q7).</span></div>
<div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;<span class="comment"> **</span></div>
<div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;<span class="comment"> ** From Platt&#39;s work, the null space operator, N, is defined as the moore-penrose generalized pseudoinverse:</span></div>
<div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;<span class="comment"> **</span></div>
<div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;<span class="comment"> ** N = I - [x_out * inv(x_out&#39; * x_out) * x_out&#39;]: that is, the identity - *outer product / inner product).</span></div>
<div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;<span class="comment"> ** From linear algebra the fraction of outer product/inner product is a projection unto the null space of the column space.</span></div>
<div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;<span class="comment"> ** When we subtract the identity from it, we are projecting on the perpendicular space, the left null space.</span></div>
<div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;<span class="comment"> **</span></div>
<div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;<span class="comment"> ** N = I - [ 1/(q1^2 + q2^2 + q3^2 + q4^2 + q5^2 + q6) * |q1^2 q1q2 q13 ... q1q6 |</span></div>
<div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;<span class="comment"> **                                                                                                             |q2q1 q2^2 ...     q2q6 |</span></div>
<div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;<span class="comment"> **                                                                                                             |q6q1  ... ...      q6^2|</span></div>
<div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;<span class="comment"> **</span></div>
<div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;<span class="comment"> ** Notice that the identity matrix is subtracted from</span></div>
<div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;<span class="comment"> ** the outer product normalized by the dot product of x_out.</span></div>
<div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;<span class="comment"> **</span></div>
<div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;<span class="comment"> ** Variables:</span></div>
<div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;<span class="comment"> **</span></div>
<div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;<span class="comment"> ** SPECIAL CASE: there may be a time where the dominant controller is all zeros</span></div>
<div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;<span class="comment"> ** If this is the case, we need to code the value of denominator to 1, otherwise</span></div>
<div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;<span class="comment"> ** there will be a division by zero.</span></div>
<div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;<span class="comment"> **</span></div>
<div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;<span class="comment"> ** Input:  updates is a vector with two eigen vector entries: [0] for the dominant controller and [1] for the subordiante controller.</span></div>
<div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;<span class="comment"> ** Output: a sensor_msgs::JointState structure with new angle update+current angles</span></div>
<div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;<span class="comment"> ********************************************************************************************************/</span></div>
<div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;  <span class="keywordtype">bool</span> <a class="code" href="classforce__controller_1_1controller.html#acf9fcb088200fd76c428ccfd8bac076c">controller::NullSpaceProjection</a>(std::vector&lt;Eigen::VectorXd&gt; updates, sensor_msgs::JointState&amp; dq)</div>
<div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;  {</div>
<div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;    Eigen::MatrixXd outer; outer.resize( <a class="code" href="classforce__controller_1_1controller.html#afcbd0b56ca056d42a4b9838fde2fd0d2">joints_</a>[0].size(),<a class="code" href="classforce__controller_1_1controller.html#afcbd0b56ca056d42a4b9838fde2fd0d2">joints_</a>[0].size() );</div>
<div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;    Eigen::VectorXd dq2 = Eigen::VectorXd::Zero(<a class="code" href="classforce__controller_1_1controller.html#afcbd0b56ca056d42a4b9838fde2fd0d2">joints_</a>[0].size());</div>
<div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;    Eigen::VectorXd dq1 = Eigen::VectorXd::Zero(<a class="code" href="classforce__controller_1_1controller.html#afcbd0b56ca056d42a4b9838fde2fd0d2">joints_</a>[0].size());</div>
<div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;</div>
<div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;    <span class="comment">// 1. Compute inner product</span></div>
<div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;    <span class="keywordtype">double</span> inner = updates[0].dot(updates[0]);</div>
<div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;    <span class="keywordflow">if</span>(inner==0)</div>
<div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;      inner = 1.0;</div>
<div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;</div>
<div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;    <span class="comment">// 2. Compute outer product</span></div>
<div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;    outer = (updates[0] * updates[0].transpose()) / inner;</div>
<div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;</div>
<div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;    <span class="comment">// Project output of subordinate controller on null space projection of dom ctrl</span></div>
<div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;    dq2 = (Eigen::MatrixXd::Identity(7, 7) - outer) * updates[1];</div>
<div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;</div>
<div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;    <span class="comment">// Add this project to current dominant controller output</span></div>
<div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i =0; i&lt;<a class="code" href="classforce__controller_1_1controller.html#afcbd0b56ca056d42a4b9838fde2fd0d2">joints_</a>[0].size(); i++)</div>
<div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;      {</div>
<div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;        dq1(i) = updates[0](i) + dq2(i);</div>
<div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;        <span class="keywordflow">if</span>( isnan(dq1(i)) )</div>
<div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;          {</div>
<div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;            ROS_ERROR(<span class="stringliteral">&quot;NAN value at joint: %s&quot;</span>, <a class="code" href="classforce__controller_1_1controller.html#a44c78f990df3a26aafe5ea5dd16debc4">joints_names_</a>[i].c_str());</div>
<div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;          }</div>
<div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;      }</div>
<div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;</div>
<div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;    <span class="comment">// Add this joint angle update to current robot joint angles using fill and place in sensor_msgs::JointState</span></div>
<div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;    dq = <a class="code" href="classforce__controller_1_1controller.html#a990c5d78efd81b20830728580a6dcccf">fill</a>(dq1);</div>
<div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;</div>
<div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;  }</div>
<div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;</div>
<div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;  <span class="comment">// ---------------------------------------------------------------------------</span></div>
<div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;  <span class="comment">// force_controller</span></div>
<div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;  <span class="comment">// computes end-effector force/moment errors for 1 or 2 controllers using the Jacobian Transpose. If there are 2 controllers, the output of the 2nd controller is projected unto the nullspace of the 1st controller. The joint angle update is added to the current angles and then passed to a position controller. The latter in turn has a smoothing filter that depends on variable alpha that can make the position response move to the goal more quickly or more slowly. We check to see if the move has reached its goal. If not we continue to publish to JointCommand to get closer as long as a timeout is not reached. This timeout is short ~ 1.5 second to seek reactivity.</span></div>
<div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;  <span class="comment">// ---------------------------------------------------------------------------</span></div>
<div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;  <span class="keywordtype">bool</span> <a class="code" href="classforce__controller_1_1controller.html#a795224933ca2ffe25a6da08677c24928">controller::force_controller</a>()</div>
<div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;  {</div>
<div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;      <span class="keywordflow">if</span>(<a class="code" href="classforce__controller_1_1controller.html#a07d207a2bc65d08b555e0101b459bb1e">jo_ready_</a>)</div>
<div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;        {</div>
<div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;          ROS_INFO(<span class="stringliteral">&quot;\n----------------------------Entering force controller----------------------------&quot;</span>);</div>
<div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;</div>
<div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;          <span class="comment">// Local variables</span></div>
<div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;          <span class="keywordtype">bool</span> <a class="code" href="classforce__controller_1_1controller.html#afcdcc566f70a5cba008e6d00085ac2d7">fin</a>= <span class="keyword">true</span>;</div>
<div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;          <span class="keywordtype">bool</span> ok = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;          std::vector&lt;double&gt; error, js;</div>
<div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;          std::vector&lt;Eigen::VectorXd&gt; dqs;</div>
<div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;</div>
<div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;          <span class="comment">// Set initial variables like time t0_=0.0</span></div>
<div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;          <span class="comment">// side_ = qd.header.frame_id;</span></div>
<div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;          <a class="code" href="classforce__controller_1_1controller.html#afa606d4f8538259f1d603e1a1591256b">initialize</a>();</div>
<div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;</div>
<div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;          <span class="comment">// Initialize vectors</span></div>
<div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;          js.resize(7);                    <span class="comment">// Will keep current 7 joint angles here</span></div>
<div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;          dqs.resize(2);                   <span class="comment">// To delta angle updates: dom and sub ctrlrs</span></div>
<div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;          dqs[0]=Eigen::VectorXd::Zero(7); <span class="comment">// TODO might want to change dqs to simply be an eigen vector. change the prototype of primitiveController and NullSpaceProjection. Is there a need for the vector and the history?</span></div>
<div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;          error.clear();</div>
<div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;</div>
<div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;          <span class="comment">// openFiles to write down data</span></div>
<div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;          <a class="code" href="classforce__controller_1_1controller.html#a45c90a45405b50bebd1db979bb4d61e6">openFiles</a>();</div>
<div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160; </div>
<div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;          <span class="comment">// A1. Check for gain updates:</span></div>
<div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;          <span class="comment">// From command line or roslaunch</span></div>
<div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;          <span class="keywordflow">if</span>(<a class="code" href="classforce__controller_1_1controller.html#a20322e56e819a4ab067a14040f4e45ec">sP_</a>.domGains.size()!=0)</div>
<div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;            <a class="code" href="classforce__controller_1_1controller.html#ad724ead6daa0473b167d5d0696f6576e">updateGains</a>(<a class="code" href="classforce__controller_1_1controller.html#a20322e56e819a4ab067a14040f4e45ec">sP_</a>.domGains[0],<a class="code" href="classforce__controller_1_1controller.html#a20322e56e819a4ab067a14040f4e45ec">sP_</a>.domType);</div>
<div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;          <span class="keywordflow">if</span>(<a class="code" href="classforce__controller_1_1controller.html#a20322e56e819a4ab067a14040f4e45ec">sP_</a>.subGains.size()!=0)</div>
<div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;            <a class="code" href="classforce__controller_1_1controller.html#ad724ead6daa0473b167d5d0696f6576e">updateGains</a>(<a class="code" href="classforce__controller_1_1controller.html#a20322e56e819a4ab067a14040f4e45ec">sP_</a>.subGains[0], <a class="code" href="classforce__controller_1_1controller.html#a20322e56e819a4ab067a14040f4e45ec">sP_</a>.subType);</div>
<div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;</div>
<div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;          <span class="comment">// Update from Dynamic Reconfigure GUI</span></div>
<div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;          <span class="keywordflow">if</span>(<a class="code" href="namespaceforce__controller.html#a98b0f31330f4440a7743820ac112c0b5">force_error_constantsFlag</a>)</div>
<div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;            <a class="code" href="classforce__controller_1_1controller.html#ad724ead6daa0473b167d5d0696f6576e">updateGains</a>();</div>
<div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;</div>
<div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;          <span class="comment">// Wait for the first joint angles readings. Otherwise cannot compute torques.</span></div>
<div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;          <span class="keywordflow">while</span>(!ok)</div>
<div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;            {</div>
<div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;              <span class="keywordflow">if</span>(<a class="code" href="classforce__controller_1_1controller.html#a07d207a2bc65d08b555e0101b459bb1e">jo_ready_</a>)</div>
<div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;                ok = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;            }</div>
<div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;</div>
<div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;          <span class="comment">// B. Call controllers. </span></div>
<div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;          <span class="comment">// As long as our norm is greater than the force error threshold, continue the computation.</span></div>
<div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;          <span class="keywordtype">string</span> type=<span class="stringliteral">&quot;&quot;</span>;</div>
<div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;          <span class="comment">//    do {</span></div>
<div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;          <span class="comment">// B1. Call primitive controllers. Store the delta joint angle update in dqs. </span></div>
<div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;          <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i&lt;<a class="code" href="classforce__controller_1_1controller.html#a20322e56e819a4ab067a14040f4e45ec">sP_</a>.num_ctrls; i++)</div>
<div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;            {</div>
<div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;              ROS_INFO(<span class="stringliteral">&quot;Calling primitive controller %d&quot;</span>, i);</div>
<div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;</div>
<div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;              <span class="comment">// Extract the force/moment setpoint</span></div>
<div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;              <span class="keywordflow">if</span>(i==0) </div>
<div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;                {</div>
<div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;                  type=<a class="code" href="classforce__controller_1_1controller.html#a20322e56e819a4ab067a14040f4e45ec">sP_</a>.domType;</div>
<div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;                  <a class="code" href="classforce__controller_1_1controller.html#aa071e951e19dd04f4d3c512af6cdc151">setPoint_</a>[i] &lt;&lt; <a class="code" href="classforce__controller_1_1controller.html#a20322e56e819a4ab067a14040f4e45ec">sP_</a>.domDes[0].x, <a class="code" href="classforce__controller_1_1controller.html#a20322e56e819a4ab067a14040f4e45ec">sP_</a>.domDes[0].y, <a class="code" href="classforce__controller_1_1controller.html#a20322e56e819a4ab067a14040f4e45ec">sP_</a>.domDes[0].z;</div>
<div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;                }</div>
<div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;              <span class="keywordflow">else</span></div>
<div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;                {</div>
<div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;                  type=<a class="code" href="classforce__controller_1_1controller.html#a20322e56e819a4ab067a14040f4e45ec">sP_</a>.subType;</div>
<div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;                  <a class="code" href="classforce__controller_1_1controller.html#aa071e951e19dd04f4d3c512af6cdc151">setPoint_</a>[i] &lt;&lt; <a class="code" href="classforce__controller_1_1controller.html#a20322e56e819a4ab067a14040f4e45ec">sP_</a>.subDes[0].x, <a class="code" href="classforce__controller_1_1controller.html#a20322e56e819a4ab067a14040f4e45ec">sP_</a>.subDes[0].y, <a class="code" href="classforce__controller_1_1controller.html#a20322e56e819a4ab067a14040f4e45ec">sP_</a>.subDes[0].z;</div>
<div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160;                }</div>
<div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160;</div>
<div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;</div>
<div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;              <span class="comment">// Takes vector of eigen&#39;s: setPoint_ as an input</span></div>
<div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;              <span class="comment">// Outputs a delta joint angle in vector of eigens dqs[i] and the error. </span></div>
<div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;              <span class="comment">// [0]=dominant controller, [1] = subordinate controller</span></div>
<div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;              <span class="keywordflow">if</span>(!<a class="code" href="classforce__controller_1_1controller.html#a4304907123cc54656c3743a11b50c86b">computePrimitiveController</a>(dqs[i], type, <a class="code" href="classforce__controller_1_1controller.html#aa071e951e19dd04f4d3c512af6cdc151">setPoint_</a>[i], error))</div>
<div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160;                {</div>
<div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160;                  ROS_ERROR(<span class="stringliteral">&quot;Could not compute angle update for type: %s&quot;</span>, type.c_str());</div>
<div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160;                  <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160;                }</div>
<div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160;            }</div>
<div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160;</div>
<div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160;          <span class="comment">// B2. 2 Controllers: call compound controllers</span></div>
<div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160;          <span class="keywordflow">if</span>(<a class="code" href="classforce__controller_1_1controller.html#a20322e56e819a4ab067a14040f4e45ec">sP_</a>.num_ctrls &gt; 1)</div>
<div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;            {</div>
<div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;              <span class="comment">// Take 2 angle updates in dqs. Project the subordinate update to the dominant ctrl&#39;s nullspace. </span></div>
<div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;              <span class="comment">// Places new angle update+current angles in the sensor_msgs::JointState update_angles_, ready to pass to position controller</span></div>
<div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160;              <span class="keywordflow">if</span>(!<a class="code" href="classforce__controller_1_1controller.html#acf9fcb088200fd76c428ccfd8bac076c">NullSpaceProjection</a>(dqs, <a class="code" href="classforce__controller_1_1controller.html#a6288902c0638f29ecb08ca8109a050bf">update_angles_</a>))</div>
<div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160;                {</div>
<div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;                  ROS_ERROR(<span class="stringliteral">&quot;Could not get null space projection&quot;</span>);</div>
<div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;                  <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;                }</div>
<div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;            }</div>
<div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;    </div>
<div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;          <span class="comment">// For only one (dominant controller) Add delta joint angles to current joint angles through fill, store in update_angles.position</span></div>
<div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160;          <span class="keywordflow">else</span></div>
<div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;            <a class="code" href="classforce__controller_1_1controller.html#a6288902c0638f29ecb08ca8109a050bf">update_angles_</a> = <a class="code" href="classforce__controller_1_1controller.html#a990c5d78efd81b20830728580a6dcccf">fill</a>(dqs[0]);         </div>
<div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160;</div>
<div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160;          <span class="comment">// C. Move to desired joint angle position through a positon or torque control loop</span></div>
<div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160;          <span class="keywordflow">if</span>(<a class="code" href="classforce__controller_1_1controller.html#a6e3d2f700e0f9faa10734d8d3ed9f14a">jntPos_Torque_InnerCtrl_Flag_</a>)   </div>
<div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160;            {</div>
<div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160;              <span class="comment">// // Publish positions directly here</span></div>
<div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160;              <span class="comment">// qgoal_.mode = qgoal_.POSITION_MODE;</span></div>
<div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160;              <span class="comment">// qgoal_.names = joints_names_;</span></div>
<div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160;              <span class="comment">// qgoal_.command.resize( 7 );</span></div>
<div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;              <span class="comment">// for(int i=0;i&lt;7;i++)</span></div>
<div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160;              <span class="comment">//   qgoal_.command[i]=update_angles_.position[i];</span></div>
<div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160;              <span class="comment">// joint_cmd_pub_.publish(qgoal_);        // NOV 8, TESTING IF WE DIRECTLY PUBLISH HOW ROBOT WILL RESPOND  </span></div>
<div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160;              </div>
<div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160;              fin=<a class="code" href="classforce__controller_1_1controller.html#a8a79843e5953f3a030f2d90ccf47aec9">position_controller</a>(<a class="code" href="classforce__controller_1_1controller.html#a6288902c0638f29ecb08ca8109a050bf">update_angles_</a>,<a class="code" href="classforce__controller_1_1controller.html#a1ab1ccd76f056811dbe8e34397589423">to_</a>); <span class="comment">// Position Controller</span></div>
<div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160;            }        </div>
<div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160;</div>
<div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160;          <span class="keywordflow">else</span> </div>
<div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160;            <a class="code" href="classforce__controller_1_1controller.html#ad54c67b3b4e11cf76ce6b42d9a805f46">torque_controller</a>(dqs[0],<a class="code" href="classforce__controller_1_1controller.html#a1ab1ccd76f056811dbe8e34397589423">to_</a>);              <span class="comment">// Torque Controller        </span></div>
<div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160;</div>
<div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160;          <span class="comment">// If position controller did not finish properly, exit, else continue the while loop.</span></div>
<div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160;          <span class="comment">// if(!fin)</span></div>
<div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160;          <span class="comment">//   break;</span></div>
<div class="line"><a name="l01183"></a><span class="lineno"> 1183</span>&#160;</div>
<div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&#160;          <span class="comment">// // Set frequency to </span></div>
<div class="line"><a name="l01185"></a><span class="lineno"> 1185</span>&#160;          <span class="comment">// loopRate.sleep();</span></div>
<div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160;          <span class="comment">// }  while(fin &amp;&amp; error_norm_ &gt; force_error_threshold_); // do while</span></div>
<div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160;          ROS_INFO_STREAM(<span class="stringliteral">&quot;isMoveFinish returns: &quot;</span> &lt;&lt; fin );</div>
<div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160;</div>
<div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160;          <span class="keywordflow">return</span> <a class="code" href="classforce__controller_1_1controller.html#afcdcc566f70a5cba008e6d00085ac2d7">fin</a>;   </div>
<div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;        }</div>
<div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160;  }</div>
<div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160;</div>
<div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160;  <span class="comment">//********************************************************************************************</span></div>
<div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160;  <span class="comment">// torque_controller(...)</span></div>
<div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160;  <span class="comment">// Compute error in wrench point, and then use the Jt and a gain to compute torque updates.</span></div>
<div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&#160;  <span class="comment">// Sent to /joint_command</span></div>
<div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160;  <span class="comment">//********************************************************************************************</span></div>
<div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160;  <span class="keywordtype">void</span> <a class="code" href="classforce__controller_1_1controller.html#ad54c67b3b4e11cf76ce6b42d9a805f46">controller::torque_controller</a>(Eigen::VectorXd delT, ros::Time t0)</div>
<div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160;    {</div>
<div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160;      <span class="keywordflow">if</span>(<a class="code" href="classforce__controller_1_1controller.html#a07d207a2bc65d08b555e0101b459bb1e">jo_ready_</a>)</div>
<div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160;        {</div>
<div class="line"><a name="l01204"></a><span class="lineno"> 1204</span>&#160;          <span class="comment">// Copy qd into goal_ and clear member qd_ </span></div>
<div class="line"><a name="l01205"></a><span class="lineno"> 1205</span>&#160;          <a class="code" href="classforce__controller_1_1controller.html#a46b3a1acc465f1f4453452eb672638d0">goal_</a>.clear();        <a class="code" href="classforce__controller_1_1controller.html#a8696bbcc2cde16bdd0f4c857e8fe5c07">qd_</a>.clear();                     <span class="comment">// goal_ is of type vector&lt;doubles&gt; </span></div>
<div class="line"><a name="l01206"></a><span class="lineno"> 1206</span>&#160;          <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i&lt;7; i++)</div>
<div class="line"><a name="l01207"></a><span class="lineno"> 1207</span>&#160;            <a class="code" href="classforce__controller_1_1controller.html#a46b3a1acc465f1f4453452eb672638d0">goal_</a>.push_back(delT[i]);</div>
<div class="line"><a name="l01208"></a><span class="lineno"> 1208</span>&#160;          <a class="code" href="classforce__controller_1_1controller.html#a8696bbcc2cde16bdd0f4c857e8fe5c07">qd_</a> = <a class="code" href="classforce__controller_1_1controller.html#a46b3a1acc465f1f4453452eb672638d0">goal_</a>;</div>
<div class="line"><a name="l01209"></a><span class="lineno"> 1209</span>&#160;</div>
<div class="line"><a name="l01210"></a><span class="lineno"> 1210</span>&#160;          <a class="code" href="classforce__controller_1_1controller.html#acba00b14e676b92bc19b966178c73a57">qgoal_</a>.mode = <a class="code" href="classforce__controller_1_1controller.html#acba00b14e676b92bc19b966178c73a57">qgoal_</a>.TORQUE_MODE;               <span class="comment">// qgoal is of type baxter_core_msgs/JointCommand. Consists of int mode, float[] name, float[] command.</span></div>
<div class="line"><a name="l01211"></a><span class="lineno"> 1211</span>&#160;          <a class="code" href="classforce__controller_1_1controller.html#acba00b14e676b92bc19b966178c73a57">qgoal_</a>.names = <a class="code" href="classforce__controller_1_1controller.html#a44c78f990df3a26aafe5ea5dd16debc4">joints_names_</a>;                   </div>
<div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160;          <a class="code" href="classforce__controller_1_1controller.html#acba00b14e676b92bc19b966178c73a57">qgoal_</a>.command.resize( <a class="code" href="classforce__controller_1_1controller.html#a46b3a1acc465f1f4453452eb672638d0">goal_</a>.size() );</div>
<div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160;</div>
<div class="line"><a name="l01214"></a><span class="lineno"> 1214</span>&#160;          <span class="comment">// Compute commanded torque: actual_torque - gravity_model_effort + delta torque.</span></div>
<div class="line"><a name="l01215"></a><span class="lineno"> 1215</span>&#160;          <span class="comment">// Notice that the first two are vectors, so we take the top vector elements.</span></div>
<div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160;          <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i&lt; <a class="code" href="classforce__controller_1_1controller.html#a46b3a1acc465f1f4453452eb672638d0">goal_</a>.size(); i++)</div>
<div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160;            <a class="code" href="classforce__controller_1_1controller.html#acba00b14e676b92bc19b966178c73a57">qgoal_</a>.command[i] = <a class="code" href="classforce__controller_1_1controller.html#ae02baf2b659490f6df46f805ea5abfe8">torque_</a>[0][i]-tg_[0][i]+delT[i]; <span class="comment">// Actual torque - gravity compensation (will be added) + delta </span></div>
<div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&#160;          <span class="comment">// qgoal_.command[i] = torque_[0][i]+delT[i]; // Trying with gravity compensation suppresed resulted in a fast and dangerous motion dropping the arm.</span></div>
<div class="line"><a name="l01219"></a><span class="lineno"> 1219</span>&#160;</div>
<div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160;          <span class="comment">// Get current time </span></div>
<div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160;          ros::Time tnow = ros::Time::now();</div>
<div class="line"><a name="l01222"></a><span class="lineno"> 1222</span>&#160;  </div>
<div class="line"><a name="l01223"></a><span class="lineno"> 1223</span>&#160;          <span class="comment">// Publish desired filtered joint angles (arm moves)</span></div>
<div class="line"><a name="l01224"></a><span class="lineno"> 1224</span>&#160;          ROS_INFO(<span class="stringliteral">&quot;Commanded torque is:\</span></div>
<div class="line"><a name="l01225"></a><span class="lineno"> 1225</span>&#160;<span class="stringliteral">              \n------------------------------\n&lt;%.4f,%.4f,%.4f,%.4f,%.4f,%.4f,%.4f&gt; at time: %f\n------------------------------\n&quot;</span>,</div>
<div class="line"><a name="l01226"></a><span class="lineno"> 1226</span>&#160;                   <a class="code" href="classforce__controller_1_1controller.html#acba00b14e676b92bc19b966178c73a57">qgoal_</a>.command[0],<a class="code" href="classforce__controller_1_1controller.html#acba00b14e676b92bc19b966178c73a57">qgoal_</a>.command[1],<a class="code" href="classforce__controller_1_1controller.html#acba00b14e676b92bc19b966178c73a57">qgoal_</a>.command[2],</div>
<div class="line"><a name="l01227"></a><span class="lineno"> 1227</span>&#160;                   <a class="code" href="classforce__controller_1_1controller.html#acba00b14e676b92bc19b966178c73a57">qgoal_</a>.command[3],<a class="code" href="classforce__controller_1_1controller.html#acba00b14e676b92bc19b966178c73a57">qgoal_</a>.command[4],<a class="code" href="classforce__controller_1_1controller.html#acba00b14e676b92bc19b966178c73a57">qgoal_</a>.command[5],</div>
<div class="line"><a name="l01228"></a><span class="lineno"> 1228</span>&#160;                   <a class="code" href="classforce__controller_1_1controller.html#acba00b14e676b92bc19b966178c73a57">qgoal_</a>.command[6],(tnow-t0).toSec());</div>
<div class="line"><a name="l01229"></a><span class="lineno"> 1229</span>&#160;</div>
<div class="line"><a name="l01230"></a><span class="lineno"> 1230</span>&#160;          <span class="comment">// Publish to the topic /robot/limb/right/joint_command. Baxter will move upon receiving this command. </span></div>
<div class="line"><a name="l01231"></a><span class="lineno"> 1231</span>&#160;          <a class="code" href="classforce__controller_1_1controller.html#aaea78103c35921c8632cfba6eff55324">joint_cmd_pub_</a>.publish(<a class="code" href="classforce__controller_1_1controller.html#acba00b14e676b92bc19b966178c73a57">qgoal_</a>);</div>
<div class="line"><a name="l01232"></a><span class="lineno"> 1232</span>&#160;          ROS_INFO(<span class="stringliteral">&quot;\n--------------------------------------------- Finished Moving the %s arm ---------------------------------------------\n\n&quot;</span>, side_.c_str());      </div>
<div class="line"><a name="l01233"></a><span class="lineno"> 1233</span>&#160;        }</div>
<div class="line"><a name="l01234"></a><span class="lineno"> 1234</span>&#160;    }</div>
<div class="line"><a name="l01235"></a><span class="lineno"> 1235</span>&#160;</div>
<div class="line"><a name="l01236"></a><span class="lineno"> 1236</span>&#160;  <span class="comment">//********************************************************************************************************************************************************************</span></div>
<div class="line"><a name="l01237"></a><span class="lineno"> 1237</span>&#160;  <span class="comment">// position_controller()</span></div>
<div class="line"><a name="l01238"></a><span class="lineno"> 1238</span>&#160;  <span class="comment">// Input: JointState qd is the refernce angles where we want to go. t0 is the initial time of the entire program in the ordered set: {s0,s1,e0,e1,w0,w1,w2}</span></div>
<div class="line"><a name="l01239"></a><span class="lineno"> 1239</span>&#160;  <span class="comment">// Try to move to the desired joint angles. This function originally devised in the position_control package. </span></div>
<div class="line"><a name="l01240"></a><span class="lineno"> 1240</span>&#160;  <span class="comment">// Input: </span></div>
<div class="line"><a name="l01241"></a><span class="lineno"> 1241</span>&#160;  <span class="comment">// - update_angles.position with desired updated positions </span></div>
<div class="line"><a name="l01242"></a><span class="lineno"> 1242</span>&#160;  <span class="comment">//********************************************************************************************************************************************************************</span></div>
<div class="line"><a name="l01243"></a><span class="lineno"> 1243</span>&#160;  <span class="keywordtype">bool</span> <a class="code" href="classforce__controller_1_1controller.html#a8a79843e5953f3a030f2d90ccf47aec9">controller::position_controller</a>(sensor_msgs::JointState qd, ros::Time t0)</div>
<div class="line"><a name="l01244"></a><span class="lineno"> 1244</span>&#160;  {</div>
<div class="line"><a name="l01245"></a><span class="lineno"> 1245</span>&#160;    <span class="comment">// Copy qd into goal_ and clear member qd_ </span></div>
<div class="line"><a name="l01246"></a><span class="lineno"> 1246</span>&#160;    <a class="code" href="classforce__controller_1_1controller.html#a46b3a1acc465f1f4453452eb672638d0">goal_</a>.clear();      <a class="code" href="classforce__controller_1_1controller.html#a8696bbcc2cde16bdd0f4c857e8fe5c07">qd_</a>.clear();                     <span class="comment">// goal_ is of type vector&lt;doubles&gt; </span></div>
<div class="line"><a name="l01247"></a><span class="lineno"> 1247</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i&lt;qd.position.size(); i++)</div>
<div class="line"><a name="l01248"></a><span class="lineno"> 1248</span>&#160;      <a class="code" href="classforce__controller_1_1controller.html#a46b3a1acc465f1f4453452eb672638d0">goal_</a>.push_back(qd.position[i]);               <span class="comment">// push back the reference angles. qd is JointStates and has a position[]</span></div>
<div class="line"><a name="l01249"></a><span class="lineno"> 1249</span>&#160;    <a class="code" href="classforce__controller_1_1controller.html#a8696bbcc2cde16bdd0f4c857e8fe5c07">qd_</a> = <a class="code" href="classforce__controller_1_1controller.html#a46b3a1acc465f1f4453452eb672638d0">goal_</a>;</div>
<div class="line"><a name="l01250"></a><span class="lineno"> 1250</span>&#160;</div>
<div class="line"><a name="l01251"></a><span class="lineno"> 1251</span>&#160;    <span class="comment">// Create a new variable qgoal in which we filter the joing angle between the current position joints_ and the goal position goal_. If alpha is 0, we send the goal directly, if alpha is 1, we stay in our current position. This filter has the effect of speeding up or slowing down the motion of the robot. </span></div>
<div class="line"><a name="l01252"></a><span class="lineno"> 1252</span>&#160;    <a class="code" href="classforce__controller_1_1controller.html#acba00b14e676b92bc19b966178c73a57">qgoal_</a>.mode = <a class="code" href="classforce__controller_1_1controller.html#acba00b14e676b92bc19b966178c73a57">qgoal_</a>.POSITION_MODE;              <span class="comment">// qgoal is of type baxter_core_msgs/JointCommand. Consists of int mode, float[] name, float[] command.</span></div>
<div class="line"><a name="l01253"></a><span class="lineno"> 1253</span>&#160;    <a class="code" href="classforce__controller_1_1controller.html#acba00b14e676b92bc19b966178c73a57">qgoal_</a>.names = <a class="code" href="classforce__controller_1_1controller.html#a44c78f990df3a26aafe5ea5dd16debc4">joints_names_</a>;                    <span class="comment">// Make sure that the order of these names is {s0,s1,e0,e1,w0,w1,w2}</span></div>
<div class="line"><a name="l01254"></a><span class="lineno"> 1254</span>&#160;    <a class="code" href="classforce__controller_1_1controller.html#acba00b14e676b92bc19b966178c73a57">qgoal_</a>.command.resize( <a class="code" href="classforce__controller_1_1controller.html#a46b3a1acc465f1f4453452eb672638d0">goal_</a>.size() );</div>
<div class="line"><a name="l01255"></a><span class="lineno"> 1255</span>&#160;</div>
<div class="line"><a name="l01256"></a><span class="lineno"> 1256</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i&lt; <a class="code" href="classforce__controller_1_1controller.html#a46b3a1acc465f1f4453452eb672638d0">goal_</a>.size(); i++)</div>
<div class="line"><a name="l01257"></a><span class="lineno"> 1257</span>&#160;      <a class="code" href="classforce__controller_1_1controller.html#acba00b14e676b92bc19b966178c73a57">qgoal_</a>.command[i] = ((1-alpha_)*<a class="code" href="classforce__controller_1_1controller.html#a46b3a1acc465f1f4453452eb672638d0">goal_</a>[i]) + (alpha_ * <a class="code" href="classforce__controller_1_1controller.html#afcbd0b56ca056d42a4b9838fde2fd0d2">joints_</a>[0][i]);</div>
<div class="line"><a name="l01258"></a><span class="lineno"> 1258</span>&#160;</div>
<div class="line"><a name="l01259"></a><span class="lineno"> 1259</span>&#160;    <span class="comment">// Get current time </span></div>
<div class="line"><a name="l01260"></a><span class="lineno"> 1260</span>&#160;    ros::Time tnow = ros::Time::now();</div>
<div class="line"><a name="l01261"></a><span class="lineno"> 1261</span>&#160;</div>
<div class="line"><a name="l01262"></a><span class="lineno"> 1262</span>&#160;    <span class="comment">// Internal Counter. Gets updated in while loop inside isMoveFinish()</span></div>
<div class="line"><a name="l01263"></a><span class="lineno"> 1263</span>&#160;    <a class="code" href="classforce__controller_1_1controller.html#acaf8797976b6bca1c3e3266beeecea05">n_</a> = 0;</div>
<div class="line"><a name="l01264"></a><span class="lineno"> 1264</span>&#160;</div>
<div class="line"><a name="l01265"></a><span class="lineno"> 1265</span>&#160;    <span class="comment">// Publish desired filtered joint angles (arm moves). The time is the diff from now to the beginning of the demo.</span></div>
<div class="line"><a name="l01266"></a><span class="lineno"> 1266</span>&#160;    ROS_INFO(<span class="stringliteral">&quot;Commanded Joint Angle:\</span></div>
<div class="line"><a name="l01267"></a><span class="lineno"> 1267</span>&#160;<span class="stringliteral">              \n------------------------------\n&lt;%.4f,%.4f,%.4f,%.4f,%.4f,%.4f,%.4f&gt; at time: %f\n------------------------------&quot;</span>,</div>
<div class="line"><a name="l01268"></a><span class="lineno"> 1268</span>&#160;             <a class="code" href="classforce__controller_1_1controller.html#acba00b14e676b92bc19b966178c73a57">qgoal_</a>.command[0],<a class="code" href="classforce__controller_1_1controller.html#acba00b14e676b92bc19b966178c73a57">qgoal_</a>.command[1],<a class="code" href="classforce__controller_1_1controller.html#acba00b14e676b92bc19b966178c73a57">qgoal_</a>.command[2],<a class="code" href="classforce__controller_1_1controller.html#acba00b14e676b92bc19b966178c73a57">qgoal_</a>.command[3],</div>
<div class="line"><a name="l01269"></a><span class="lineno"> 1269</span>&#160;             <a class="code" href="classforce__controller_1_1controller.html#acba00b14e676b92bc19b966178c73a57">qgoal_</a>.command[4],<a class="code" href="classforce__controller_1_1controller.html#acba00b14e676b92bc19b966178c73a57">qgoal_</a>.command[5],<a class="code" href="classforce__controller_1_1controller.html#acba00b14e676b92bc19b966178c73a57">qgoal_</a>.command[6],(tnow-t0).toSec());</div>
<div class="line"><a name="l01270"></a><span class="lineno"> 1270</span>&#160;</div>
<div class="line"><a name="l01271"></a><span class="lineno"> 1271</span>&#160;    <span class="comment">// Publish initial joint command (/robot/limb/right/joint_command).</span></div>
<div class="line"><a name="l01272"></a><span class="lineno"> 1272</span>&#160;    <a class="code" href="classforce__controller_1_1controller.html#aaea78103c35921c8632cfba6eff55324">joint_cmd_pub_</a>.publish(<a class="code" href="classforce__controller_1_1controller.html#acba00b14e676b92bc19b966178c73a57">qgoal_</a>);</div>
<div class="line"><a name="l01273"></a><span class="lineno"> 1273</span>&#160;    ros::Time begin       = ros::Time::now(); <span class="comment">// Get time of publiscation</span></div>
<div class="line"><a name="l01274"></a><span class="lineno"> 1274</span>&#160;    </div>
<div class="line"><a name="l01275"></a><span class="lineno"> 1275</span>&#160;    <span class="comment">// Check if goal is reached by calling isMoveFinish</span></div>
<div class="line"><a name="l01276"></a><span class="lineno"> 1276</span>&#160;    <span class="keywordtype">bool</span> cont, isFinished = <a class="code" href="classforce__controller_1_1controller.html#a10cec6c9dd7d935336d1aef4679924fb">isMoveFinish</a>(cont,begin); <span class="comment">// cont indicates whether we should continue, isFinished indicates whether we are finished.</span></div>
<div class="line"><a name="l01277"></a><span class="lineno"> 1277</span>&#160;    ROS_DEBUG_STREAM(<span class="stringliteral">&quot;isFinished=&quot;</span>&lt;&lt;isFinished&lt;&lt;std::endl);</div>
<div class="line"><a name="l01278"></a><span class="lineno"> 1278</span>&#160;    <span class="comment">// Set the position loop rate</span></div>
<div class="line"><a name="l01279"></a><span class="lineno"> 1279</span>&#160;    ros::Rate pos_rate(<a class="code" href="classforce__controller_1_1controller.html#af37d92322d83fc8c77d2f181b049c5a3">pos_while_loop_rate_</a>);</div>
<div class="line"><a name="l01280"></a><span class="lineno"> 1280</span>&#160;</div>
<div class="line"><a name="l01281"></a><span class="lineno"> 1281</span>&#160;    <span class="comment">// If not finished, keep looping until finished. </span></div>
<div class="line"><a name="l01282"></a><span class="lineno"> 1282</span>&#160;    <span class="keywordflow">while</span>(!isFinished &amp;&amp; <a class="code" href="classforce__controller_1_1controller.html#a78728db5683bf435c3766e4e2f68cf58">node_handle_</a>.ok())</div>
<div class="line"><a name="l01283"></a><span class="lineno"> 1283</span>&#160;      {</div>
<div class="line"><a name="l01284"></a><span class="lineno"> 1284</span>&#160;        <span class="comment">// Smoothing Filter: change goal to move more slowly or quickly</span></div>
<div class="line"><a name="l01285"></a><span class="lineno"> 1285</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i&lt;<a class="code" href="classforce__controller_1_1controller.html#a46b3a1acc465f1f4453452eb672638d0">goal_</a>.size(); i++)</div>
<div class="line"><a name="l01286"></a><span class="lineno"> 1286</span>&#160;          <a class="code" href="classforce__controller_1_1controller.html#acba00b14e676b92bc19b966178c73a57">qgoal_</a>.command[i] = ((1-alpha_)*<a class="code" href="classforce__controller_1_1controller.html#a46b3a1acc465f1f4453452eb672638d0">goal_</a>[i]) + (alpha_ * <a class="code" href="classforce__controller_1_1controller.html#acba00b14e676b92bc19b966178c73a57">qgoal_</a>.command[i]);     </div>
<div class="line"><a name="l01287"></a><span class="lineno"> 1287</span>&#160;     </div>
<div class="line"><a name="l01288"></a><span class="lineno"> 1288</span>&#160;        <span class="comment">// Print commanded joint angles again and their current time </span></div>
<div class="line"><a name="l01289"></a><span class="lineno"> 1289</span>&#160;        ros::Time tnow = ros::Time::now();</div>
<div class="line"><a name="l01290"></a><span class="lineno"> 1290</span>&#160;        ROS_INFO(<span class="stringliteral">&quot;Commanded Joint Angle:\</span></div>
<div class="line"><a name="l01291"></a><span class="lineno"> 1291</span>&#160;<span class="stringliteral">              \n------------------------------\n&lt;%.4f,%.4f,%.4f,%.4f,%.4f,%.4f,%.4f&gt; at time: %f\n------------------------------&quot;</span>,</div>
<div class="line"><a name="l01292"></a><span class="lineno"> 1292</span>&#160;             <a class="code" href="classforce__controller_1_1controller.html#acba00b14e676b92bc19b966178c73a57">qgoal_</a>.command[0],<a class="code" href="classforce__controller_1_1controller.html#acba00b14e676b92bc19b966178c73a57">qgoal_</a>.command[1],<a class="code" href="classforce__controller_1_1controller.html#acba00b14e676b92bc19b966178c73a57">qgoal_</a>.command[2],</div>
<div class="line"><a name="l01293"></a><span class="lineno"> 1293</span>&#160;             <a class="code" href="classforce__controller_1_1controller.html#acba00b14e676b92bc19b966178c73a57">qgoal_</a>.command[3],<a class="code" href="classforce__controller_1_1controller.html#acba00b14e676b92bc19b966178c73a57">qgoal_</a>.command[4],<a class="code" href="classforce__controller_1_1controller.html#acba00b14e676b92bc19b966178c73a57">qgoal_</a>.command[5],</div>
<div class="line"><a name="l01294"></a><span class="lineno"> 1294</span>&#160;             <a class="code" href="classforce__controller_1_1controller.html#acba00b14e676b92bc19b966178c73a57">qgoal_</a>.command[6],(tnow-t0).toSec());</div>
<div class="line"><a name="l01295"></a><span class="lineno"> 1295</span>&#160;</div>
<div class="line"><a name="l01296"></a><span class="lineno"> 1296</span>&#160;        <span class="comment">// Try to get closer and try again</span></div>
<div class="line"><a name="l01297"></a><span class="lineno"> 1297</span>&#160;        <a class="code" href="classforce__controller_1_1controller.html#aaea78103c35921c8632cfba6eff55324">joint_cmd_pub_</a>.publish(<a class="code" href="classforce__controller_1_1controller.html#acba00b14e676b92bc19b966178c73a57">qgoal_</a>);</div>
<div class="line"><a name="l01298"></a><span class="lineno"> 1298</span>&#160;        isFinished = <a class="code" href="classforce__controller_1_1controller.html#a10cec6c9dd7d935336d1aef4679924fb">isMoveFinish</a>(cont,begin);</div>
<div class="line"><a name="l01299"></a><span class="lineno"> 1299</span>&#160;        </div>
<div class="line"><a name="l01300"></a><span class="lineno"> 1300</span>&#160;        <span class="comment">// Control the Position Loop Rate</span></div>
<div class="line"><a name="l01301"></a><span class="lineno"> 1301</span>&#160;        pos_rate.sleep();</div>
<div class="line"><a name="l01302"></a><span class="lineno"> 1302</span>&#160;      }</div>
<div class="line"><a name="l01303"></a><span class="lineno"> 1303</span>&#160;</div>
<div class="line"><a name="l01304"></a><span class="lineno"> 1304</span>&#160;    <span class="comment">// Print error to screen</span></div>
<div class="line"><a name="l01305"></a><span class="lineno"> 1305</span>&#160;    ROS_WARN(<span class="stringliteral">&quot;The current joint position error is: %f, %f, %f, %f, %f, %f, %f&quot;</span>, </div>
<div class="line"><a name="l01306"></a><span class="lineno"> 1306</span>&#160;             <a class="code" href="classforce__controller_1_1controller.html#aaf2e5764f863e7e35c7c16793ae7e17d">qe_</a>[0],<a class="code" href="classforce__controller_1_1controller.html#aaf2e5764f863e7e35c7c16793ae7e17d">qe_</a>[1],<a class="code" href="classforce__controller_1_1controller.html#aaf2e5764f863e7e35c7c16793ae7e17d">qe_</a>[2],<a class="code" href="classforce__controller_1_1controller.html#aaf2e5764f863e7e35c7c16793ae7e17d">qe_</a>[3],<a class="code" href="classforce__controller_1_1controller.html#aaf2e5764f863e7e35c7c16793ae7e17d">qe_</a>[4],<a class="code" href="classforce__controller_1_1controller.html#aaf2e5764f863e7e35c7c16793ae7e17d">qe_</a>[5],<a class="code" href="classforce__controller_1_1controller.html#aaf2e5764f863e7e35c7c16793ae7e17d">qe_</a>[6]);</div>
<div class="line"><a name="l01307"></a><span class="lineno"> 1307</span>&#160;</div>
<div class="line"><a name="l01308"></a><span class="lineno"> 1308</span>&#160;   ROS_INFO(<span class="stringliteral">&quot;\n---------------------------------------------\nFinished Moving the %s arm\n---------------------------------------------\n&quot;</span>, side_.c_str());</div>
<div class="line"><a name="l01309"></a><span class="lineno"> 1309</span>&#160;    <span class="keywordflow">return</span> isFinished;</div>
<div class="line"><a name="l01310"></a><span class="lineno"> 1310</span>&#160;  }</div>
<div class="line"><a name="l01311"></a><span class="lineno"> 1311</span>&#160;</div>
<div class="line"><a name="l01312"></a><span class="lineno"> 1312</span>&#160;  <span class="comment">//*************************************************************************************************************************</span></div>
<div class="line"><a name="l01313"></a><span class="lineno"> 1313</span>&#160;  <span class="comment">// isMoveFinish(...)</span></div>
<div class="line"><a name="l01314"></a><span class="lineno"> 1314</span>&#160;  <span class="comment">// Input:  outgoing boolean to determine if we should CONTINUE this function. </span></div>
<div class="line"><a name="l01315"></a><span class="lineno"> 1315</span>&#160;  <span class="comment">// Output: boolean output to determine if we have reached our goal or FINISHED.</span></div>
<div class="line"><a name="l01316"></a><span class="lineno"> 1316</span>&#160;  <span class="comment">// </span></div>
<div class="line"><a name="l01317"></a><span class="lineno"> 1317</span>&#160;  <span class="comment">// Check to see if the arm has finished moving to desired joint angle position. This function is called at a given rate according to ros duration. </span></div>
<div class="line"><a name="l01318"></a><span class="lineno"> 1318</span>&#160;  <span class="comment">// Uses qgoal_ which is originally set in the force_controller. It&#39;s of type baxter_core_msgs/JointCommand and contains a mode, command[], and names[].</span></div>
<div class="line"><a name="l01319"></a><span class="lineno"> 1319</span>&#160;  <span class="comment">//*************************************************************************************************************************</span></div>
<div class="line"><a name="l01320"></a><span class="lineno"><a class="line" href="classforce__controller_1_1controller.html#ac71d9d54bdce9d451968baeeac939373"> 1320</a></span>&#160;  <span class="keywordtype">bool</span> <a class="code" href="classforce__controller_1_1controller.html#a10cec6c9dd7d935336d1aef4679924fb">controller::isMoveFinish</a>(<span class="comment">/*out*/</span><span class="keywordtype">bool</span>&amp; cont, ros::Time begin)</div>
<div class="line"><a name="l01321"></a><span class="lineno"> 1321</span>&#160;  {  </div>
<div class="line"><a name="l01322"></a><span class="lineno"> 1322</span>&#160;    <span class="keywordtype">double</span> max=0.0;</div>
<div class="line"><a name="l01323"></a><span class="lineno"> 1323</span>&#160;    std::vector&lt;double&gt; error; error.clear();</div>
<div class="line"><a name="l01324"></a><span class="lineno"> 1324</span>&#160;    </div>
<div class="line"><a name="l01325"></a><span class="lineno"> 1325</span>&#160;    <span class="comment">// Start counter: used to measure how many times we attempt to move before reaching the goal.</span></div>
<div class="line"><a name="l01326"></a><span class="lineno"> 1326</span>&#160;    <a class="code" href="classforce__controller_1_1controller.html#acaf8797976b6bca1c3e3266beeecea05">n_</a> = <a class="code" href="classforce__controller_1_1controller.html#acaf8797976b6bca1c3e3266beeecea05">n_</a> + 1;</div>
<div class="line"><a name="l01327"></a><span class="lineno"> 1327</span>&#160;</div>
<div class="line"><a name="l01328"></a><span class="lineno"> 1328</span>&#160;    <span class="comment">// For the first 5 tries, set the false. Helps to avoid early computation errors associated with ros communication.</span></div>
<div class="line"><a name="l01329"></a><span class="lineno"> 1329</span>&#160;    <span class="keywordflow">if</span>( <a class="code" href="classforce__controller_1_1controller.html#acaf8797976b6bca1c3e3266beeecea05">n_</a>!=0  &amp;&amp;  (<a class="code" href="classforce__controller_1_1controller.html#acaf8797976b6bca1c3e3266beeecea05">n_</a> % 5 != 0) )  </div>
<div class="line"><a name="l01330"></a><span class="lineno"> 1330</span>&#160;      {</div>
<div class="line"><a name="l01331"></a><span class="lineno"> 1331</span>&#160;        cont = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01332"></a><span class="lineno"> 1332</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01333"></a><span class="lineno"> 1333</span>&#160;      }</div>
<div class="line"><a name="l01334"></a><span class="lineno"> 1334</span>&#160;</div>
<div class="line"><a name="l01335"></a><span class="lineno"> 1335</span>&#160;    <span class="comment">// Record maximum error across all joints.</span></div>
<div class="line"><a name="l01336"></a><span class="lineno"> 1336</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i&lt;<a class="code" href="classforce__controller_1_1controller.html#afcbd0b56ca056d42a4b9838fde2fd0d2">joints_</a>[0].size(); i++)</div>
<div class="line"><a name="l01337"></a><span class="lineno"> 1337</span>&#160;      {</div>
<div class="line"><a name="l01338"></a><span class="lineno"> 1338</span>&#160;        <span class="comment">// Joint error between current position and our qgoal_ var (filtered goal var)</span></div>
<div class="line"><a name="l01339"></a><span class="lineno"> 1339</span>&#160;        error.push_back( <a class="code" href="classforce__controller_1_1controller.html#afcbd0b56ca056d42a4b9838fde2fd0d2">joints_</a>[0][i] - <a class="code" href="classforce__controller_1_1controller.html#a8696bbcc2cde16bdd0f4c857e8fe5c07">qd_</a>[i] );</div>
<div class="line"><a name="l01340"></a><span class="lineno"> 1340</span>&#160;</div>
<div class="line"><a name="l01341"></a><span class="lineno"> 1341</span>&#160;        <span class="comment">// Update position error threshold</span></div>
<div class="line"><a name="l01342"></a><span class="lineno"> 1342</span>&#160;        <span class="keywordflow">if</span> ( fabs(error.back()) &gt; max)</div>
<div class="line"><a name="l01343"></a><span class="lineno"> 1343</span>&#160;          max = error.back();</div>
<div class="line"><a name="l01344"></a><span class="lineno"> 1344</span>&#160;      }</div>
<div class="line"><a name="l01345"></a><span class="lineno"> 1345</span>&#160;</div>
<div class="line"><a name="l01346"></a><span class="lineno"> 1346</span>&#160;    ROS_INFO_STREAM(<span class="stringliteral">&quot;Joint Errors are: &quot;</span> &lt;&lt; error.back() &lt;&lt; std::endl);</div>
<div class="line"><a name="l01347"></a><span class="lineno"> 1347</span>&#160;</div>
<div class="line"><a name="l01348"></a><span class="lineno"> 1348</span>&#160;    <span class="comment">// Copy the reference qgoal_ to a local varaible q[i]. </span></div>
<div class="line"><a name="l01349"></a><span class="lineno"> 1349</span>&#160;    <span class="comment">// Test if error is going down for each joint.</span></div>
<div class="line"><a name="l01350"></a><span class="lineno"> 1350</span>&#160;    <span class="keywordtype">int</span> ok=0, keep=0, k=0; <span class="comment">// keep: means joints have not reached goal, ie keep trying.</span></div>
<div class="line"><a name="l01351"></a><span class="lineno"> 1351</span>&#160;</div>
<div class="line"><a name="l01352"></a><span class="lineno"> 1352</span>&#160;    std::vector&lt;double&gt; q;</div>
<div class="line"><a name="l01353"></a><span class="lineno"> 1353</span>&#160;    q.clear();  q.resize(<a class="code" href="classforce__controller_1_1controller.html#a44c78f990df3a26aafe5ea5dd16debc4">joints_names_</a>.size()); </div>
<div class="line"><a name="l01354"></a><span class="lineno"> 1354</span>&#160;    <span class="keywordtype">bool</span> copy;</div>
<div class="line"><a name="l01355"></a><span class="lineno"> 1355</span>&#160;</div>
<div class="line"><a name="l01356"></a><span class="lineno"> 1356</span>&#160;    <span class="comment">// Mechanism to either copy current joint angles or goal.</span></div>
<div class="line"><a name="l01357"></a><span class="lineno"> 1357</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i &lt; <a class="code" href="classforce__controller_1_1controller.html#a44c78f990df3a26aafe5ea5dd16debc4">joints_names_</a>.size(); i++)</div>
<div class="line"><a name="l01358"></a><span class="lineno"> 1358</span>&#160;      {</div>
<div class="line"><a name="l01359"></a><span class="lineno"> 1359</span>&#160;        copy = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01360"></a><span class="lineno"> 1360</span>&#160;        <span class="comment">// Copy goal</span></div>
<div class="line"><a name="l01361"></a><span class="lineno"> 1361</span>&#160;        <span class="keywordflow">if</span>( k &lt; <a class="code" href="classforce__controller_1_1controller.html#acba00b14e676b92bc19b966178c73a57">qgoal_</a>.names.size() )</div>
<div class="line"><a name="l01362"></a><span class="lineno"> 1362</span>&#160;          {</div>
<div class="line"><a name="l01363"></a><span class="lineno"> 1363</span>&#160;            <span class="comment">// Only do the following when both names match. Ensures right order.</span></div>
<div class="line"><a name="l01364"></a><span class="lineno"> 1364</span>&#160;            <span class="keywordflow">if</span>(<a class="code" href="classforce__controller_1_1controller.html#acba00b14e676b92bc19b966178c73a57">qgoal_</a>.names[k] == <a class="code" href="classforce__controller_1_1controller.html#a44c78f990df3a26aafe5ea5dd16debc4">joints_names_</a>[i]) </div>
<div class="line"><a name="l01365"></a><span class="lineno"> 1365</span>&#160;              {</div>
<div class="line"><a name="l01366"></a><span class="lineno"> 1366</span>&#160;                q[i] = <a class="code" href="classforce__controller_1_1controller.html#acba00b14e676b92bc19b966178c73a57">qgoal_</a>.command[k]; </div>
<div class="line"><a name="l01367"></a><span class="lineno"> 1367</span>&#160;                k = k + 1;</div>
<div class="line"><a name="l01368"></a><span class="lineno"> 1368</span>&#160;                copy = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01369"></a><span class="lineno"> 1369</span>&#160;              }</div>
<div class="line"><a name="l01370"></a><span class="lineno"> 1370</span>&#160;          }</div>
<div class="line"><a name="l01371"></a><span class="lineno"> 1371</span>&#160;        </div>
<div class="line"><a name="l01372"></a><span class="lineno"> 1372</span>&#160;        <span class="comment">// Copy current joint angles only if goal info has been copied</span></div>
<div class="line"><a name="l01373"></a><span class="lineno"> 1373</span>&#160;        <span class="keywordflow">if</span>(copy)</div>
<div class="line"><a name="l01374"></a><span class="lineno"> 1374</span>&#160;          q[i] = <a class="code" href="classforce__controller_1_1controller.html#afcbd0b56ca056d42a4b9838fde2fd0d2">joints_</a>[0][i];</div>
<div class="line"><a name="l01375"></a><span class="lineno"> 1375</span>&#160;      } </div>
<div class="line"><a name="l01376"></a><span class="lineno"> 1376</span>&#160;</div>
<div class="line"><a name="l01377"></a><span class="lineno"> 1377</span>&#160;    <span class="comment">// Completely clear our reference goal joint names and command angles.</span></div>
<div class="line"><a name="l01378"></a><span class="lineno"> 1378</span>&#160;    <a class="code" href="classforce__controller_1_1controller.html#acba00b14e676b92bc19b966178c73a57">qgoal_</a>.names.clear();</div>
<div class="line"><a name="l01379"></a><span class="lineno"> 1379</span>&#160;    <a class="code" href="classforce__controller_1_1controller.html#acba00b14e676b92bc19b966178c73a57">qgoal_</a>.command.clear();</div>
<div class="line"><a name="l01380"></a><span class="lineno"> 1380</span>&#160;</div>
<div class="line"><a name="l01381"></a><span class="lineno"> 1381</span>&#160;    <span class="comment">// Have a new local variable goal be readied.</span></div>
<div class="line"><a name="l01382"></a><span class="lineno"> 1382</span>&#160;    <a class="code" href="classforce__controller_1_1controller.html#a46b3a1acc465f1f4453452eb672638d0">goal_</a>.clear();</div>
<div class="line"><a name="l01383"></a><span class="lineno"> 1383</span>&#160;    </div>
<div class="line"><a name="l01384"></a><span class="lineno"> 1384</span>&#160;    <span class="comment">// If error &gt; tolerance (test for each joint), set qgoal again. </span></div>
<div class="line"><a name="l01385"></a><span class="lineno"> 1385</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i&lt;<a class="code" href="classforce__controller_1_1controller.html#afcbd0b56ca056d42a4b9838fde2fd0d2">joints_</a>[0].size(); i++)</div>
<div class="line"><a name="l01386"></a><span class="lineno"> 1386</span>&#160;      {        </div>
<div class="line"><a name="l01387"></a><span class="lineno"> 1387</span>&#160;        <span class="comment">// If Joint Position Error is greater than tolearnce, do again. </span></div>
<div class="line"><a name="l01388"></a><span class="lineno"> 1388</span>&#160;        <span class="keywordflow">if</span>( fabs(error[i]) &gt; <a class="code" href="classforce__controller_1_1controller.html#a29c199c16b81807932247d37b361b795">tolerance_</a>)         <span class="comment">// Tolerance comes from precision parameter (launch file/constructor value).</span></div>
<div class="line"><a name="l01389"></a><span class="lineno"> 1389</span>&#160;          {</div>
<div class="line"><a name="l01390"></a><span class="lineno"> 1390</span>&#160;            <a class="code" href="classforce__controller_1_1controller.html#acba00b14e676b92bc19b966178c73a57">qgoal_</a>.names.push_back( <a class="code" href="classforce__controller_1_1controller.html#a44c78f990df3a26aafe5ea5dd16debc4">joints_names_</a>[i] );</div>
<div class="line"><a name="l01391"></a><span class="lineno"> 1391</span>&#160;            <a class="code" href="classforce__controller_1_1controller.html#acba00b14e676b92bc19b966178c73a57">qgoal_</a>.command.push_back(q[i]);      <span class="comment">// Adjusted in previous for/if loop</span></div>
<div class="line"><a name="l01392"></a><span class="lineno"> 1392</span>&#160;            <a class="code" href="classforce__controller_1_1controller.html#a46b3a1acc465f1f4453452eb672638d0">goal_</a>.push_back(<a class="code" href="classforce__controller_1_1controller.html#a8696bbcc2cde16bdd0f4c857e8fe5c07">qd_</a>[i]);             <span class="comment">// Orig reference angles</span></div>
<div class="line"><a name="l01393"></a><span class="lineno"> 1393</span>&#160;</div>
<div class="line"><a name="l01394"></a><span class="lineno"> 1394</span>&#160;            <span class="comment">// Have we reached a termination condition? Still have errors?</span></div>
<div class="line"><a name="l01395"></a><span class="lineno"> 1395</span>&#160;            <span class="keywordflow">if</span>( fabs( error[i] - <a class="code" href="classforce__controller_1_1controller.html#aaf2e5764f863e7e35c7c16793ae7e17d">qe_</a>[i] ) != 0.0 )  </div>
<div class="line"><a name="l01396"></a><span class="lineno"> 1396</span>&#160;              keep = keep + 1; <span class="comment">// If keep &gt; 0, some joints did not reach goal</span></div>
<div class="line"><a name="l01397"></a><span class="lineno"> 1397</span>&#160;          }</div>
<div class="line"><a name="l01398"></a><span class="lineno"> 1398</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l01399"></a><span class="lineno"> 1399</span>&#160;          ok = ok + 1;</div>
<div class="line"><a name="l01400"></a><span class="lineno"> 1400</span>&#160;      }</div>
<div class="line"><a name="l01401"></a><span class="lineno"> 1401</span>&#160;    <a class="code" href="classforce__controller_1_1controller.html#aaf2e5764f863e7e35c7c16793ae7e17d">qe_</a> = error; </div>
<div class="line"><a name="l01402"></a><span class="lineno"> 1402</span>&#160;</div>
<div class="line"><a name="l01403"></a><span class="lineno"> 1403</span>&#160;    <span class="comment">/***** Cases ****/</span></div>
<div class="line"><a name="l01404"></a><span class="lineno"> 1404</span>&#160;    <span class="comment">// Timeout=all robot joints do not converge to desired position. Measured from the time the last joint command was published till now.</span></div>
<div class="line"><a name="l01405"></a><span class="lineno"> 1405</span>&#160;    ros::Time tnow = ros::Time::now();</div>
<div class="line"><a name="l01406"></a><span class="lineno"> 1406</span>&#160;    <span class="keywordtype">double</span> cur_timeOut = (begin-tnow).toSec();</div>
<div class="line"><a name="l01407"></a><span class="lineno"> 1407</span>&#160;    <span class="keywordtype">int</span> maxCycles=<a class="code" href="classforce__controller_1_1controller.html#a614899d6415daf8d0f9e35710f491136">timeOut_</a>*<a class="code" href="classforce__controller_1_1controller.html#a5bbb04800e288b5a5cc935ae194ab644">fc_while_loop_rate_</a>;</div>
<div class="line"><a name="l01408"></a><span class="lineno"> 1408</span>&#160;</div>
<div class="line"><a name="l01409"></a><span class="lineno"> 1409</span>&#160;    <span class="comment">// 1. Info printing case. Before timeout and still working towards the goal.</span></div>
<div class="line"><a name="l01410"></a><span class="lineno"> 1410</span>&#160;    <span class="keywordflow">if</span>( (keep + ok == <a class="code" href="classforce__controller_1_1controller.html#afcbd0b56ca056d42a4b9838fde2fd0d2">joints_</a>[0].size()) &amp;&amp; (ok != <a class="code" href="classforce__controller_1_1controller.html#a44c78f990df3a26aafe5ea5dd16debc4">joints_names_</a>.size()) &amp;&amp; ( cur_timeOut &lt;= <a class="code" href="classforce__controller_1_1controller.html#a614899d6415daf8d0f9e35710f491136">timeOut_</a> ))</div>
<div class="line"><a name="l01411"></a><span class="lineno"> 1411</span>&#160;      {</div>
<div class="line"><a name="l01412"></a><span class="lineno"> 1412</span>&#160;        ROS_INFO(<span class="stringliteral">&quot;Position Controller: At time: %f, keep = %d, ok = %d&quot;</span>, cur_timeOut, keep, ok);</div>
<div class="line"><a name="l01413"></a><span class="lineno"> 1413</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="classforce__controller_1_1controller.html#acaf8797976b6bca1c3e3266beeecea05">n_</a> % maxCycles == 0) ROS_WARN(<span class="stringliteral">&quot;Position Controller: Warning!! Max number of cycles reached in isMoveFinish().&quot;</span>);</div>
<div class="line"><a name="l01414"></a><span class="lineno"> 1414</span>&#160;</div>
<div class="line"><a name="l01415"></a><span class="lineno"> 1415</span>&#160;        cont = <span class="keyword">true</span>;   <span class="comment">// Continue the loop</span></div>
<div class="line"><a name="l01416"></a><span class="lineno"> 1416</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;  <span class="comment">// We have not yet reached the goal</span></div>
<div class="line"><a name="l01417"></a><span class="lineno"> 1417</span>&#160;      }</div>
<div class="line"><a name="l01418"></a><span class="lineno"> 1418</span>&#160;</div>
<div class="line"><a name="l01419"></a><span class="lineno"> 1419</span>&#160;    <span class="comment">// 2. Timeout: either reach the best possible solution or obstructed by something. </span></div>
<div class="line"><a name="l01420"></a><span class="lineno"> 1420</span>&#160;    <span class="comment">//    else if( (keep &lt;= 2) || ( ((tnow - to_).toSec()) &gt; timeOut_ ) )</span></div>
<div class="line"><a name="l01421"></a><span class="lineno"> 1421</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(  cur_timeOut &gt; <a class="code" href="classforce__controller_1_1controller.html#a614899d6415daf8d0f9e35710f491136">timeOut_</a> ) </div>
<div class="line"><a name="l01422"></a><span class="lineno"> 1422</span>&#160;      {</div>
<div class="line"><a name="l01423"></a><span class="lineno"> 1423</span>&#160;        ROS_ERROR(<span class="stringliteral">&quot;Position Controller: Timed Out!! At time: %f, and number of cycles: %d&quot;</span>, cur_timeOut, <a class="code" href="classforce__controller_1_1controller.html#acaf8797976b6bca1c3e3266beeecea05">n_</a>);</div>
<div class="line"><a name="l01424"></a><span class="lineno"> 1424</span>&#160;        cont = <span class="keyword">false</span>;   <span class="comment">// Could not get a result.        </span></div>
<div class="line"><a name="l01425"></a><span class="lineno"> 1425</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;    <span class="comment">// Return a finish command</span></div>
<div class="line"><a name="l01426"></a><span class="lineno"> 1426</span>&#160;      }</div>
<div class="line"><a name="l01427"></a><span class="lineno"> 1427</span>&#160;</div>
<div class="line"><a name="l01428"></a><span class="lineno"> 1428</span>&#160;    <span class="comment">// 3. Success: all 7 joints are under tolerance.</span></div>
<div class="line"><a name="l01429"></a><span class="lineno"> 1429</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(ok == <a class="code" href="classforce__controller_1_1controller.html#a44c78f990df3a26aafe5ea5dd16debc4">joints_names_</a>.size())</div>
<div class="line"><a name="l01430"></a><span class="lineno"> 1430</span>&#160;      {</div>
<div class="line"><a name="l01431"></a><span class="lineno"> 1431</span>&#160;        ROS_INFO(<span class="stringliteral">&quot;Position Controller: Success!! All joint position errors are under tolerance!&quot;</span>);</div>
<div class="line"><a name="l01432"></a><span class="lineno"> 1432</span>&#160;        cont = <span class="keyword">false</span>;   <span class="comment">// No need to continue</span></div>
<div class="line"><a name="l01433"></a><span class="lineno"> 1433</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">true</span>;    <span class="comment">// Return a finish command</span></div>
<div class="line"><a name="l01434"></a><span class="lineno"> 1434</span>&#160;      }</div>
<div class="line"><a name="l01435"></a><span class="lineno"> 1435</span>&#160;  }</div>
<div class="line"><a name="l01436"></a><span class="lineno"> 1436</span>&#160;}</div>
<div class="line"><a name="l01437"></a><span class="lineno"> 1437</span>&#160;</div>
<div class="line"><a name="l01438"></a><span class="lineno"> 1438</span>&#160;</div>
<div class="line"><a name="l01439"></a><span class="lineno"><a class="line" href="force__controller__topic_8cpp.html#a3c04138a5bfe5d72780bb7e82a18e627"> 1439</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="force__controller__topic_8cpp.html#a3c04138a5bfe5d72780bb7e82a18e627">main</a>(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span>** argv)</div>
<div class="line"><a name="l01440"></a><span class="lineno"> 1440</span>&#160;{</div>
<div class="line"><a name="l01441"></a><span class="lineno"> 1441</span>&#160;  ros::init(argc, argv, <span class="stringliteral">&quot;control_basis&quot;</span>);</div>
<div class="line"><a name="l01442"></a><span class="lineno"> 1442</span>&#160;</div>
<div class="line"><a name="l01443"></a><span class="lineno"> 1443</span>&#160;  <span class="comment">// Create a node namespace. Ie for service/publication: &lt;node_name&gt;/topic_name or for parameters: &lt;name_name&gt;/param_name </span></div>
<div class="line"><a name="l01444"></a><span class="lineno"> 1444</span>&#160;  ros::NodeHandle node(<span class="stringliteral">&quot;~&quot;</span>); </div>
<div class="line"><a name="l01445"></a><span class="lineno"> 1445</span>&#160;</div>
<div class="line"><a name="l01446"></a><span class="lineno"> 1446</span>&#160;  <span class="comment">// Instantiate the controller</span></div>
<div class="line"><a name="l01447"></a><span class="lineno"> 1447</span>&#160;  <a class="code" href="classforce__controller_1_1controller.html">force_controller::controller</a> myControl(node);</div>
<div class="line"><a name="l01448"></a><span class="lineno"> 1448</span>&#160;</div>
<div class="line"><a name="l01449"></a><span class="lineno"> 1449</span>&#160;  <span class="keywordflow">if</span>(myControl.<a class="code" href="classforce__controller_1_1controller.html#af91f75e28310a019cfb687306b509838">dynamic_reconfigure_flag</a>)</div>
<div class="line"><a name="l01450"></a><span class="lineno"> 1450</span>&#160;    {</div>
<div class="line"><a name="l01451"></a><span class="lineno"> 1451</span>&#160;      <span class="comment">// (i) Set up the dynamic reconfigure server</span></div>
<div class="line"><a name="l01452"></a><span class="lineno"> 1452</span>&#160;      dynamic_reconfigure::Server&lt;force_error_constants::force_error_constantsConfig&gt; srv;</div>
<div class="line"><a name="l01453"></a><span class="lineno"> 1453</span>&#160;</div>
<div class="line"><a name="l01454"></a><span class="lineno"> 1454</span>&#160;      <span class="comment">// (ii) Create a callback object of type force_error_constantsConfig</span></div>
<div class="line"><a name="l01455"></a><span class="lineno"> 1455</span>&#160;      dynamic_reconfigure::Server&lt;force_error_constants::force_error_constantsConfig&gt;::CallbackType f;</div>
<div class="line"><a name="l01456"></a><span class="lineno"> 1456</span>&#160;</div>
<div class="line"><a name="l01457"></a><span class="lineno"> 1457</span>&#160;      <span class="comment">// (iii) Bind that object to the actual callback function</span></div>
<div class="line"><a name="l01458"></a><span class="lineno"> 1458</span>&#160;      f=boost::bind(&amp;<a class="code" href="namespaceforce__controller.html#a0528cabafdfdb625a6147d7ba283ce4f">force_controller::callback</a>, _1, _2); <span class="comment">// Used to pass two params to a callback.</span></div>
<div class="line"><a name="l01459"></a><span class="lineno"> 1459</span>&#160;</div>
<div class="line"><a name="l01460"></a><span class="lineno"> 1460</span>&#160;      <span class="comment">// Note: how to bind a private member function: If we cant callback to be a member method of the class controller, then we would need to use something like... </span></div>
<div class="line"><a name="l01461"></a><span class="lineno"> 1461</span>&#160;      <span class="comment">// boost::function&lt;void (force_error_constants::force_error_constantsConfig &amp;,int)&gt; f2( boost::bind( &amp;myclass::fun2, this, _1, _2 ) );</span></div>
<div class="line"><a name="l01462"></a><span class="lineno"> 1462</span>&#160;      <span class="comment">// Still not clear on the syntax. Since it&#39;s not a member method, we make it a global and also need to use global parameters</span></div>
<div class="line"><a name="l01463"></a><span class="lineno"> 1463</span>&#160;</div>
<div class="line"><a name="l01464"></a><span class="lineno"> 1464</span>&#160;      <span class="comment">// (iv) Set the callback to the service server. </span></div>
<div class="line"><a name="l01465"></a><span class="lineno"> 1465</span>&#160;      srv.setCallback(f);</div>
<div class="line"><a name="l01466"></a><span class="lineno"> 1466</span>&#160;</div>
<div class="line"><a name="l01467"></a><span class="lineno"> 1467</span>&#160;      <span class="comment">// Update the rosCommunicationCtr</span></div>
<div class="line"><a name="l01468"></a><span class="lineno"> 1468</span>&#160;      myControl.<a class="code" href="classforce__controller_1_1controller.html#afa35ad83cda2ace867e7c53549cdcb4c">rosCommunicationCtrUp</a>();</div>
<div class="line"><a name="l01469"></a><span class="lineno"> 1469</span>&#160;    }</div>
<div class="line"><a name="l01470"></a><span class="lineno"> 1470</span>&#160;</div>
<div class="line"><a name="l01471"></a><span class="lineno"> 1471</span>&#160;  <span class="keywordflow">if</span>(!myControl.<a class="code" href="classforce__controller_1_1controller.html#a4b9a09393bdb00a2145d0bd7268e08d5">start</a>())</div>
<div class="line"><a name="l01472"></a><span class="lineno"> 1472</span>&#160;    {</div>
<div class="line"><a name="l01473"></a><span class="lineno"> 1473</span>&#160;      ROS_ERROR(<span class="stringliteral">&quot;Could not start controller, exiting&quot;</span>);</div>
<div class="line"><a name="l01474"></a><span class="lineno"> 1474</span>&#160;      ros::shutdown();</div>
<div class="line"><a name="l01475"></a><span class="lineno"> 1475</span>&#160;      <span class="keywordflow">return</span> 1;</div>
<div class="line"><a name="l01476"></a><span class="lineno"> 1476</span>&#160;    }</div>
<div class="line"><a name="l01477"></a><span class="lineno"> 1477</span>&#160;  ros::Rate rate( myControl.<a class="code" href="classforce__controller_1_1controller.html#aed7acb47000f7d6116b11daa5ec00562">get_fcLoopRate</a>() );</div>
<div class="line"><a name="l01478"></a><span class="lineno"> 1478</span>&#160;</div>
<div class="line"><a name="l01479"></a><span class="lineno"> 1479</span>&#160;  <span class="comment">/*** Different Communication Modes ***/</span></div>
<div class="line"><a name="l01480"></a><span class="lineno"> 1480</span>&#160;  <span class="keywordflow">while</span>(ros::ok())</div>
<div class="line"><a name="l01481"></a><span class="lineno"> 1481</span>&#160;    {</div>
<div class="line"><a name="l01482"></a><span class="lineno"> 1482</span>&#160;</div>
<div class="line"><a name="l01483"></a><span class="lineno"> 1483</span>&#160;      <span class="comment">// 1. AsyncSpinner</span></div>
<div class="line"><a name="l01484"></a><span class="lineno"> 1484</span>&#160;      ros::AsyncSpinner spinner(myControl.<a class="code" href="classforce__controller_1_1controller.html#aa950e66bc3f155ec0e94cfd54433fa85">get_rosCommunicationCtr</a>());</div>
<div class="line"><a name="l01485"></a><span class="lineno"> 1485</span>&#160;      spinner.start();</div>
<div class="line"><a name="l01486"></a><span class="lineno"> 1486</span>&#160;      <span class="comment">//ros::waitForShutdown(); </span></div>
<div class="line"><a name="l01487"></a><span class="lineno"> 1487</span>&#160;</div>
<div class="line"><a name="l01488"></a><span class="lineno"> 1488</span>&#160;      <span class="comment">// 2. MultiThreadedSpinner</span></div>
<div class="line"><a name="l01489"></a><span class="lineno"> 1489</span>&#160;      <span class="comment">// ros::MultiThreadedSpinner spinner(myControl.get_rosCommunicationCtr()); // One spinner per ROS communication object: here we use it for </span></div>
<div class="line"><a name="l01490"></a><span class="lineno"> 1490</span>&#160;      <span class="comment">//   1. Publish joint commands</span></div>
<div class="line"><a name="l01491"></a><span class="lineno"> 1491</span>&#160;      <span class="comment">//   2. Subsribe to current joint Angles</span></div>
<div class="line"><a name="l01492"></a><span class="lineno"> 1492</span>&#160;      <span class="comment">//   3. Advertice a service server</span></div>
<div class="line"><a name="l01493"></a><span class="lineno"> 1493</span>&#160;      <span class="comment">//   4. Subscribe to endpoint wrench (optional set in getWrenchEndpoint)</span></div>
<div class="line"><a name="l01494"></a><span class="lineno"> 1494</span>&#160;      <span class="comment">//   5. Dynamic Reconfigure (off)</span></div>
<div class="line"><a name="l01495"></a><span class="lineno"> 1495</span>&#160;      <span class="comment">//   6. published filtered wrench</span></div>
<div class="line"><a name="l01496"></a><span class="lineno"> 1496</span>&#160;      <span class="comment">//spinner.spin();</span></div>
<div class="line"><a name="l01497"></a><span class="lineno"> 1497</span>&#160;      <span class="comment">//ros::waitForShutdown(); </span></div>
<div class="line"><a name="l01498"></a><span class="lineno"> 1498</span>&#160;</div>
<div class="line"><a name="l01499"></a><span class="lineno"> 1499</span>&#160;      <span class="comment">// 3. Blocking Spin</span></div>
<div class="line"><a name="l01500"></a><span class="lineno"> 1500</span>&#160;      <span class="comment">// ros::spin();</span></div>
<div class="line"><a name="l01501"></a><span class="lineno"> 1501</span>&#160;      <span class="comment">// ros::waitForShutdown();</span></div>
<div class="line"><a name="l01502"></a><span class="lineno"> 1502</span>&#160;</div>
<div class="line"><a name="l01503"></a><span class="lineno"> 1503</span>&#160;      <span class="comment">// 4. Non Blocking spin</span></div>
<div class="line"><a name="l01504"></a><span class="lineno"> 1504</span>&#160;      <span class="comment">// ros::spinOnce();</span></div>
<div class="line"><a name="l01505"></a><span class="lineno"> 1505</span>&#160;      myControl.<a class="code" href="classforce__controller_1_1controller.html#a795224933ca2ffe25a6da08677c24928">force_controller</a>();</div>
<div class="line"><a name="l01506"></a><span class="lineno"> 1506</span>&#160;      rate.sleep();</div>
<div class="line"><a name="l01507"></a><span class="lineno"> 1507</span>&#160;    }</div>
<div class="line"><a name="l01508"></a><span class="lineno"> 1508</span>&#160;</div>
<div class="line"><a name="l01509"></a><span class="lineno"> 1509</span>&#160;  <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l01510"></a><span class="lineno"> 1510</span>&#160;}  </div>
<div class="ttc" id="classforce__controller_1_1controller_html_abd8b9a119755fa7119eb7fca73a085a8"><div class="ttname"><a href="classforce__controller_1_1controller.html#abd8b9a119755fa7119eb7fca73a085a8">force_controller::controller::wrench_sub_flag</a></div><div class="ttdeci">int wrench_sub_flag</div><div class="ttdef"><b>Definition:</b> <a href="force__controller__service_8h_source.html#l00272">force_controller_service.h:272</a></div></div>
<div class="ttc" id="classforce__controller_1_1controller_html_a84ec89e4aec8fd8cf6569b38929c34e4"><div class="ttname"><a href="classforce__controller_1_1controller.html#a84ec89e4aec8fd8cf6569b38929c34e4">force_controller::controller::tip_name_</a></div><div class="ttdeci">std::string tip_name_</div><div class="ttdef"><b>Definition:</b> <a href="force__controller__service_8h_source.html#l00290">force_controller_service.h:290</a></div></div>
<div class="ttc" id="force__controller__service_8h_html_a75013d7e939cffd5d4a019f69da86867"><div class="ttname"><a href="force__controller__service_8h.html#a75013d7e939cffd5d4a019f69da86867">WRENCH_ERORR_PUB_F</a></div><div class="ttdeci">#define WRENCH_ERORR_PUB_F</div><div class="ttdef"><b>Definition:</b> <a href="force__controller__service_8h_source.html#l00055">force_controller_service.h:55</a></div></div>
<div class="ttc" id="classforce__controller_1_1controller_html_aea175af45a8487a66063273b84f549f2"><div class="ttname"><a href="classforce__controller_1_1controller.html#aea175af45a8487a66063273b84f549f2">force_controller::controller::tgBase_</a></div><div class="ttdeci">std::vector&lt; double &gt; tgBase_</div><div class="ttdef"><b>Definition:</b> <a href="force__controller__service_8h_source.html#l00304">force_controller_service.h:304</a></div></div>
<div class="ttc" id="classforce__controller_1_1controller_html_a276068dd674237675fa4bf22f4c2d629"><div class="ttname"><a href="classforce__controller_1_1controller.html#a276068dd674237675fa4bf22f4c2d629">force_controller::controller::initialGravCompFlag</a></div><div class="ttdeci">int initialGravCompFlag</div><div class="ttdef"><b>Definition:</b> <a href="force__controller__service_8h_source.html#l00331">force_controller_service.h:331</a></div></div>
<div class="ttc" id="classforce__controller_1_1controller_html_aedbcede812ff8b7a120c69caa6626608"><div class="ttname"><a href="classforce__controller_1_1controller.html#aedbcede812ff8b7a120c69caa6626608">force_controller::controller::tm_t_1_</a></div><div class="ttdeci">std::vector&lt; double &gt; tm_t_1_</div><div class="ttdef"><b>Definition:</b> <a href="force__controller__service_8h_source.html#l00304">force_controller_service.h:304</a></div></div>
<div class="ttc" id="classforce__controller_1_1controller_html_adbb1c2386bb6d633eecafcdf7c713509"><div class="ttname"><a href="classforce__controller_1_1controller.html#adbb1c2386bb6d633eecafcdf7c713509">force_controller::controller::root_handle_</a></div><div class="ttdeci">ros::NodeHandle root_handle_</div><div class="ttdef"><b>Definition:</b> <a href="force__controller__service_8h_source.html#l00251">force_controller_service.h:251</a></div></div>
<div class="ttc" id="classforce__controller_1_1controller_html_a625c711141ecd592a817cbf94a15bff5"><div class="ttname"><a href="classforce__controller_1_1controller.html#a625c711141ecd592a817cbf94a15bff5">force_controller::controller::extractWrench_Force_Moment</a></div><div class="ttdeci">Eigen::Vector3d extractWrench_Force_Moment(string type)</div><div class="ttdef"><b>Definition:</b> <a href="force__controller__service_8cpp_source.html#l00291">force_controller_service.cpp:291</a></div></div>
<div class="ttc" id="namespaceforce__controller_html_a5aeeda755261f55a0a7537cf084aae0b"><div class="ttname"><a href="namespaceforce__controller.html#a5aeeda755261f55a0a7537cf084aae0b">force_controller::k_fp1</a></div><div class="ttdeci">double k_fp1</div><div class="ttdef"><b>Definition:</b> <a href="force__controller__service_8h_source.html#l00085">force_controller_service.h:85</a></div></div>
<div class="ttc" id="classforce__controller_1_1controller_html_aaea78103c35921c8632cfba6eff55324"><div class="ttname"><a href="classforce__controller_1_1controller.html#aaea78103c35921c8632cfba6eff55324">force_controller::controller::joint_cmd_pub_</a></div><div class="ttdeci">ros::Publisher joint_cmd_pub_</div><div class="ttdef"><b>Definition:</b> <a href="force__controller__service_8h_source.html#l00259">force_controller_service.h:259</a></div></div>
<div class="ttc" id="classforce__controller_1_1controller_html_a1ab1ccd76f056811dbe8e34397589423"><div class="ttname"><a href="classforce__controller_1_1controller.html#a1ab1ccd76f056811dbe8e34397589423">force_controller::controller::to_</a></div><div class="ttdeci">ros::Time to_</div><div class="ttdef"><b>Definition:</b> <a href="force__controller__service_8h_source.html#l00338">force_controller_service.h:338</a></div></div>
<div class="ttc" id="classforce__controller_1_1controller_html_aad5a334ce57bddf6d1b70bc8fd91ced2"><div class="ttname"><a href="classforce__controller_1_1controller.html#aad5a334ce57bddf6d1b70bc8fd91ced2">force_controller::controller::exe_</a></div><div class="ttdeci">bool exe_</div><div class="ttdef"><b>Definition:</b> <a href="force__controller__service_8h_source.html#l00320">force_controller_service.h:320</a></div></div>
<div class="ttc" id="force__controller__service_8h_html_a8030bd6f8002894b1993afe17539c7af"><div class="ttname"><a href="force__controller__service_8h.html#a8030bd6f8002894b1993afe17539c7af">CTRBAS_SRV_F</a></div><div class="ttdeci">#define CTRBAS_SRV_F</div><div class="ttdef"><b>Definition:</b> <a href="force__controller__service_8h_source.html#l00061">force_controller_service.h:61</a></div></div>
<div class="ttc" id="classforce__controller_1_1controller_html_a8a79843e5953f3a030f2d90ccf47aec9"><div class="ttname"><a href="classforce__controller_1_1controller.html#a8a79843e5953f3a030f2d90ccf47aec9">force_controller::controller::position_controller</a></div><div class="ttdeci">bool position_controller(sensor_msgs::JointState qd, ros::Time)</div><div class="ttdef"><b>Definition:</b> <a href="force__controller__service_8cpp_source.html#l01199">force_controller_service.cpp:1199</a></div></div>
<div class="ttc" id="classforce__controller_1_1controller_html_acba00b14e676b92bc19b966178c73a57"><div class="ttname"><a href="classforce__controller_1_1controller.html#acba00b14e676b92bc19b966178c73a57">force_controller::controller::qgoal_</a></div><div class="ttdeci">baxter_core_msgs::JointCommand qgoal_</div><div class="ttdef"><b>Definition:</b> <a href="force__controller__service_8h_source.html#l00309">force_controller_service.h:309</a></div></div>
<div class="ttc" id="classforce__controller_1_1controller_html_ab43040c1c59277906a1660bf18813f50"><div class="ttname"><a href="classforce__controller_1_1controller.html#ab43040c1c59277906a1660bf18813f50">force_controller::controller::wrench_error_pub_</a></div><div class="ttdeci">ros::Publisher wrench_error_pub_</div><div class="ttdef"><b>Definition:</b> <a href="force__controller__service_8h_source.html#l00261">force_controller_service.h:261</a></div></div>
<div class="ttc" id="classforce__controller_1_1controller_html_aa72dcbf75b0d6656b993444ab1baf42e"><div class="ttname"><a href="classforce__controller_1_1controller.html#aa72dcbf75b0d6656b993444ab1baf42e">force_controller::controller::joint_cmd_pub_flag</a></div><div class="ttdeci">int joint_cmd_pub_flag</div><div class="ttdef"><b>Definition:</b> <a href="force__controller__service_8h_source.html#l00278">force_controller_service.h:278</a></div></div>
<div class="ttc" id="namespaceforce__controller_html_a86abff188da089da6a36619373dacd8b"><div class="ttname"><a href="namespaceforce__controller.html#a86abff188da089da6a36619373dacd8b">force_controller::LEFT</a></div><div class="ttdeci">static const int LEFT</div><div class="ttdef"><b>Definition:</b> <a href="force__controller__service_8h_source.html#l00082">force_controller_service.h:82</a></div></div>
<div class="ttc" id="classforce__controller_1_1controller_html_ad54c67b3b4e11cf76ce6b42d9a805f46"><div class="ttname"><a href="classforce__controller_1_1controller.html#ad54c67b3b4e11cf76ce6b42d9a805f46">force_controller::controller::torque_controller</a></div><div class="ttdeci">void torque_controller(Eigen::VectorXd delT, ros::Time t0)</div><div class="ttdef"><b>Definition:</b> <a href="force__controller__service_8cpp_source.html#l01156">force_controller_service.cpp:1156</a></div></div>
<div class="ttc" id="classforce__controller_1_1controller_html_a44c78f990df3a26aafe5ea5dd16debc4"><div class="ttname"><a href="classforce__controller_1_1controller.html#a44c78f990df3a26aafe5ea5dd16debc4">force_controller::controller::joints_names_</a></div><div class="ttdeci">std::vector&lt; std::string &gt; joints_names_</div><div class="ttdef"><b>Definition:</b> <a href="force__controller__service_8h_source.html#l00291">force_controller_service.h:291</a></div></div>
<div class="ttc" id="classforce__controller_1_1controller_html_a795224933ca2ffe25a6da08677c24928"><div class="ttname"><a href="classforce__controller_1_1controller.html#a795224933ca2ffe25a6da08677c24928">force_controller::controller::force_controller</a></div><div class="ttdeci">bool force_controller()</div><div class="ttdef"><b>Definition:</b> <a href="force__controller__service_8cpp_source.html#l01038">force_controller_service.cpp:1038</a></div></div>
<div class="ttc" id="classforce__controller_1_1controller_html_a378293c954e789d133bdb273f1cc87b9"><div class="ttname"><a href="classforce__controller_1_1controller.html#a378293c954e789d133bdb273f1cc87b9">force_controller::controller::jv_t_1_</a></div><div class="ttdeci">std::vector&lt; double &gt; jv_t_1_</div><div class="ttdef"><b>Definition:</b> <a href="force__controller__service_8h_source.html#l00304">force_controller_service.h:304</a></div></div>
<div class="ttc" id="force__controller__service_8h_html_ac58264491fe4a942109b1b23f3625b0c"><div class="ttname"><a href="force__controller__service_8h.html#ac58264491fe4a942109b1b23f3625b0c">JOINTS_SUB_F</a></div><div class="ttdeci">#define JOINTS_SUB_F</div><div class="ttdef"><b>Definition:</b> <a href="force__controller__service_8h_source.html#l00049">force_controller_service.h:49</a></div></div>
<div class="ttc" id="classforce__controller_1_1controller_html_a07d207a2bc65d08b555e0101b459bb1e"><div class="ttname"><a href="classforce__controller_1_1controller.html#a07d207a2bc65d08b555e0101b459bb1e">force_controller::controller::jo_ready_</a></div><div class="ttdeci">bool jo_ready_</div><div class="ttdef"><b>Definition:</b> <a href="force__controller__service_8h_source.html#l00320">force_controller_service.h:320</a></div></div>
<div class="ttc" id="namespaceforce__controller_html_a9015ab9675d6cd1aa20368c6e541b838"><div class="ttname"><a href="namespaceforce__controller.html#a9015ab9675d6cd1aa20368c6e541b838">force_controller::k_mv0</a></div><div class="ttdeci">double k_mv0</div><div class="ttdef"><b>Definition:</b> <a href="force__controller__service_8h_source.html#l00091">force_controller_service.h:91</a></div></div>
<div class="ttc" id="namespaceforce__controller_html_a98b0f31330f4440a7743820ac112c0b5"><div class="ttname"><a href="namespaceforce__controller.html#a98b0f31330f4440a7743820ac112c0b5">force_controller::force_error_constantsFlag</a></div><div class="ttdeci">bool force_error_constantsFlag</div><div class="ttdef"><b>Definition:</b> <a href="force__controller__service_8h_source.html#l00093">force_controller_service.h:93</a></div></div>
<div class="ttc" id="classforce__controller_1_1controller_html_ac15c8cfd65846a64e01347baac788496"><div class="ttname"><a href="classforce__controller_1_1controller.html#ac15c8cfd65846a64e01347baac788496">force_controller::controller::joints_sub_</a></div><div class="ttdeci">ros::Subscriber joints_sub_</div><div class="ttdef"><b>Definition:</b> <a href="force__controller__service_8h_source.html#l00255">force_controller_service.h:255</a></div></div>
<div class="ttc" id="classforce__controller_1_1controller_html_a46b3a1acc465f1f4453452eb672638d0"><div class="ttname"><a href="classforce__controller_1_1controller.html#a46b3a1acc465f1f4453452eb672638d0">force_controller::controller::goal_</a></div><div class="ttdeci">std::vector&lt; double &gt; goal_</div><div class="ttdef"><b>Definition:</b> <a href="force__controller__service_8h_source.html#l00310">force_controller_service.h:310</a></div></div>
<div class="ttc" id="classforce__controller_1_1controller_html_ae917a00a77a125122d98190c317cabc5"><div class="ttname"><a href="classforce__controller_1_1controller.html#ae917a00a77a125122d98190c317cabc5">force_controller::controller::computeError</a></div><div class="ttdeci">double computeError(std::string type, Eigen::Vector3d xt, Eigen::Vector3d xd)</div><div class="ttdef"><b>Definition:</b> <a href="force__controller__service_8h_source.html#l00200">force_controller_service.h:200</a></div></div>
<div class="ttc" id="classforce__controller_1_1controller_html_a923ba48416f4898fedf169069bc46e6e"><div class="ttname"><a href="classforce__controller_1_1controller.html#a923ba48416f4898fedf169069bc46e6e">force_controller::controller::ft_wacoh_flag</a></div><div class="ttdeci">int ft_wacoh_flag</div><div class="ttdef"><b>Definition:</b> <a href="force__controller__service_8h_source.html#l00276">force_controller_service.h:276</a></div></div>
<div class="ttc" id="classforce__controller_1_1controller_html_ae80a69dcc5062b11960925155323227a"><div class="ttname"><a href="classforce__controller_1_1controller.html#ae80a69dcc5062b11960925155323227a">force_controller::controller::getSetPoint</a></div><div class="ttdeci">void getSetPoint(const force_controller::setPointConstPtr &amp;state)</div><div class="ttdef"><b>Definition:</b> <a href="force__controller__service_8cpp_source.html#l00618">force_controller_service.cpp:618</a></div></div>
<div class="ttc" id="classforce__controller_1_1controller_html_a3f6c9ff42779a7285c563423081d21ac"><div class="ttname"><a href="classforce__controller_1_1controller.html#a3f6c9ff42779a7285c563423081d21ac">force_controller::controller::filtered_wrench_pub_flag</a></div><div class="ttdeci">int filtered_wrench_pub_flag</div><div class="ttdef"><b>Definition:</b> <a href="force__controller__service_8h_source.html#l00280">force_controller_service.h:280</a></div></div>
<div class="ttc" id="force__controller__service_8h_html_a598a3330b3c21701223ee0ca14316eca"><div class="ttname"><a href="force__controller__service_8h.html#a598a3330b3c21701223ee0ca14316eca">PI</a></div><div class="ttdeci">#define PI</div><div class="ttdef"><b>Definition:</b> <a href="force__controller__service_8h_source.html#l00076">force_controller_service.h:76</a></div></div>
<div class="ttc" id="classforce__controller_1_1controller_html_ae03abf03e53baed9003d928cc193d9f5"><div class="ttname"><a href="classforce__controller_1_1controller.html#ae03abf03e53baed9003d928cc193d9f5">force_controller::controller::gFp_</a></div><div class="ttdeci">Eigen::Vector3d gFp_</div><div class="ttdef"><b>Definition:</b> <a href="force__controller__service_8h_source.html#l00294">force_controller_service.h:294</a></div></div>
<div class="ttc" id="classforce__controller_1_1controller_html_ae02baf2b659490f6df46f805ea5abfe8"><div class="ttname"><a href="classforce__controller_1_1controller.html#ae02baf2b659490f6df46f805ea5abfe8">force_controller::controller::torque_</a></div><div class="ttdeci">std::vector&lt; std::vector&lt; double &gt; &gt; torque_</div><div class="ttdef"><b>Definition:</b> <a href="force__controller__service_8h_source.html#l00305">force_controller_service.h:305</a></div></div>
<div class="ttc" id="namespaceforce__controller_html_a595af76feee2920c70e1e0d748d5947d"><div class="ttname"><a href="namespaceforce__controller.html#a595af76feee2920c70e1e0d748d5947d">force_controller::k_mp2</a></div><div class="ttdeci">double k_mp2</div><div class="ttdef"><b>Definition:</b> <a href="force__controller__service_8h_source.html#l00086">force_controller_service.h:86</a></div></div>
<div class="ttc" id="classforce__controller_1_1controller_html_a0df9762be0629c3201524b5c15426c86"><div class="ttname"><a href="classforce__controller_1_1controller.html#a0df9762be0629c3201524b5c15426c86">force_controller::controller::getWrenchEndpoint</a></div><div class="ttdeci">void getWrenchEndpoint(const baxter_core_msgs::EndpointStateConstPtr &amp;state)</div><div class="ttdef"><b>Definition:</b> <a href="force__controller__service_8cpp_source.html#l00470">force_controller_service.cpp:470</a></div></div>
<div class="ttc" id="namespaceforce__controller_html_a0528cabafdfdb625a6147d7ba283ce4f"><div class="ttname"><a href="namespaceforce__controller.html#a0528cabafdfdb625a6147d7ba283ce4f">force_controller::callback</a></div><div class="ttdeci">void callback(force_error_constants::force_error_constantsConfig &amp;config, uint32_t level)</div><div class="ttdef"><b>Definition:</b> <a href="force__controller__service_8cpp_source.html#l00008">force_controller_service.cpp:8</a></div></div>
<div class="ttc" id="classforce__controller_1_1controller_html_a8d5c14a6b0a989328a531290dd30aba5"><div class="ttname"><a href="classforce__controller_1_1controller.html#a8d5c14a6b0a989328a531290dd30aba5">force_controller::controller::gMp_</a></div><div class="ttdeci">Eigen::Vector3d gMp_</div><div class="ttdef"><b>Definition:</b> <a href="force__controller__service_8h_source.html#l00294">force_controller_service.h:294</a></div></div>
<div class="ttc" id="classforce__controller_1_1controller_html"><div class="ttname"><a href="classforce__controller_1_1controller.html">force_controller::controller</a></div><div class="ttdef"><b>Definition:</b> <a href="force__controller__service_8h_source.html#l00115">force_controller_service.h:115</a></div></div>
<div class="ttc" id="classforce__controller_1_1controller_html_acf9fcb088200fd76c428ccfd8bac076c"><div class="ttname"><a href="classforce__controller_1_1controller.html#acf9fcb088200fd76c428ccfd8bac076c">force_controller::controller::NullSpaceProjection</a></div><div class="ttdeci">bool NullSpaceProjection(std::vector&lt; Eigen::VectorXd &gt; updates, sensor_msgs::JointState &amp;dq)</div><div class="ttdef"><b>Definition:</b> <a href="force__controller__service_8cpp_source.html#l01000">force_controller_service.cpp:1000</a></div></div>
<div class="ttc" id="classforce__controller_1_1controller_html_acaf8797976b6bca1c3e3266beeecea05"><div class="ttname"><a href="classforce__controller_1_1controller.html#acaf8797976b6bca1c3e3266beeecea05">force_controller::controller::n_</a></div><div class="ttdeci">int n_</div><div class="ttdef"><b>Definition:</b> <a href="force__controller__service_8h_source.html#l00323">force_controller_service.h:323</a></div></div>
<div class="ttc" id="classforce__controller_1_1controller_html_a05582c92fb4c89e7d0245c43536088f1"><div class="ttname"><a href="classforce__controller_1_1controller.html#a05582c92fb4c89e7d0245c43536088f1">force_controller::controller::wrenchVecF</a></div><div class="ttdeci">std::deque&lt; Eigen::VectorXd &gt; wrenchVecF</div><div class="ttdef"><b>Definition:</b> <a href="force__controller__service_8h_source.html#l00303">force_controller_service.h:303</a></div></div>
<div class="ttc" id="classforce__controller_1_1controller_html_a5357d27a499e0cf688e87e288501e8ef"><div class="ttname"><a href="classforce__controller_1_1controller.html#a5357d27a499e0cf688e87e288501e8ef">force_controller::controller::wrench_error_pub_flag</a></div><div class="ttdeci">int wrench_error_pub_flag</div><div class="ttdef"><b>Definition:</b> <a href="force__controller__service_8h_source.html#l00279">force_controller_service.h:279</a></div></div>
<div class="ttc" id="force__controller__service_8h_html_ae729ae5085e05425e4d5e2e97ff4f9f2"><div class="ttname"><a href="force__controller__service_8h.html#ae729ae5085e05425e4d5e2e97ff4f9f2">JOINTS_PUB_F</a></div><div class="ttdeci">#define JOINTS_PUB_F</div><div class="ttdef"><b>Definition:</b> <a href="force__controller__service_8h_source.html#l00053">force_controller_service.h:53</a></div></div>
<div class="ttc" id="classforce__controller_1_1controller_html_a10cec6c9dd7d935336d1aef4679924fb"><div class="ttname"><a href="classforce__controller_1_1controller.html#a10cec6c9dd7d935336d1aef4679924fb">force_controller::controller::isMoveFinish</a></div><div class="ttdeci">bool isMoveFinish(bool &amp;result)</div><div class="ttdef"><b>Definition:</b> <a href="force__controller__service_8cpp_source.html#l01273">force_controller_service.cpp:1273</a></div></div>
<div class="ttc" id="classforce__controller_1_1controller_html_aaf07c006e57ab9b427af5190999ac696"><div class="ttname"><a href="classforce__controller_1_1controller.html#aaf07c006e57ab9b427af5190999ac696">force_controller::controller::tg_t_1_</a></div><div class="ttdeci">std::vector&lt; double &gt; tg_t_1_</div><div class="ttdef"><b>Definition:</b> <a href="force__controller__service_8h_source.html#l00304">force_controller_service.h:304</a></div></div>
<div class="ttc" id="classforce__controller_1_1controller_html_a6e3d2f700e0f9faa10734d8d3ed9f14a"><div class="ttname"><a href="classforce__controller_1_1controller.html#a6e3d2f700e0f9faa10734d8d3ed9f14a">force_controller::controller::jntPos_Torque_InnerCtrl_Flag_</a></div><div class="ttdeci">int jntPos_Torque_InnerCtrl_Flag_</div><div class="ttdef"><b>Definition:</b> <a href="force__controller__service_8h_source.html#l00327">force_controller_service.h:327</a></div></div>
<div class="ttc" id="force__controller__service_8h_html_aac6738ec688c2f04796681c78e2bd5e1"><div class="ttname"><a href="force__controller__service_8h.html#aac6738ec688c2f04796681c78e2bd5e1">FILT_W_PUB_F</a></div><div class="ttdeci">#define FILT_W_PUB_F</div><div class="ttdef"><b>Definition:</b> <a href="force__controller__service_8h_source.html#l00054">force_controller_service.h:54</a></div></div>
<div class="ttc" id="classforce__controller_1_1controller_html_af5c730489d342e7a3a8e7fc086cf7ee8"><div class="ttname"><a href="classforce__controller_1_1controller.html#af5c730489d342e7a3a8e7fc086cf7ee8">force_controller::controller::controller</a></div><div class="ttdeci">controller(ros::NodeHandle)</div><div class="ttdef"><b>Definition:</b> <a href="force__controller__service_8cpp_source.html#l00035">force_controller_service.cpp:35</a></div></div>
<div class="ttc" id="classforce__controller_1_1controller_html_af91f75e28310a019cfb687306b509838"><div class="ttname"><a href="classforce__controller_1_1controller.html#af91f75e28310a019cfb687306b509838">force_controller::controller::dynamic_reconfigure_flag</a></div><div class="ttdeci">int dynamic_reconfigure_flag</div><div class="ttdef"><b>Definition:</b> <a href="force__controller__service_8h_source.html#l00126">force_controller_service.h:126</a></div></div>
<div class="ttc" id="classforce__controller_1_1controller_html_a74ecf644e29bc65edd13e24f81ec3c36"><div class="ttname"><a href="classforce__controller_1_1controller.html#a74ecf644e29bc65edd13e24f81ec3c36">force_controller::controller::cur_data_</a></div><div class="ttdeci">Eigen::VectorXd cur_data_</div><div class="ttdef"><b>Definition:</b> <a href="force__controller__service_8h_source.html#l00302">force_controller_service.h:302</a></div></div>
<div class="ttc" id="classforce__controller_1_1controller_html_a990c5d78efd81b20830728580a6dcccf"><div class="ttname"><a href="classforce__controller_1_1controller.html#a990c5d78efd81b20830728580a6dcccf">force_controller::controller::fill</a></div><div class="ttdeci">sensor_msgs::JointState fill(Eigen::VectorXd dq)</div><div class="ttdef"><b>Definition:</b> <a href="force__controller__service_8cpp_source.html#l00239">force_controller_service.cpp:239</a></div></div>
<div class="ttc" id="namespaceforce__controller_html_ae69e9d55157a9e6d86bbb4988da3048f"><div class="ttname"><a href="namespaceforce__controller.html#ae69e9d55157a9e6d86bbb4988da3048f">force_controller::k_fp0</a></div><div class="ttdeci">double k_fp0</div><div class="ttdef"><b>Definition:</b> <a href="force__controller__service_8h_source.html#l00085">force_controller_service.h:85</a></div></div>
<div class="ttc" id="classforce__controller_1_1controller_html_a77574a80d7fa60f3430a0da033749fa6"><div class="ttname"><a href="classforce__controller_1_1controller.html#a77574a80d7fa60f3430a0da033749fa6">force_controller::controller::derror_</a></div><div class="ttdeci">Eigen::VectorXd derror_</div><div class="ttdef"><b>Definition:</b> <a href="force__controller__service_8h_source.html#l00296">force_controller_service.h:296</a></div></div>
<div class="ttc" id="classforce__controller_1_1Kinematics_html_ad2e72f1bb4e512403fb0cbf6ad27f1c4"><div class="ttname"><a href="classforce__controller_1_1Kinematics.html#ad2e72f1bb4e512403fb0cbf6ad27f1c4">force_controller::Kinematics::create</a></div><div class="ttdeci">static Ptr create(std::string tip_name, int &amp;no_jts)</div><div class="ttdef"><b>Definition:</b> <a href="kinematics_8h_source.html#l00046">kinematics.h:46</a></div></div>
<div class="ttc" id="classforce__controller_1_1controller_html_a7d49b6e63d3b7cc1eb38839c3c4cf186"><div class="ttname"><a href="classforce__controller_1_1controller.html#a7d49b6e63d3b7cc1eb38839c3c4cf186">force_controller::controller::error_norm_</a></div><div class="ttdeci">double error_norm_</div><div class="ttdef"><b>Definition:</b> <a href="force__controller__service_8h_source.html#l00298">force_controller_service.h:298</a></div></div>
<div class="ttc" id="namespaceforce__controller_html_a56542fdd8d3898990b6a1900a65b295f"><div class="ttname"><a href="namespaceforce__controller.html#a56542fdd8d3898990b6a1900a65b295f">force_controller::k_fv0</a></div><div class="ttdeci">double k_fv0</div><div class="ttdef"><b>Definition:</b> <a href="force__controller__service_8h_source.html#l00091">force_controller_service.h:91</a></div></div>
<div class="ttc" id="classforce__controller_1_1controller_html_af59fd764a51eb75822a0fe859f3c1a69"><div class="ttname"><a href="classforce__controller_1_1controller.html#af59fd764a51eb75822a0fe859f3c1a69">force_controller::controller::wrenchFilteringFlag</a></div><div class="ttdeci">int wrenchFilteringFlag</div><div class="ttdef"><b>Definition:</b> <a href="force__controller__service_8h_source.html#l00329">force_controller_service.h:329</a></div></div>
<div class="ttc" id="force__controller__service_8h_html_ab323266b3c62ab3978bbcf2f760e937e"><div class="ttname"><a href="force__controller__service_8h.html#ab323266b3c62ab3978bbcf2f760e937e">GRAV_PUB_F</a></div><div class="ttdeci">#define GRAV_PUB_F</div><div class="ttdef"><b>Definition:</b> <a href="force__controller__service_8h_source.html#l00056">force_controller_service.h:56</a></div></div>
<div class="ttc" id="force__controller__service_8h_html_ac49f84faad35fb6284d21ca8866a1942"><div class="ttname"><a href="force__controller__service_8h.html#ac49f84faad35fb6284d21ca8866a1942">DYN_RECONF_F</a></div><div class="ttdeci">#define DYN_RECONF_F</div><div class="ttdef"><b>Definition:</b> <a href="force__controller__service_8h_source.html#l00062">force_controller_service.h:62</a></div></div>
<div class="ttc" id="classforce__controller_1_1controller_html_afcbd0b56ca056d42a4b9838fde2fd0d2"><div class="ttname"><a href="classforce__controller_1_1controller.html#afcbd0b56ca056d42a4b9838fde2fd0d2">force_controller::controller::joints_</a></div><div class="ttdeci">std::vector&lt; std::vector&lt; double &gt; &gt; joints_</div><div class="ttdef"><b>Definition:</b> <a href="force__controller__service_8h_source.html#l00305">force_controller_service.h:305</a></div></div>
<div class="ttc" id="classforce__controller_1_1controller_html_a1d6e16a7f7273b1c917ef0195a6dbbf4"><div class="ttname"><a href="classforce__controller_1_1controller.html#a1d6e16a7f7273b1c917ef0195a6dbbf4">force_controller::controller::gFv_</a></div><div class="ttdeci">Eigen::Vector3d gFv_</div><div class="ttdef"><b>Definition:</b> <a href="force__controller__service_8h_source.html#l00295">force_controller_service.h:295</a></div></div>
<div class="ttc" id="classforce__controller_1_1controller_html_aa32fea7cb5c55d3003a4e21d3a0103d6"><div class="ttname"><a href="classforce__controller_1_1controller.html#aa32fea7cb5c55d3003a4e21d3a0103d6">force_controller::controller::setPoint_sub_flag</a></div><div class="ttdeci">int setPoint_sub_flag</div><div class="ttdef"><b>Definition:</b> <a href="force__controller__service_8h_source.html#l00273">force_controller_service.h:273</a></div></div>
<div class="ttc" id="classforce__controller_1_1controller_html_aa71c2771c7285ad804d022a9329b1d37"><div class="ttname"><a href="classforce__controller_1_1controller.html#aa71c2771c7285ad804d022a9329b1d37">force_controller::controller::getTorqueOffset</a></div><div class="ttdeci">Eigen::VectorXd getTorqueOffset()</div><div class="ttdef"><b>Definition:</b> <a href="force__controller__service_8cpp_source.html#l00261">force_controller_service.cpp:261</a></div></div>
<div class="ttc" id="classforce__controller_1_1controller_html_aa950e66bc3f155ec0e94cfd54433fa85"><div class="ttname"><a href="classforce__controller_1_1controller.html#aa950e66bc3f155ec0e94cfd54433fa85">force_controller::controller::get_rosCommunicationCtr</a></div><div class="ttdeci">int get_rosCommunicationCtr()</div><div class="ttdef"><b>Definition:</b> <a href="force__controller__service_8h_source.html#l00132">force_controller_service.h:132</a></div></div>
<div class="ttc" id="classforce__controller_1_1controller_html_abfe080984202747089d707ae59a0b468"><div class="ttname"><a href="classforce__controller_1_1controller.html#abfe080984202747089d707ae59a0b468">force_controller::controller::initialFiltering</a></div><div class="ttdeci">int initialFiltering</div><div class="ttdef"><b>Definition:</b> <a href="force__controller__service_8h_source.html#l00332">force_controller_service.h:332</a></div></div>
<div class="ttc" id="classforce__controller_1_1controller_html_a310cc036eec7848e60bb1b1d27b287de"><div class="ttname"><a href="classforce__controller_1_1controller.html#a310cc036eec7848e60bb1b1d27b287de">force_controller::controller::getWrenchEndpoint_wacoh</a></div><div class="ttdeci">void getWrenchEndpoint_wacoh(geometry_msgs::WrenchStamped state)</div><div class="ttdef"><b>Definition:</b> <a href="force__controller__service_8cpp_source.html#l00328">force_controller_service.cpp:328</a></div></div>
<div class="ttc" id="force__controller__service_8h_html_a799517031a8334a42807b119bb456c53"><div class="ttname"><a href="force__controller__service_8h.html#a799517031a8334a42807b119bb456c53">TIME_OUT</a></div><div class="ttdeci">#define TIME_OUT</div><div class="ttdef"><b>Definition:</b> <a href="force__controller__service_8h_source.html#l00071">force_controller_service.h:71</a></div></div>
<div class="ttc" id="classforce__controller_1_1controller_html_a29c199c16b81807932247d37b361b795"><div class="ttname"><a href="classforce__controller_1_1controller.html#a29c199c16b81807932247d37b361b795">force_controller::controller::tolerance_</a></div><div class="ttdeci">double tolerance_</div><div class="ttdef"><b>Definition:</b> <a href="force__controller__service_8h_source.html#l00314">force_controller_service.h:314</a></div></div>
<div class="ttc" id="classforce__controller_1_1controller_html_a614dfafdbe66861e6af231063d807f4f"><div class="ttname"><a href="classforce__controller_1_1controller.html#a614dfafdbe66861e6af231063d807f4f">force_controller::controller::gravitational_offset_pub_flag</a></div><div class="ttdeci">int gravitational_offset_pub_flag</div><div class="ttdef"><b>Definition:</b> <a href="force__controller__service_8h_source.html#l00281">force_controller_service.h:281</a></div></div>
<div class="ttc" id="force__controller__service_8h_html_a8bf091dd70dba91bc904c8087bede5d2"><div class="ttname"><a href="force__controller__service_8h.html#a8bf091dd70dba91bc904c8087bede5d2">POS_ROS_RATE</a></div><div class="ttdeci">#define POS_ROS_RATE</div><div class="ttdef"><b>Definition:</b> <a href="force__controller__service_8h_source.html#l00070">force_controller_service.h:70</a></div></div>
<div class="ttc" id="classforce__controller_1_1controller_html_acfb72315ab3cc7b6402ffb42c19aae73"><div class="ttname"><a href="classforce__controller_1_1controller.html#acfb72315ab3cc7b6402ffb42c19aae73">force_controller::controller::endEff_gravOffset_pub_</a></div><div class="ttdeci">ros::Publisher endEff_gravOffset_pub_</div><div class="ttdef"><b>Definition:</b> <a href="force__controller__service_8h_source.html#l00263">force_controller_service.h:263</a></div></div>
<div class="ttc" id="classforce__controller_1_1controller_html_a84eb8cee66c856c4f6ca9c5e57759858"><div class="ttname"><a href="classforce__controller_1_1controller.html#a84eb8cee66c856c4f6ca9c5e57759858">force_controller::controller::side_</a></div><div class="ttdeci">std::string side_</div><div class="ttdef"><b>Definition:</b> <a href="force__controller__service_8h_source.html#l00290">force_controller_service.h:290</a></div></div>
<div class="ttc" id="classforce__controller_1_1controller_html_a20322e56e819a4ab067a14040f4e45ec"><div class="ttname"><a href="classforce__controller_1_1controller.html#a20322e56e819a4ab067a14040f4e45ec">force_controller::controller::sP_</a></div><div class="ttdeci">force_controller::setPoint sP_</div><div class="ttdef"><b>Definition:</b> <a href="force__controller__service_8h_source.html#l00301">force_controller_service.h:301</a></div></div>
<div class="ttc" id="classforce__controller_1_1controller_html_a4304907123cc54656c3743a11b50c86b"><div class="ttname"><a href="classforce__controller_1_1controller.html#a4304907123cc54656c3743a11b50c86b">force_controller::controller::computePrimitiveController</a></div><div class="ttdeci">bool computePrimitiveController(Eigen::VectorXd &amp;update, std::string type, Eigen::Vector3d setPoint, std::vector&lt; double &gt; &amp;e)</div><div class="ttdef"><b>Definition:</b> <a href="force__controller__service_8cpp_source.html#l00936">force_controller_service.cpp:936</a></div></div>
<div class="ttc" id="classforce__controller_1_1controller_html_af22c1f78482a25b4436da3dd7c47dbb8"><div class="ttname"><a href="classforce__controller_1_1controller.html#af22c1f78482a25b4436da3dd7c47dbb8">force_controller::controller::wrench_sub_</a></div><div class="ttdeci">ros::Subscriber wrench_sub_</div><div class="ttdef"><b>Definition:</b> <a href="force__controller__service_8h_source.html#l00256">force_controller_service.h:256</a></div></div>
<div class="ttc" id="namespaceforce__controller_html_a5b3c2e286037742e79daaabd6d90eb2d"><div class="ttname"><a href="namespaceforce__controller.html#a5b3c2e286037742e79daaabd6d90eb2d">force_controller::k_fp2</a></div><div class="ttdeci">double k_fp2</div><div class="ttdef"><b>Definition:</b> <a href="force__controller__service_8h_source.html#l00085">force_controller_service.h:85</a></div></div>
<div class="ttc" id="classforce__controller_1_1controller_html_a1db5f13c75b670b100085a1dba15cc57"><div class="ttname"><a href="classforce__controller_1_1controller.html#a1db5f13c75b670b100085a1dba15cc57">force_controller::controller::getBaxterJointState</a></div><div class="ttdeci">void getBaxterJointState(const baxter_core_msgs::SEAJointStateConstPtr &amp;state)</div><div class="ttdef"><b>Definition:</b> <a href="force__controller__service_8cpp_source.html#l00667">force_controller_service.cpp:667</a></div></div>
<div class="ttc" id="force__controller__service_8h_html_a673b67db9693fbd9865bf36ffd68d153"><div class="ttname"><a href="force__controller__service_8h.html#a673b67db9693fbd9865bf36ffd68d153">JNTPOS_TORQUE_CONTROLLER</a></div><div class="ttdeci">#define JNTPOS_TORQUE_CONTROLLER</div><div class="ttdef"><b>Definition:</b> <a href="force__controller__service_8h_source.html#l00066">force_controller_service.h:66</a></div></div>
<div class="ttc" id="classforce__controller_1_1controller_html_aaf2e5764f863e7e35c7c16793ae7e17d"><div class="ttname"><a href="classforce__controller_1_1controller.html#aaf2e5764f863e7e35c7c16793ae7e17d">force_controller::controller::qe_</a></div><div class="ttdeci">std::vector&lt; double &gt; qe_</div><div class="ttdef"><b>Definition:</b> <a href="force__controller__service_8h_source.html#l00310">force_controller_service.h:310</a></div></div>
<div class="ttc" id="namespaceforce__controller_html_a1bc2e59c28ec7380b6625ea62731174c"><div class="ttname"><a href="namespaceforce__controller.html#a1bc2e59c28ec7380b6625ea62731174c">force_controller::k_mv1</a></div><div class="ttdeci">double k_mv1</div><div class="ttdef"><b>Definition:</b> <a href="force__controller__service_8h_source.html#l00091">force_controller_service.h:91</a></div></div>
<div class="ttc" id="classforce__controller_1_1controller_html_aa071e951e19dd04f4d3c512af6cdc151"><div class="ttname"><a href="classforce__controller_1_1controller.html#aa071e951e19dd04f4d3c512af6cdc151">force_controller::controller::setPoint_</a></div><div class="ttdeci">std::vector&lt; Eigen::VectorXd &gt; setPoint_</div><div class="ttdef"><b>Definition:</b> <a href="force__controller__service_8h_source.html#l00300">force_controller_service.h:300</a></div></div>
<div class="ttc" id="classforce__controller_1_1controller_html_ac0a27412a2683f8a49bc00d5c1e5dc71"><div class="ttname"><a href="classforce__controller_1_1controller.html#ac0a27412a2683f8a49bc00d5c1e5dc71">force_controller::controller::error_</a></div><div class="ttdeci">Eigen::VectorXd error_</div><div class="ttdef"><b>Definition:</b> <a href="force__controller__service_8h_source.html#l00296">force_controller_service.h:296</a></div></div>
<div class="ttc" id="classforce__controller_1_1controller_html_ad724ead6daa0473b167d5d0696f6576e"><div class="ttname"><a href="classforce__controller_1_1controller.html#ad724ead6daa0473b167d5d0696f6576e">force_controller::controller::updateGains</a></div><div class="ttdeci">void updateGains()</div><div class="ttdef"><b>Definition:</b> <a href="force__controller__service_8cpp_source.html#l00827">force_controller_service.cpp:827</a></div></div>
<div class="ttc" id="force__controller__topic_8h_html"><div class="ttname"><a href="force__controller__topic_8h.html">force_controller_topic.h</a></div></div>
<div class="ttc" id="classforce__controller_1_1controller_html_a33ee1de76097f84b78cdf11f1f8e3514"><div class="ttname"><a href="classforce__controller_1_1controller.html#a33ee1de76097f84b78cdf11f1f8e3514">force_controller::controller::velocity_</a></div><div class="ttdeci">std::vector&lt; std::vector&lt; double &gt; &gt; velocity_</div><div class="ttdef"><b>Definition:</b> <a href="force__controller__service_8h_source.html#l00305">force_controller_service.h:305</a></div></div>
<div class="ttc" id="classforce__controller_1_1controller_html_a614899d6415daf8d0f9e35710f491136"><div class="ttname"><a href="classforce__controller_1_1controller.html#a614899d6415daf8d0f9e35710f491136">force_controller::controller::timeOut_</a></div><div class="ttdeci">double timeOut_</div><div class="ttdef"><b>Definition:</b> <a href="force__controller__service_8h_source.html#l00339">force_controller_service.h:339</a></div></div>
<div class="ttc" id="force__controller__service_8h_html_a04e53c2a1dcb8167b241004eb0e4773a"><div class="ttname"><a href="force__controller__service_8h.html#a04e53c2a1dcb8167b241004eb0e4773a">WRENCH_SUB_F</a></div><div class="ttdeci">#define WRENCH_SUB_F</div><div class="ttdef"><b>Definition:</b> <a href="force__controller__service_8h_source.html#l00050">force_controller_service.h:50</a></div></div>
<div class="ttc" id="classforce__controller_1_1controller_html_aeba991414fee13121c4acc5f63375ff9"><div class="ttname"><a href="classforce__controller_1_1controller.html#aeba991414fee13121c4acc5f63375ff9">force_controller::controller::save_</a></div><div class="ttdeci">std::ofstream save_</div><div class="ttdef"><b>Definition:</b> <a href="force__controller__service_8h_source.html#l00335">force_controller_service.h:335</a></div></div>
<div class="ttc" id="classforce__controller_1_1controller_html_a8c4a72dc4cc143cdf2f8b0a9e7b9d672"><div class="ttname"><a href="classforce__controller_1_1controller.html#a8c4a72dc4cc143cdf2f8b0a9e7b9d672">force_controller::controller::errorCtr_</a></div><div class="ttdeci">int errorCtr_</div><div class="ttdef"><b>Definition:</b> <a href="force__controller__service_8h_source.html#l00323">force_controller_service.h:323</a></div></div>
<div class="ttc" id="classforce__controller_1_1controller_html_a245c6eec460f24b88c91c2ef355edf8c"><div class="ttname"><a href="classforce__controller_1_1controller.html#a245c6eec460f24b88c91c2ef355edf8c">force_controller::controller::JacobianErrorProduct</a></div><div class="ttdeci">bool JacobianErrorProduct(std::string type, Eigen::VectorXd &amp;update)</div><div class="ttdef"><b>Definition:</b> <a href="force__controller__service_8cpp_source.html#l00894">force_controller_service.cpp:894</a></div></div>
<div class="ttc" id="classforce__controller_1_1controller_html_a5bbb04800e288b5a5cc935ae194ab644"><div class="ttname"><a href="classforce__controller_1_1controller.html#a5bbb04800e288b5a5cc935ae194ab644">force_controller::controller::fc_while_loop_rate_</a></div><div class="ttdeci">double fc_while_loop_rate_</div><div class="ttdef"><b>Definition:</b> <a href="force__controller__service_8h_source.html#l00340">force_controller_service.h:340</a></div></div>
<div class="ttc" id="classforce__controller_1_1controller_html_a6288902c0638f29ecb08ca8109a050bf"><div class="ttname"><a href="classforce__controller_1_1controller.html#a6288902c0638f29ecb08ca8109a050bf">force_controller::controller::update_angles_</a></div><div class="ttdeci">sensor_msgs::JointState update_angles_</div><div class="ttdef"><b>Definition:</b> <a href="force__controller__service_8h_source.html#l00308">force_controller_service.h:308</a></div></div>
<div class="ttc" id="classforce__controller_1_1controller_html_a45c90a45405b50bebd1db979bb4d61e6"><div class="ttname"><a href="classforce__controller_1_1controller.html#a45c90a45405b50bebd1db979bb4d61e6">force_controller::controller::openFiles</a></div><div class="ttdeci">void openFiles()</div><div class="ttdef"><b>Definition:</b> <a href="force__controller__service_8h_source.html#l00171">force_controller_service.h:171</a></div></div>
<div class="ttc" id="force__controller__service_8h_html_adada7ef5a30b465af8de2d94f6f1e6d9"><div class="ttname"><a href="force__controller__service_8h.html#adada7ef5a30b465af8de2d94f6f1e6d9">FT_WACOH_F</a></div><div class="ttdeci">#define FT_WACOH_F</div><div class="ttdef"><b>Definition:</b> <a href="force__controller__service_8h_source.html#l00059">force_controller_service.h:59</a></div></div>
<div class="ttc" id="classforce__controller_1_1controller_html_a022ddeb5313ef39d3b61dafa72286667"><div class="ttname"><a href="classforce__controller_1_1controller.html#a022ddeb5313ef39d3b61dafa72286667">force_controller::controller::toVector</a></div><div class="ttdeci">std::vector&lt; double &gt; toVector(const geometry_msgs::Vector3 &amp;d)</div><div class="ttdef"><b>Definition:</b> <a href="force__controller__service_8cpp_source.html#l00224">force_controller_service.cpp:224</a></div></div>
<div class="ttc" id="namespacesetup_html_aca780a20a42a6ef8d18d6e332a91f721"><div class="ttname"><a href="namespacesetup.html#aca780a20a42a6ef8d18d6e332a91f721">setup.d</a></div><div class="ttdeci">tuple d</div><div class="ttdef"><b>Definition:</b> <a href="setup_8py_source.html#l00005">setup.py:5</a></div></div>
<div class="ttc" id="classforce__controller_1_1controller_html_a26eb26299919122098a0285ad4bf09d6"><div class="ttname"><a href="classforce__controller_1_1controller.html#a26eb26299919122098a0285ad4bf09d6">force_controller::controller::rosCommunicationCtr</a></div><div class="ttdeci">int rosCommunicationCtr</div><div class="ttdef"><b>Definition:</b> <a href="force__controller__service_8h_source.html#l00269">force_controller_service.h:269</a></div></div>
<div class="ttc" id="classforce__controller_1_1controller_html_af37d92322d83fc8c77d2f181b049c5a3"><div class="ttname"><a href="classforce__controller_1_1controller.html#af37d92322d83fc8c77d2f181b049c5a3">force_controller::controller::pos_while_loop_rate_</a></div><div class="ttdeci">double pos_while_loop_rate_</div><div class="ttdef"><b>Definition:</b> <a href="force__controller__service_8h_source.html#l00341">force_controller_service.h:341</a></div></div>
<div class="ttc" id="classforce__controller_1_1controller_html_ab1fabd40e6694b2f661d49657660769f"><div class="ttname"><a href="classforce__controller_1_1controller.html#ab1fabd40e6694b2f661d49657660769f">force_controller::controller::fillJointNames</a></div><div class="ttdeci">void fillJointNames()</div><div class="ttdef"><b>Definition:</b> <a href="force__controller__service_8cpp_source.html#l00196">force_controller_service.cpp:196</a></div></div>
<div class="ttc" id="classforce__controller_1_1controller_html_afa35ad83cda2ace867e7c53549cdcb4c"><div class="ttname"><a href="classforce__controller_1_1controller.html#afa35ad83cda2ace867e7c53549cdcb4c">force_controller::controller::rosCommunicationCtrUp</a></div><div class="ttdeci">void rosCommunicationCtrUp()</div><div class="ttdef"><b>Definition:</b> <a href="force__controller__service_8h_source.html#l00134">force_controller_service.h:134</a></div></div>
<div class="ttc" id="classforce__controller_1_1controller_html_a38e041c5afe185d763e0b6a1d2020560"><div class="ttname"><a href="classforce__controller_1_1controller.html#a38e041c5afe185d763e0b6a1d2020560">force_controller::controller::gMv_</a></div><div class="ttdeci">Eigen::Vector3d gMv_</div><div class="ttdef"><b>Definition:</b> <a href="force__controller__service_8h_source.html#l00295">force_controller_service.h:295</a></div></div>
<div class="ttc" id="force__controller__service_8h_html_a3e96b2f69d25eb963ff5075d9f0071b0"><div class="ttname"><a href="force__controller__service_8h.html#a3e96b2f69d25eb963ff5075d9f0071b0">SETPNT_SUB_F</a></div><div class="ttdeci">#define SETPNT_SUB_F</div><div class="ttdef"><b>Definition:</b> <a href="force__controller__service_8h_source.html#l00051">force_controller_service.h:51</a></div></div>
<div class="ttc" id="namespaceforce__controller_html_a61b6a2bfc5b42e1e845ff2bda2125f64"><div class="ttname"><a href="namespaceforce__controller.html#a61b6a2bfc5b42e1e845ff2bda2125f64">force_controller::k_fv2</a></div><div class="ttdeci">double k_fv2</div><div class="ttdef"><b>Definition:</b> <a href="force__controller__service_8h_source.html#l00091">force_controller_service.h:91</a></div></div>
<div class="ttc" id="namespaceforce__controller_html_a45c9844b88063808ec84797744142485"><div class="ttname"><a href="namespaceforce__controller.html#a45c9844b88063808ec84797744142485">force_controller::RIGHT</a></div><div class="ttdeci">static const int RIGHT</div><div class="ttdef"><b>Definition:</b> <a href="force__controller__service_8h_source.html#l00082">force_controller_service.h:82</a></div></div>
<div class="ttc" id="classforce__controller_1_1controller_html_a6d03a10356f839e09ab21ed7922d75ec"><div class="ttname"><a href="classforce__controller_1_1controller.html#a6d03a10356f839e09ab21ed7922d75ec">force_controller::controller::m_</a></div><div class="ttdeci">int m_</div><div class="ttdef"><b>Definition:</b> <a href="force__controller__service_8h_source.html#l00323">force_controller_service.h:323</a></div></div>
<div class="ttc" id="classforce__controller_1_1controller_html_a8097c60da101a4be307ba2234da52ba3"><div class="ttname"><a href="classforce__controller_1_1controller.html#a8097c60da101a4be307ba2234da52ba3">force_controller::controller::kine_model_</a></div><div class="ttdeci">Kinematics::Ptr kine_model_</div><div class="ttdef"><b>Definition:</b> <a href="force__controller__service_8h_source.html#l00287">force_controller_service.h:287</a></div></div>
<div class="ttc" id="classforce__controller_1_1controller_html_a6b77f0183903fdad065ffe21d92b3686"><div class="ttname"><a href="classforce__controller_1_1controller.html#a6b77f0183903fdad065ffe21d92b3686">force_controller::controller::alpha_</a></div><div class="ttdeci">double alpha_</div><div class="ttdef"><b>Definition:</b> <a href="force__controller__service_8h_source.html#l00314">force_controller_service.h:314</a></div></div>
<div class="ttc" id="classforce__controller_1_1controller_html_a1c26ab301c63daa32cdcb559df6f294b"><div class="ttname"><a href="classforce__controller_1_1controller.html#a1c26ab301c63daa32cdcb559df6f294b">force_controller::controller::init_</a></div><div class="ttdeci">bool init_</div><div class="ttdef"><b>Definition:</b> <a href="force__controller__service_8h_source.html#l00320">force_controller_service.h:320</a></div></div>
<div class="ttc" id="classforce__controller_1_1controller_html_afa606d4f8538259f1d603e1a1591256b"><div class="ttname"><a href="classforce__controller_1_1controller.html#afa606d4f8538259f1d603e1a1591256b">force_controller::controller::initialize</a></div><div class="ttdeci">void initialize()</div><div class="ttdef"><b>Definition:</b> <a href="force__controller__service_8h_source.html#l00243">force_controller_service.h:243</a></div></div>
<div class="ttc" id="namespaceforce__controller_html_a4a75753de3b1c0b8af8bc62de3678afd"><div class="ttname"><a href="namespaceforce__controller.html#a4a75753de3b1c0b8af8bc62de3678afd">force_controller::k_fv1</a></div><div class="ttdeci">double k_fv1</div><div class="ttdef"><b>Definition:</b> <a href="force__controller__service_8h_source.html#l00091">force_controller_service.h:91</a></div></div>
<div class="ttc" id="classforce__controller_1_1controller_html_a94eb7de6ca36f137faa978bd92ab22d4"><div class="ttname"><a href="classforce__controller_1_1controller.html#a94eb7de6ca36f137faa978bd92ab22d4">force_controller::controller::tg_</a></div><div class="ttdeci">std::vector&lt; std::vector&lt; double &gt; &gt; tg_</div><div class="ttdef"><b>Definition:</b> <a href="force__controller__service_8h_source.html#l00305">force_controller_service.h:305</a></div></div>
<div class="ttc" id="classforce__controller_1_1controller_html_a3bcf694aad91741d8826b087efc0d8cf"><div class="ttname"><a href="classforce__controller_1_1controller.html#a3bcf694aad91741d8826b087efc0d8cf">force_controller::controller::cur_data_f_</a></div><div class="ttdeci">Eigen::VectorXd cur_data_f_</div><div class="ttdef"><b>Definition:</b> <a href="force__controller__service_8h_source.html#l00302">force_controller_service.h:302</a></div></div>
<div class="ttc" id="classforce__controller_1_1controller_html_a336e3d15282f3ac82d188f841dd3296c"><div class="ttname"><a href="classforce__controller_1_1controller.html#a336e3d15282f3ac82d188f841dd3296c">force_controller::controller::error_t_1</a></div><div class="ttdeci">Eigen::VectorXd error_t_1</div><div class="ttdef"><b>Definition:</b> <a href="force__controller__service_8h_source.html#l00296">force_controller_service.h:296</a></div></div>
<div class="ttc" id="classforce__controller_1_1controller_html_a78728db5683bf435c3766e4e2f68cf58"><div class="ttname"><a href="classforce__controller_1_1controller.html#a78728db5683bf435c3766e4e2f68cf58">force_controller::controller::node_handle_</a></div><div class="ttdeci">ros::NodeHandle node_handle_</div><div class="ttdef"><b>Definition:</b> <a href="force__controller__service_8h_source.html#l00251">force_controller_service.h:251</a></div></div>
<div class="ttc" id="classforce__controller_1_1controller_html_aab96e1c62387346058db79b4066b6339"><div class="ttname"><a href="classforce__controller_1_1controller.html#aab96e1c62387346058db79b4066b6339">force_controller::controller::force_error_threshold_</a></div><div class="ttdeci">double force_error_threshold_</div><div class="ttdef"><b>Definition:</b> <a href="force__controller__service_8h_source.html#l00317">force_controller_service.h:317</a></div></div>
<div class="ttc" id="classforce__controller_1_1controller_html_a89d163d93c949add40d43dc6876f8f7f"><div class="ttname"><a href="classforce__controller_1_1controller.html#a89d163d93c949add40d43dc6876f8f7f">force_controller::controller::JacobianProduct</a></div><div class="ttdeci">bool JacobianProduct(std::string type, Eigen::VectorXd &amp;update)</div><div class="ttdef"><b>Definition:</b> <a href="force__controller__service_8cpp_source.html#l00853">force_controller_service.cpp:853</a></div></div>
<div class="ttc" id="classforce__controller_1_1controller_html_a5da8bb2066e33651742e40fe2654e432"><div class="ttname"><a href="classforce__controller_1_1controller.html#a5da8bb2066e33651742e40fe2654e432">force_controller::controller::no_</a></div><div class="ttdeci">int no_</div><div class="ttdef"><b>Definition:</b> <a href="force__controller__service_8h_source.html#l00323">force_controller_service.h:323</a></div></div>
<div class="ttc" id="namespaceforce__controller_html_ad68e3a9e51157a1cc644079cb991a9d5"><div class="ttname"><a href="namespaceforce__controller.html#ad68e3a9e51157a1cc644079cb991a9d5">force_controller::k_mv2</a></div><div class="ttdeci">double k_mv2</div><div class="ttdef"><b>Definition:</b> <a href="force__controller__service_8h_source.html#l00091">force_controller_service.h:91</a></div></div>
<div class="ttc" id="classforce__controller_1_1controller_html_a4b9a09393bdb00a2145d0bd7268e08d5"><div class="ttname"><a href="classforce__controller_1_1controller.html#a4b9a09393bdb00a2145d0bd7268e08d5">force_controller::controller::start</a></div><div class="ttdeci">bool start()</div><div class="ttdef"><b>Definition:</b> <a href="force__controller__service_8h_source.html#l00131">force_controller_service.h:131</a></div></div>
<div class="ttc" id="classforce__controller_1_1controller_html_aac1199be193bda87b0d54f6ad319e4ec"><div class="ttname"><a href="classforce__controller_1_1controller.html#aac1199be193bda87b0d54f6ad319e4ec">force_controller::controller::ctrl_server_flag</a></div><div class="ttdeci">int ctrl_server_flag</div><div class="ttdef"><b>Definition:</b> <a href="force__controller__service_8h_source.html#l00283">force_controller_service.h:283</a></div></div>
<div class="ttc" id="force__controller__topic_8cpp_html_a3c04138a5bfe5d72780bb7e82a18e627"><div class="ttname"><a href="force__controller__topic_8cpp.html#a3c04138a5bfe5d72780bb7e82a18e627">main</a></div><div class="ttdeci">int main(int argc, char **argv)</div><div class="ttdef"><b>Definition:</b> <a href="force__controller__topic_8cpp_source.html#l01439">force_controller_topic.cpp:1439</a></div></div>
<div class="ttc" id="classforce__controller_1_1controller_html_afbce15b637b449428b68e6d3ae4aca9a"><div class="ttname"><a href="classforce__controller_1_1controller.html#afbce15b637b449428b68e6d3ae4aca9a">force_controller::controller::j_t_1_</a></div><div class="ttdeci">std::vector&lt; double &gt; j_t_1_</div><div class="ttdef"><b>Definition:</b> <a href="force__controller__service_8h_source.html#l00304">force_controller_service.h:304</a></div></div>
<div class="ttc" id="classforce__controller_1_1controller_html_ad0625bce9d3236f29c4ec5296ed122a6"><div class="ttname"><a href="classforce__controller_1_1controller.html#ad0625bce9d3236f29c4ec5296ed122a6">force_controller::controller::filtered_wrench_pub_</a></div><div class="ttdeci">ros::Publisher filtered_wrench_pub_</div><div class="ttdef"><b>Definition:</b> <a href="force__controller__service_8h_source.html#l00260">force_controller_service.h:260</a></div></div>
<div class="ttc" id="classforce__controller_1_1controller_html_a6b98ecca8b41852578f2bad31d07fe19"><div class="ttname"><a href="classforce__controller_1_1controller.html#a6b98ecca8b41852578f2bad31d07fe19">force_controller::controller::gravitationalOffsetFlag</a></div><div class="ttdeci">int gravitationalOffsetFlag</div><div class="ttdef"><b>Definition:</b> <a href="force__controller__service_8h_source.html#l00330">force_controller_service.h:330</a></div></div>
<div class="ttc" id="force__controller__service_8h_html_adfcaf3d67d4879a6d620ed436c43325a"><div class="ttname"><a href="force__controller__service_8h.html#adfcaf3d67d4879a6d620ed436c43325a">FC_ROS_RATE</a></div><div class="ttdeci">#define FC_ROS_RATE</div><div class="ttdef"><b>Definition:</b> <a href="force__controller__service_8h_source.html#l00069">force_controller_service.h:69</a></div></div>
<div class="ttc" id="classforce__controller_1_1controller_html_a8696bbcc2cde16bdd0f4c857e8fe5c07"><div class="ttname"><a href="classforce__controller_1_1controller.html#a8696bbcc2cde16bdd0f4c857e8fe5c07">force_controller::controller::qd_</a></div><div class="ttdeci">std::vector&lt; double &gt; qd_</div><div class="ttdef"><b>Definition:</b> <a href="force__controller__service_8h_source.html#l00310">force_controller_service.h:310</a></div></div>
<div class="ttc" id="classforce__controller_1_1controller_html_afcdcc566f70a5cba008e6d00085ac2d7"><div class="ttname"><a href="classforce__controller_1_1controller.html#afcdcc566f70a5cba008e6d00085ac2d7">force_controller::controller::fin</a></div><div class="ttdeci">void fin()</div><div class="ttdef"><b>Definition:</b> <a href="force__controller__service_8h_source.html#l00183">force_controller_service.h:183</a></div></div>
<div class="ttc" id="classforce__controller_1_1controller_html_a1a3c36ec9ebe1455079f95e929f66d57"><div class="ttname"><a href="classforce__controller_1_1controller.html#a1a3c36ec9ebe1455079f95e929f66d57">force_controller::controller::wrenchVec</a></div><div class="ttdeci">std::deque&lt; Eigen::VectorXd &gt; wrenchVec</div><div class="ttdef"><b>Definition:</b> <a href="force__controller__service_8h_source.html#l00303">force_controller_service.h:303</a></div></div>
<div class="ttc" id="classforce__controller_1_1controller_html_aed7acb47000f7d6116b11daa5ec00562"><div class="ttname"><a href="classforce__controller_1_1controller.html#aed7acb47000f7d6116b11daa5ec00562">force_controller::controller::get_fcLoopRate</a></div><div class="ttdeci">double get_fcLoopRate()</div><div class="ttdef"><b>Definition:</b> <a href="force__controller__service_8h_source.html#l00133">force_controller_service.h:133</a></div></div>
<div class="ttc" id="classforce__controller_1_1controller_html_a489bb9eb1fa65e0220a29592c3667962"><div class="ttname"><a href="classforce__controller_1_1controller.html#a489bb9eb1fa65e0220a29592c3667962">force_controller::controller::joints_sub_flag</a></div><div class="ttdeci">int joints_sub_flag</div><div class="ttdef"><b>Definition:</b> <a href="force__controller__service_8h_source.html#l00271">force_controller_service.h:271</a></div></div>
<div class="ttc" id="namespaceforce__controller_html_a6143adbc6c88b5efcaeaee03278b7ea0"><div class="ttname"><a href="namespaceforce__controller.html#a6143adbc6c88b5efcaeaee03278b7ea0">force_controller::k_mp1</a></div><div class="ttdeci">double k_mp1</div><div class="ttdef"><b>Definition:</b> <a href="force__controller__service_8h_source.html#l00086">force_controller_service.h:86</a></div></div>
<div class="ttc" id="classforce__controller_1_1controller_html_a104a7d4810b5b2a2611d0361f8a6111e"><div class="ttname"><a href="classforce__controller_1_1controller.html#a104a7d4810b5b2a2611d0361f8a6111e">force_controller::controller::setPoint_sub_</a></div><div class="ttdeci">ros::Subscriber setPoint_sub_</div><div class="ttdef"><b>Definition:</b> <a href="force__controller__service_8h_source.html#l00257">force_controller_service.h:257</a></div></div>
<div class="ttc" id="namespaceforce__controller_html_aa5a1605f11362db37d087a8d641fa649"><div class="ttname"><a href="namespaceforce__controller.html#aa5a1605f11362db37d087a8d641fa649">force_controller::k_mp0</a></div><div class="ttdeci">double k_mp0</div><div class="ttdef"><b>Definition:</b> <a href="force__controller__service_8h_source.html#l00086">force_controller_service.h:86</a></div></div>
<div class="ttc" id="namespaceforce__controller_html_af4efc9ab36c78d664b2b8b55839673e4"><div class="ttname"><a href="namespaceforce__controller.html#af4efc9ab36c78d664b2b8b55839673e4">force_controller::COEFF</a></div><div class="ttdeci">static const double COEFF[2][7][3]</div><div class="ttdef"><b>Definition:</b> <a href="force__controller__service_8h_source.html#l00096">force_controller_service.h:96</a></div></div>
</div><!-- fragment --></div><!-- contents -->

<br clear="all" />
<hr size="1"><div style="align: right;">
<a href="http://wiki.ros.org/force_controller">force_controller</a><br />
Author(s): </br />
<small>autogenerated on Wed Dec 14 2016 11:07:43</small>
</div>
</body>
</html>
